
SQL*Plus: Release 11.2.0.1.0 Production on Fri Dec 17 22:52:59 2010

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

22:52:59 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.01
22:53:00 SQL> 22:53:00 SQL> --
22:53:00 SQL> -- oc.sql
22:53:00 SQL> --
22:53:00 SQL> 
22:53:00 SQL> -- This script helps me open and close forex positions.
22:53:00 SQL> 
22:53:00 SQL> COLUMN prdate FORMAT A22
22:53:00 SQL> 
22:53:00 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
22:53:00   2  SELECT
22:53:00   3  prdate
22:53:00   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
22:53:00   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
22:53:00   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
22:53:00   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
22:53:00   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
22:53:00   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
22:53:00  10  	ELSE SUBSTR(prdate,1,3)
22:53:00  11  	END pair
22:53:00  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
22:53:00  13  ,'buy'	    buysell
22:53:00  14  ,score
22:53:00  15  ,rundate
22:53:00  16  ,sysdate opdate
22:53:00  17  -- Deal with Fri-afternoon.
22:53:00  18  -- I want to close Fri-afternoon orders on Mon Morn 09:11 GMT:
22:53:00  19  ,CASE WHEN
22:53:00  20  	(
22:53:00  21  	0+TO_CHAR((sysdate),'D') = 6
22:53:00  22  	AND
22:53:00  23  	sysdate+4 > TRUNC(sysdate) + 21/24 + 50/60/24
22:53:00  24  	)
22:53:00  25  	THEN TRUNC(sysdate) + 3 + 9/24 + 11/60/24
22:53:00  26  	WHEN 0+TO_CHAR((sysdate+4/24),'D') = 7
22:53:00  27  	THEN TRUNC(sysdate) + 2 + 9/24 + 11/60/24
22:53:00  28  	ELSE sysdate + 4/24 END clsdate
22:53:00  29  FROM fxscores
22:53:00  30  WHERE score > 0.75
22:53:00  31  AND rundate > sysdate - 1/24
22:53:00  32  AND prdate NOT IN(SELECT prdate FROM oc)
22:53:00  33  ORDER BY rundate
22:53:00  34  /

0 rows created.

Elapsed: 00:00:00.00
22:53:00 SQL> 
22:53:00 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
22:53:00   2  SELECT
22:53:00   3  prdate
22:53:00   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
22:53:00   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
22:53:00   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
22:53:00   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
22:53:00   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
22:53:00   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
22:53:00  10  	ELSE SUBSTR(prdate,1,3)
22:53:00  11  	END pair
22:53:00  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
22:53:00  13  ,'sell'	      buysell
22:53:00  14  ,score
22:53:00  15  ,rundate
22:53:00  16  ,sysdate opdate
22:53:00  17  -- Deal with Fri-afternoon.
22:53:00  18  -- I want to close Fri-afternoon orders on Mon Morn 09:11 GMT:
22:53:00  19  ,CASE WHEN
22:53:00  20  	(
22:53:00  21  	0+TO_CHAR((sysdate),'D') = 6
22:53:00  22  	AND
22:53:00  23  	sysdate+4 > TRUNC(sysdate) + 21/24 + 50/60/24
22:53:00  24  	)
22:53:00  25  	THEN TRUNC(sysdate) + 3 + 9/24 + 11/60/24
22:53:00  26  	WHEN 0+TO_CHAR((sysdate+4/24),'D') = 7
22:53:00  27  	THEN TRUNC(sysdate) + 2 + 9/24 + 11/60/24
22:53:00  28  	ELSE sysdate + 4/24 END clsdate
22:53:00  29  FROM fxscores_gattn
22:53:00  30  WHERE score > 0.75
22:53:00  31  AND rundate > sysdate - 1/24
22:53:00  32  AND prdate NOT IN(SELECT prdate FROM oc)
22:53:00  33  ORDER BY rundate
22:53:00  34  /

0 rows created.

Elapsed: 00:00:00.01
22:53:00 SQL> 
22:53:00 SQL> -- rpt:
22:53:00 SQL> 
22:53:00 SQL> SELECT
22:53:00   2  prdate,buysell,score,rundate,opdate,clsdate
22:53:00   3  FROM oc
22:53:00   4  WHERE rundate > sysdate - 1
22:53:00   5  ORDER BY rundate
22:53:00   6  /

PRDATE		       BUYSELL	    SCORE RUNDATE	      OPDATE		  CLSDATE
---------------------- ------- ---------- ------------------- ------------------- -------------------
chf2010-12-17 02:05:00 sell    .774479936 2010-12-17 02:19:31 2010-12-17 02:19:32 2010-12-17 06:19:32
jpy2010-12-17 03:30:00 buy	.82358499 2010-12-17 03:43:35 2010-12-17 03:44:12 2010-12-17 07:44:12
cad2010-12-17 05:10:00 sell    .833109668 2010-12-17 05:21:42 2010-12-17 05:21:42 2010-12-17 09:21:42
aud2010-12-17 05:30:00 buy     .809928666 2010-12-17 05:41:42 2010-12-17 05:42:21 2010-12-17 09:42:21
chf2010-12-17 06:35:00 sell    .876424312 2010-12-17 06:49:41 2010-12-17 06:49:42 2010-12-17 10:49:42
jpy2010-12-17 06:45:00 sell    .753901091 2010-12-17 06:56:41 2010-12-17 06:56:41 2010-12-17 10:56:41
jpy2010-12-17 07:25:00 sell    .899185728 2010-12-17 07:39:32 2010-12-17 07:39:33 2010-12-17 11:39:33
cad2010-12-17 08:40:00 sell	.89946452 2010-12-17 08:51:37 2010-12-17 08:51:38 2010-12-17 12:51:38
eur2010-12-17 09:05:00 buy     .779180789 2010-12-17 09:16:39 2010-12-17 09:17:18 2010-12-17 13:17:18
gbp2010-12-17 09:10:00 buy     .833452892 2010-12-17 09:23:14 2010-12-17 09:23:50 2010-12-17 13:23:50
jpy2010-12-17 09:30:00 sell    .779192384 2010-12-17 09:42:35 2010-12-17 09:42:35 2010-12-17 13:42:35
cad2010-12-17 10:30:00 sell    .776726696 2010-12-17 10:45:03 2010-12-17 10:45:03 2010-12-17 14:45:03
gbp2010-12-17 11:05:00 buy     .860215248 2010-12-17 11:15:45 2010-12-17 11:16:23 2010-12-17 15:16:23
cad2010-12-17 11:10:00 sell    .836645047 2010-12-17 11:22:53 2010-12-17 11:22:54 2010-12-17 15:22:54
aud2010-12-17 11:30:00 buy     .817873654 2010-12-17 11:41:18 2010-12-17 11:41:58 2010-12-17 15:41:58
chf2010-12-17 11:55:00 sell    .792839829 2010-12-17 12:07:11 2010-12-17 12:07:11 2010-12-17 16:07:11
jpy2010-12-17 12:00:00 buy	.81168971 2010-12-17 12:13:03 2010-12-17 12:13:42 2010-12-17 16:13:42
gbp2010-12-17 12:20:00 sell    .842063788 2010-12-17 12:32:40 2010-12-17 12:32:40 2010-12-17 16:32:40
chf2010-12-17 12:30:00 sell    .803135668 2010-12-17 12:45:24 2010-12-17 12:45:24 2010-12-17 16:45:24
cad2010-12-17 13:05:00 buy     .829811372 2010-12-17 13:16:23 2010-12-17 13:17:03 2010-12-17 17:17:03
aud2010-12-17 13:20:00 sell    .755730271 2010-12-17 13:36:10 2010-12-17 13:36:10 2010-12-17 17:36:10
eur2010-12-17 13:30:00 sell    .754826752 2010-12-17 13:42:43 2010-12-17 13:42:44 2010-12-17 17:42:44
jpy2010-12-17 13:55:00 sell    .867985434 2010-12-17 14:08:09 2010-12-17 14:08:09 2010-12-17 18:08:09
eur2010-12-17 14:05:00 sell    .846870179 2010-12-17 14:21:01 2010-12-17 14:21:01 2010-12-17 18:21:01
cad2010-12-17 14:20:00 sell    .829913819 2010-12-17 14:33:56 2010-12-17 14:33:56 2010-12-17 18:33:56
chf2010-12-17 14:25:00 buy     .796959245 2010-12-17 14:39:48 2010-12-17 14:40:27 2010-12-17 18:40:27
eur2010-12-17 14:45:00 sell    .801152544 2010-12-17 14:59:32 2010-12-17 14:59:32 2010-12-17 18:59:32
jpy2010-12-17 15:50:00 sell    .810483491 2010-12-17 16:02:21 2010-12-17 16:02:22 2010-12-17 20:02:22
gbp2010-12-17 16:10:00 sell    .941388335 2010-12-17 16:21:27 2010-12-17 16:21:28 2010-12-17 20:21:28
cad2010-12-17 16:15:00 sell    .829083625 2010-12-17 16:27:57 2010-12-17 16:27:57 2010-12-17 20:27:57
jpy2010-12-17 16:25:00 sell    .751554424 2010-12-17 16:40:43 2010-12-17 16:40:43 2010-12-17 20:40:43
chf2010-12-17 17:00:00 buy     .785598773 2010-12-17 17:11:34 2010-12-17 17:12:14 2010-12-17 21:12:14
aud2010-12-17 17:10:00 buy	.89205315 2010-12-17 17:24:30 2010-12-17 17:25:08 2010-12-17 21:25:08
gbp2010-12-17 17:25:00 sell    .867349953 2010-12-17 17:38:11 2010-12-17 17:38:12 2010-12-17 21:38:12
cad2010-12-17 17:30:00 sell    .784649846 2010-12-17 17:44:33 2010-12-17 17:44:33 2010-12-17 21:44:33
aud2010-12-17 17:50:00 buy     .922000434 2010-12-17 18:02:41 2010-12-17 18:03:20 2010-12-17 22:03:20
jpy2010-12-17 18:20:00 sell    .838255887 2010-12-17 18:34:26 2010-12-17 18:34:26 2010-12-17 22:34:26
gbp2010-12-17 18:40:00 sell    .761932377 2010-12-17 18:53:11 2010-12-17 18:53:11 2010-12-17 22:53:11
gbp2010-12-17 19:20:00 buy     .767722162 2010-12-17 19:30:41 2010-12-17 19:31:21 2010-12-17 23:31:21
cad2010-12-17 19:25:00 sell    .762770584 2010-12-17 19:37:44 2010-12-17 19:37:44 2010-12-17 23:37:44
chf2010-12-17 19:30:00 sell    .847608452 2010-12-17 19:44:12 2010-12-17 19:44:12 2010-12-17 23:44:12
jpy2010-12-17 19:35:00 buy     .819944635 2010-12-17 19:50:01 2010-12-17 19:50:39 2010-12-17 23:50:39
eur2010-12-17 19:50:00 sell    .779133301 2010-12-17 20:03:11 2010-12-17 20:03:12 2010-12-18 00:03:12
gbp2010-12-17 19:55:00 sell    .827267922 2010-12-17 20:09:42 2010-12-17 20:09:43 2010-12-18 00:09:43
chf2010-12-17 20:50:00 sell	.80129539 2010-12-17 21:01:42 2010-12-17 21:01:42 2010-12-18 01:01:42
gbp2010-12-17 21:15:00 buy     .769303006 2010-12-17 21:26:13 2010-12-17 21:26:51 2010-12-18 01:26:51
gbp2010-12-17 21:50:00 sell    .755550362 2010-12-17 22:03:59 2010-12-17 22:04:00 2010-12-20 09:11:00

47 rows selected.

Elapsed: 00:00:00.00
22:53:00 SQL> 
22:53:00 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
