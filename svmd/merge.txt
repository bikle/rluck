
SQL*Plus: Release 11.2.0.1.0 Production on Tue May 10 04:54:36 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

04:54:36 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD';

Session altered.

Elapsed: 00:00:00.00
04:54:36 SQL> 
04:54:36 SQL> 04:54:36 SQL> --
04:54:36 SQL> -- merge.sql
04:54:36 SQL> --
04:54:36 SQL> 
04:54:36 SQL> -- I am interested in the real close, not the adj close.
04:54:36 SQL> -- In each CSV file, the real close comes right before volume.
04:54:36 SQL> -- In ystk_stage I call real-close: clse0
04:54:36 SQL> -- In ystk_stage I call adj-close: clse (which is confusing)
04:54:36 SQL> SELECT * FROM ystk_stage
04:54:36   2  WHERE ydate > sysdate -4
04:54:36   3  ORDER BY tkr,ydate
04:54:36   4  /

TKR	    YDATE	      OPN	  MX	     MN      CLSE0	  VOL	    CLSE
----------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
AAPL	    2011-05-09	   347.86      349.2	 346.53      347.6    7312400	   347.6
ABT	    2011-05-09	    52.51      52.75	  52.26      52.66    5789500	   52.66
ABX	    2011-05-09	    47.42	47.7	  47.05      47.67    6201100	   47.67
ACI	    2011-05-09	    30.94      31.99	  30.94      31.71    4174600	   31.71
ADBE	    2011-05-09	    33.34      34.25	  33.24      33.97    5395100	   33.97
ADM	    2011-05-09	    34.13      34.19	  33.86      34.11    4770500	   34.11
AEM	    2011-05-09	    63.44      63.75	  62.43      63.57    1794800	   63.57
AFL	    2011-05-09	    54.94      55.23	   54.2       54.7    2698300	    54.7
AGU	    2011-05-09	    84.34      85.25	  83.76       84.9    1224700	    84.9
AIG	    2011-05-09	    30.88      30.88	  29.45       29.7    6344500	    29.7
AKAM	    2011-05-09	    34.72      34.76	  34.14      34.59    3311300	   34.59
ALL	    2011-05-09	    33.41      33.44	  32.89      33.13    3578200	   33.13
AMGN	    2011-05-09	    57.38      57.94	  57.32      57.69    3624900	   57.69
AMT	    2011-05-09	     52.4      53.43	   52.4      53.07    1653000	   53.07
AMX	    2011-05-09	    51.87      52.18	   51.5      51.97    3483400	   51.97
AMZN	    2011-05-09	   198.34     202.36	 196.78      200.8    5825400	   200.8
APA	    2011-05-09	   124.95     127.91	 124.95     127.33    2454500	  127.33
APC	    2011-05-09	    75.18      77.23	  75.18      76.37    2913100	   76.37
ARG	    2011-05-09	    67.84	68.2	  67.67      67.98    1422800	   67.98
AXP	    2011-05-09	    50.06      50.42	  49.93      50.19    6289300	   50.19
AXU	    2011-05-09	     8.69	8.77	    8.4       8.58     721200	    8.58
BA	    2011-05-09	    79.31      80.15	  79.15      79.64    3137600	   79.64
BBT	    2011-05-09	       27      27.05	  26.84      26.97    4926000	   26.97
BBY	    2011-05-09	    30.91	  31	  30.24       30.4    5530000	    30.4
BEN	    2011-05-09	      126     127.59	  125.6     127.14     796600	  127.14
BHP	    2011-05-09	    95.31      96.91	  95.01      96.83    3022500	   96.83
BIDU	    2011-05-09	   142.26     143.33	 139.61     142.62    4636300	  142.62
BP	    2011-05-09	    44.52	  45	  44.37      44.87    7403900	   44.87
BRCM	    2011-05-09	    34.16	34.2	  33.67      33.86    7284400	   33.86
BTU	    2011-05-09	    62.54      64.16	  62.54       63.9    3033600	    63.9
BUCY	    2011-05-09	    91.38      91.38	  91.25      91.33     626100	   91.33
CAT	    2011-05-09	    110.8     112.48	 110.37     111.66    5075800	  111.66
CDE	    2011-05-09	     28.1      28.49	  26.05      26.98    6023300	   26.98
CELG	    2011-05-09	    59.19      60.11	  59.13      59.95    1849100	   59.95
CEO	    2011-05-09	   234.82     236.65	 232.06     234.85     139000	  234.85
CHK	    2011-05-09	    31.18      31.61	   31.1       31.3    6940400	    31.3
CLF	    2011-05-09	    89.76	92.5	  89.24      92.08    3345400	   92.08
CMI	    2011-05-09	   117.62     118.55	 116.46     117.59    1225100	  117.59
COF	    2011-05-09	    53.53      53.85	  53.16      53.37    2311500	   53.37
COP	    2011-05-09	     73.5      74.11	  73.16      73.72    9557300	   73.72
COST	    2011-05-09	    80.47	81.5	  80.33       81.4    1519700	    81.4
CREE	    2011-05-09	    39.73      39.81	     39      39.05    1329700	   39.05
CRM	    2011-05-09	   132.59     133.39	 130.69     132.71    1003900	  132.71
CSCO	    2011-05-09	    17.53      17.67	  17.47       17.6   46982400	    17.6
CSX	    2011-05-09	       79	  79	  77.82      78.25    2469900	   78.25
CTSH	    2011-05-09	    76.76	  78	  76.65      77.42    1416100	   77.42
CVE	    2011-05-09	    35.55      35.78	  34.99      35.68    1087700	   35.68
CVS	    2011-05-09	    37.07      37.64	  36.99      37.48    7841800	   37.48
CVX	    2011-05-09	   103.25     104.86	    103     104.09    7117900	  104.09
DD	    2011-05-09	    54.94	55.7	  54.79      55.41    4414800	   55.41
DE	    2011-05-09	    91.59      93.54	  91.54       92.8    3254800	    92.8
DIA	    2011-05-09	   126.24     127.07	 126.04     126.71    5464900	  126.71
DIS	    2011-05-09	    43.32      43.35	  42.93       43.1    6308300	    43.1
DNDN	    2011-05-09	    39.26      39.85	  38.86      39.53    1807600	   39.53
DTV	    2011-05-09	    48.49	49.5	  48.31      49.04    5364300	   49.04
DVN	    2011-05-09	    84.61	  86	  84.43      85.55    3350800	   85.55
EBAY	    2011-05-09	    32.58      33.32	  32.37      33.12    7695600	   33.12
EFA	    2011-05-09	    61.62      62.09	  61.36      62.04   17228200	   62.04
EOG	    2011-05-09	   110.23      111.9	  109.5     111.32    2382300	  111.32
ESRX	    2011-05-09	    57.79      59.26	  57.76      58.99    3715300	   58.99
EWZ	    2011-05-09	    74.11      74.43	  73.16       74.3   12019800	    74.3
EXK	    2011-05-09	    10.04      10.18	   9.63      10.11    4295400	   10.11
FCX	    2011-05-09	    51.03	52.1	  50.36      51.88   16249100	   51.88
FDX	    2011-05-09	     95.6      95.64	  94.56      94.91    1542000	   94.91
FFIV	    2011-05-09	   101.26     103.54	 100.26     103.37    1683000	  103.37
FLS	    2011-05-09	   122.14     124.42	 122.14     123.08     427000	  123.08
FSLR	    2011-05-09	   131.17     131.54	  127.7     130.04    1324800	  130.04
FXI	    2011-05-09	    43.86	44.1	  43.59      43.86   11588800	   43.86
GD	    2011-05-09	    74.33      75.07	  74.06      74.57    1381300	   74.57
GDX	    2011-05-09	    56.82      57.31	  56.29      57.21    8612300	   57.21
GFI	    2011-05-09	    15.98      16.14	  15.87      16.12    3595900	   16.12
GG	    2011-05-09	     49.6      50.26	  49.17      50.23    6146000	   50.23
GILD	    2011-05-09	    40.88      41.53	  40.84      41.24    8131100	   41.24
GLD	    2011-05-09	   146.67     147.58	 146.34     147.38   13842900	  147.38
GOOG	    2011-05-09	      535     538.49	  531.1     537.68    1948700	  537.68
GS	    2011-05-09	    149.7     149.87	  148.8     149.12    3152400	  149.12
HAL	    2011-05-09	    47.08      48.28	  47.08      48.06    7949700	   48.06
HD	    2011-05-09	    36.93      37.09	   36.7      36.96    6550000	   36.96
HES	    2011-05-09	    78.29      80.29	     78      79.95    3865000	   79.95
HL	    2011-05-09	     8.45	8.65	   8.23       8.65   11309700	    8.65
HOC	    2011-05-09	    55.53	  60	  55.22      59.49    1984800	   59.49
HON	    2011-05-09	     61.1      62.01	  60.91      61.62    3235100	   61.62
HPQ	    2011-05-09	    40.79      41.36	  40.75      41.02    9334700	   41.02
IBM	    2011-05-09	   168.39     169.85	 168.31      169.1    3594800	   169.1
IOC	    2011-05-09	    57.51      60.74	  57.51       59.3     568400	    59.3
IWM	    2011-05-09	    83.17      84.33	  83.04      84.24   45806800	   84.24
JNJ	    2011-05-09	    65.11      65.76	  65.07      65.63    9003100	   65.63
JOYG	    2011-05-09	    89.66      92.72	  89.13      92.07    1628700	   92.07
JPM	    2011-05-09	    44.75      45.11	  44.32      44.96   22588600	   44.96
JWN	    2011-05-09	    47.56	47.6	  47.02      47.31    1359700	   47.31
KO	    2011-05-09	    66.86      67.28	  66.83      66.95    4442100	   66.95
LFT	    2011-05-09	     20.1	20.1	  17.02      18.54    6714700	   18.54
LMT	    2011-05-09	    80.02      80.51	  79.63      79.93    1705300	   79.93
LVS	    2011-05-09	    43.54      43.73	  43.12      43.22    9297300	   43.22
MAR	    2011-05-09	    36.24      36.62	  36.14      36.35    3754100	   36.35
MCD	    2011-05-09	    79.46      79.82	  79.08      79.31    6284700	   79.31
MDT	    2011-05-09	    42.49	42.6	  42.01      42.24    5151500	   42.24
MDY	    2011-05-09	   179.39     181.65	 179.31     181.38    1847800	  181.38
MEE	    2011-05-09	    61.75      63.17	  61.48      62.92    2031700	   62.92
MET	    2011-05-09	    44.75      44.96	  44.49      44.58    5611600	   44.58
MJN	    2011-05-09	    65.98      66.03	  65.08      65.73    1365700	   65.73
MMM	    2011-05-09	     95.3      96.46	   95.3      95.99    2039000	   95.99
MON	    2011-05-09	    65.27      66.59	  65.06      66.34    3046600	   66.34
MOS	    2011-05-09	    71.04      72.49	  70.88      72.05    6034600	   72.05
MRK	    2011-05-09	    36.11      36.58	   36.1      36.48   10732800	   36.48
MRO	    2011-05-09	    50.25      52.31	  50.06      52.19    7901700	   52.19
MSFT	    2011-05-09	     25.8      25.96	  25.67      25.83   38719800	   25.83
MT	    2011-05-09	    35.26      35.93	  35.04      35.69    3795900	   35.69
MVG	    2011-05-09	    11.09      11.34	     11      11.07     160200	   11.07
NEM	    2011-05-09	    54.16      54.92	  54.14      54.68    4755700	   54.68
NFLX	    2011-05-09	    231.8      236.8	 231.36     236.41    4121900	  236.41
NOC	    2011-05-09	    64.58      65.26	  64.06      64.81    1264900	   64.81
NUE	    2011-05-09	    44.39	45.2	  44.28      44.95    2651100	   44.95
OIH	    2011-05-09	   149.02      151.5	 148.82     150.93    4786800	  150.93
ORCL	    2011-05-09	    34.89      35.45	  34.81       35.2   16287100	    35.2
OXY	    2011-05-09	   106.49      108.4	 104.72     107.48    5681000	  107.48
PAAS	    2011-05-09	    33.79      34.44	  33.28      34.31    1549800	   34.31
PALL	    2011-05-09	    71.85      72.73	  71.85      72.52     260000	   72.52
PBR	    2011-05-09	     34.5      34.86	  34.26      34.73   14265800	   34.73
PEP	    2011-05-09	    69.64      69.98	  69.48      69.82    5763100	   69.82

TKR	    YDATE	      OPN	  MX	     MN      CLSE0	  VOL	    CLSE
----------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
PG	    2011-05-09	    64.93      65.39	  64.86      65.14    8717800	   65.14
PM	    2011-05-09	    68.84	  69	  68.17      68.29    5464700	   68.29
PNC	    2011-05-09	    62.36      62.54	  61.98      62.08    2083100	   62.08
POT	    2011-05-09	    53.82      54.63	  53.23      54.53    5201100	   54.53
PPLT	    2011-05-09	   177.32     178.21	 177.18      178.1	96000	   178.1
PRU	    2011-05-09	    63.54      64.35	  63.51      63.83    2616300	   63.83
QCOM	    2011-05-09	    56.75      56.92	  55.99      56.66    8056600	   56.66
QQQ	    2011-05-09	    58.57      58.92	  58.34      58.69   40022000	   58.69
RDY	    2011-05-09	    36.41      36.89	  36.39      36.89     135000	   36.89
RIG	    2011-05-09	    67.63	68.5	  67.13      67.97    3985400	   67.97
RIMM	    2011-05-09	    45.76      45.91	  44.63      45.01   19383600	   45.01
RTN	    2011-05-09	    49.39      49.63	  49.01      49.51    1726400	   49.51
SBUX	    2011-05-09	    36.51      36.64	  36.08      36.12    4904600	   36.12
SCCO	    2011-05-09	    35.91      36.39	  35.18      36.29    2560300	   36.29
SINA	    2011-05-09	    125.5      127.8	    124     124.45    3629000	  124.45
SJM	    2011-05-09	    74.12      74.71	  73.83      74.66     360100	   74.66
SKX	    2011-05-09	    18.42      18.62	   18.2      18.42     474000	   18.42
SLB	    2011-05-09	     83.4      84.03	  82.67      83.59    8670500	   83.59
SLV	    2011-05-09	    36.17      37.04	   35.8      36.98  109221900	   36.98
SLW	    2011-05-09	    36.99	37.5	  36.19      36.87   15789800	   36.87
SNDK	    2011-05-09	    47.71      47.81	  46.75      47.29    3356000	   47.29
SOHU	    2011-05-09	    93.62	  96	  93.13      95.08    1282500	   95.08
SPY	    2011-05-09	   134.19     135.11	 133.98     134.72  113986800	  134.72
STT	    2011-05-09	    46.44      46.72	  46.25      46.49    1867300	   46.49
SU	    2011-05-09	    42.07      42.43	  41.44      42.18    5858100	   42.18
SUN	    2011-05-09	    41.13      42.24	   40.9      41.85    3394500	   41.85
SVM	    2011-05-09	    11.47      11.67	  11.22      11.64    3295500	   11.64
SWC	    2011-05-09	    19.89      20.71	  19.89       20.5    2485800	    20.5
T	    2011-05-09	     31.2      31.42	  31.06      31.35   15376300	   31.35
TEVA	    2011-05-09	     47.7      47.83	  47.09      47.09    4879100	   47.09
TGT	    2011-05-09	    50.47      50.47	  49.81 	50    4757400	      50
TKR	    2011-05-09	    52.19      53.66	  51.83      52.95     763600	   52.95
TLT	    2011-05-09	     94.9	95.2	  94.84      94.97    3731200	   94.97
TSO	    2011-05-09	    24.88	25.9	  24.79      25.79    4958900	   25.79
TXN	    2011-05-09	    35.19	35.6	  35.15      35.34    7274500	   35.34
UNH	    2011-05-09	    49.75      50.91	  49.75      50.47    5665200	   50.47
UNP	    2011-05-09	   102.19     102.98	 101.57     102.47    1462000	  102.47
UPS	    2011-05-09	    74.01      74.06	  73.58       73.7    3403200	    73.7
V	    2011-05-09	    79.13      79.98	  79.04      79.86    4773300	   79.86
VALE	    2011-05-09	    31.03      31.43	  30.77      31.32   16105600	   31.32
VECO	    2011-05-09	     51.2      51.37	  49.57      50.93     997900	   50.93
VLO	    2011-05-09	    26.85      27.75	  26.85      27.68    9444300	   27.68
VMW	    2011-05-09	    92.77      94.04	     92      93.47    1526700	   93.47
WDC	    2011-05-09	    38.05      38.44	   37.8      38.06    2836100	   38.06
WFC	    2011-05-09	    28.07      28.47	  28.05      28.21   21580100	   28.21
WFM	    2011-05-09	    61.33	  62	  60.88      61.08    1307600	   61.08
WHR	    2011-05-09	    84.36      84.61	  83.06      83.55     831700	   83.55
WMT	    2011-05-09	    54.97      55.36	   54.7       55.1    6562900	    55.1
WYNN	    2011-05-09	    144.5      146.9	  144.5     144.71    1258100	  144.71
X	    2011-05-09	    46.33	47.1	  46.12      46.65    7806100	   46.65
XLB	    2011-05-09	    39.43      40.04	  39.39      39.92   13376500	   39.92
XLE	    2011-05-09	    75.15      76.47	  75.02      76.11   24224300	   76.11
XLU	    2011-05-09	    33.25      33.39	  33.11      33.36    3917300	   33.36
XOM	    2011-05-09	    83.01      83.72	  82.16      83.18   18254600	   83.18
YUM	    2011-05-09	     53.7      54.39	  53.66      54.34    2520600	   54.34

175 rows selected.

Elapsed: 00:00:00.13
04:54:37 SQL> 
04:54:37 SQL> TRUNCATE TABLE ystk;

Table truncated.

Elapsed: 00:00:43.07
04:55:20 SQL> 
04:55:20 SQL> INSERT INTO ystk(tkr,ydate,tkrdate,clse,clse2,g1d)
04:55:20   2  SELECT
04:55:20   3  tkr
04:55:20   4  ,ydate
04:55:20   5  ,tkr||ydate
04:55:20   6  ,clse0
04:55:20   7  ,LEAD(clse0,1,NULL)OVER(PARTITION BY tkr ORDER BY ydate)clse2
04:55:20   8  ,LEAD(clse0,1,NULL)OVER(PARTITION BY tkr ORDER BY ydate)-clse0 g1d
04:55:20   9  FROM ystk_stage
04:55:20  10  ORDER BY tkr,ydate
04:55:20  11  /

901743 rows created.

Elapsed: 00:00:03.54
04:55:23 SQL> Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
