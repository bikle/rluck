
SQL*Plus: Release 11.2.0.1.0 Production on Tue Dec 21 02:02:10 2010

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

02:02:10 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
02:02:10 SQL> 02:02:10 SQL> --
02:02:10 SQL> -- oc.sql
02:02:10 SQL> --
02:02:10 SQL> 
02:02:10 SQL> -- This script helps me open and close forex positions.
02:02:10 SQL> 
02:02:10 SQL> COLUMN prdate FORMAT A22
02:02:10 SQL> 
02:02:10 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
02:02:10   2  SELECT
02:02:10   3  prdate
02:02:10   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
02:02:10   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
02:02:10   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
02:02:10   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
02:02:10   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
02:02:10   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
02:02:10  10  	ELSE SUBSTR(prdate,1,3)
02:02:10  11  	END    pair
02:02:10  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
02:02:10  13  ,'buy'	 buysell
02:02:10  14  ,score
02:02:10  15  ,rundate
02:02:10  16  ,sysdate opdate
02:02:10  17  -- Deal with Fri-afternoon.
02:02:10  18  -- I want to close Late-Fri-afternoon orders on Mon Morn 01:11 GMT
02:02:10  19  -- This is 09:11am in Tokyo:
02:02:10  20  ,CASE WHEN
02:02:10  21  	(
02:02:10  22  	0+TO_CHAR((sysdate),'D') = 6
02:02:10  23  	AND
02:02:10  24  	sysdate+8/24 > TRUNC(sysdate) + 21/24 + 50/60/24
02:02:10  25  	)
02:02:10  26  	THEN TRUNC(sysdate) + 3 + 1/24 + 11/60/24
02:02:10  27  	WHEN 0+TO_CHAR((sysdate+8/24),'D') = 7
02:02:10  28  	THEN TRUNC(sysdate) + 2 + 1/24 + 11/60/24
02:02:10  29  	ELSE sysdate + 8/24 END clsdate
02:02:10  30  FROM fxscores8hp
02:02:10  31  WHERE score > 0.75
02:02:10  32  AND rundate > sysdate - 1/24
02:02:10  33  AND prdate NOT IN(SELECT prdate FROM oc)
02:02:10  34  ORDER BY rundate
02:02:10  35  /

0 rows created.

Elapsed: 00:00:00.00
02:02:10 SQL> 
02:02:10 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
02:02:10   2  SELECT
02:02:10   3  prdate
02:02:10   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
02:02:10   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
02:02:10   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
02:02:10   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
02:02:10   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
02:02:10   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
02:02:10  10  	ELSE SUBSTR(prdate,1,3)
02:02:10  11  	END pair
02:02:10  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
02:02:10  13  ,'sell'	      buysell
02:02:10  14  ,score
02:02:10  15  ,rundate
02:02:10  16  ,sysdate opdate
02:02:10  17  -- Deal with Fri-afternoon.
02:02:10  18  -- I want to close Fri-afternoon orders on Mon Morn 01:11 GMT:
02:02:10  19  ,CASE WHEN
02:02:10  20  	(
02:02:10  21  	0+TO_CHAR((sysdate),'D') = 6
02:02:10  22  	AND
02:02:10  23  	sysdate+8/24 > TRUNC(sysdate) + 21/24 + 50/60/24
02:02:10  24  	)
02:02:10  25  	THEN TRUNC(sysdate) + 3 + 1/24 + 11/60/24
02:02:10  26  	WHEN 0+TO_CHAR((sysdate+8/24),'D') = 7
02:02:10  27  	THEN TRUNC(sysdate) + 2 + 1/24 + 11/60/24
02:02:10  28  	ELSE sysdate + 8/24 END clsdate
02:02:10  29  FROM fxscores8hp_gattn
02:02:10  30  WHERE score > 0.75
02:02:10  31  AND rundate > sysdate - 1/24
02:02:10  32  AND prdate NOT IN(SELECT prdate FROM oc)
02:02:10  33  ORDER BY rundate
02:02:10  34  /

0 rows created.

Elapsed: 00:00:00.01
02:02:10 SQL> 
02:02:10 SQL> -- rpt:
02:02:10 SQL> 
02:02:10 SQL> SELECT
02:02:10   2  prdate,buysell,score,rundate,opdate,clsdate
02:02:10   3  FROM oc
02:02:10   4  WHERE rundate > sysdate - 1
02:02:10   5  ORDER BY rundate
02:02:10   6  /

PRDATE		       BUYSELL	    SCORE RUNDATE	      OPDATE		  CLSDATE
---------------------- ------- ---------- ------------------- ------------------- -------------------
chf2010-12-20 01:55:00 sell    .753926973 2010-12-20 02:03:20 2010-12-20 02:04:11 2010-12-20 10:04:11
chf2010-12-20 01:50:00 sell    .765492297 2010-12-20 02:04:11 2010-12-20 02:04:11 2010-12-20 10:04:11
chf2010-12-20 03:15:00 sell    .896475498 2010-12-20 03:27:08 2010-12-20 03:27:56 2010-12-20 11:27:56
chf2010-12-20 03:10:00 sell    .869827481 2010-12-20 03:27:56 2010-12-20 03:27:56 2010-12-20 11:27:56
jpy2010-12-20 03:25:00 sell	.80207889 2010-12-20 03:36:11 2010-12-20 03:36:58 2010-12-20 11:36:58
aud2010-12-20 03:35:00 buy     .853603084 2010-12-20 03:43:23 2010-12-20 03:45:49 2010-12-20 11:45:49
gbp2010-12-20 03:50:00 buy     .780679896 2010-12-20 04:00:48 2010-12-20 04:01:38 2010-12-20 12:01:38
chf2010-12-20 04:10:00 sell    .865398365 2010-12-20 04:18:04 2010-12-20 04:18:51 2010-12-20 12:18:51
chf2010-12-20 04:05:00 sell    .801972451 2010-12-20 04:18:51 2010-12-20 04:18:51 2010-12-20 12:18:51
gbp2010-12-20 04:40:00 buy     .795375737 2010-12-20 04:51:03 2010-12-20 04:51:53 2010-12-20 12:51:53
eur2010-12-20 06:10:00 sell    .836357085 2010-12-20 06:20:12 2010-12-20 06:20:59 2010-12-20 14:20:59
eur2010-12-20 06:05:00 sell	.82120461 2010-12-20 06:20:58 2010-12-20 06:20:59 2010-12-20 14:20:59
chf2010-12-20 06:35:00 sell    .839859144 2010-12-20 06:44:45 2010-12-20 06:45:32 2010-12-20 14:45:32
chf2010-12-20 06:30:00 sell    .914695354 2010-12-20 06:45:31 2010-12-20 06:45:32 2010-12-20 14:45:32
jpy2010-12-20 06:45:00 sell    .752533557 2010-12-20 06:53:45 2010-12-20 06:54:32 2010-12-20 14:54:32
gbp2010-12-20 07:10:00 sell	.77279009 2010-12-20 07:18:05 2010-12-20 07:18:51 2010-12-20 15:18:51
eur2010-12-20 07:50:00 sell    .872114712 2010-12-20 08:02:17 2010-12-20 08:03:39 2010-12-20 16:03:39
aud2010-12-20 08:30:00 sell    .827406802 2010-12-20 08:45:45 2010-12-20 08:45:45 2010-12-20 16:45:45
eur2010-12-20 08:45:00 sell    .835676948 2010-12-20 08:53:57 2010-12-20 08:54:44 2010-12-20 16:54:44
eur2010-12-20 08:40:00 sell    .773323204 2010-12-20 08:54:44 2010-12-20 08:54:44 2010-12-20 16:54:44
gbp2010-12-20 08:50:00 sell    .772735633 2010-12-20 09:03:49 2010-12-20 09:03:50 2010-12-20 17:03:50
chf2010-12-20 09:05:00 buy     .758301427 2010-12-20 09:19:48 2010-12-20 09:21:25 2010-12-20 17:21:25
eur2010-12-20 09:35:00 sell    .854168181 2010-12-20 09:44:54 2010-12-20 09:45:40 2010-12-20 17:45:40
eur2010-12-20 09:30:00 sell    .837851662 2010-12-20 09:45:40 2010-12-20 09:45:40 2010-12-20 17:45:40
jpy2010-12-20 10:10:00 buy     .787133862 2010-12-20 10:17:46 2010-12-20 10:20:11 2010-12-20 18:20:11
jpy2010-12-20 10:05:00 buy     .827950921 2010-12-20 10:18:35 2010-12-20 10:20:11 2010-12-20 18:20:11
eur2010-12-20 10:25:00 sell    .810837583 2010-12-20 10:37:02 2010-12-20 10:37:50 2010-12-20 18:37:50
eur2010-12-20 10:20:00 sell    .771267591 2010-12-20 10:37:49 2010-12-20 10:37:50 2010-12-20 18:37:50
chf2010-12-20 10:55:00 buy     .832434065 2010-12-20 11:01:33 2010-12-20 11:04:00 2010-12-20 19:04:00
chf2010-12-20 10:50:00 buy     .824378327 2010-12-20 11:02:23 2010-12-20 11:04:00 2010-12-20 19:04:00
eur2010-12-20 11:15:00 sell    .807300033 2010-12-20 11:30:05 2010-12-20 11:30:06 2010-12-20 19:30:06
jpy2010-12-20 11:55:00 buy     .829560561 2010-12-20 12:02:01 2010-12-20 12:04:25 2010-12-20 20:04:25
jpy2010-12-20 11:50:00 buy     .764385691 2010-12-20 12:02:50 2010-12-20 12:04:25 2010-12-20 20:04:25
gbp2010-12-20 12:15:00 sell    .771433832 2010-12-20 12:28:50 2010-12-20 12:28:51 2010-12-20 20:28:51
jpy2010-12-20 12:45:00 buy     .776611907 2010-12-20 12:52:16 2010-12-20 12:54:39 2010-12-20 20:54:39
eur2010-12-20 13:00:00 sell    .883563353 2010-12-20 13:09:41 2010-12-20 13:10:29 2010-12-20 21:10:29
eur2010-12-20 12:55:00 sell    .910884545 2010-12-20 13:10:28 2010-12-20 13:10:29 2010-12-20 21:10:29
jpy2010-12-20 13:35:00 buy     .756960506 2010-12-20 13:42:43 2010-12-20 13:45:08 2010-12-20 21:45:08
jpy2010-12-20 13:30:00 buy     .754511555 2010-12-20 13:43:33 2010-12-20 13:45:08 2010-12-20 21:45:08
eur2010-12-20 13:50:00 sell    .847176169 2010-12-20 14:02:02 2010-12-20 14:02:49 2010-12-20 22:02:49
eur2010-12-20 14:35:00 sell    .752636742 2010-12-20 14:52:38 2010-12-20 14:52:38 2010-12-20 22:52:38
chf2010-12-20 15:55:00 buy	.79715754 2010-12-20 16:05:44 2010-12-20 16:08:09 2010-12-21 00:08:09
chf2010-12-20 15:50:00 buy     .812418972 2010-12-20 16:06:34 2010-12-20 16:08:09 2010-12-21 00:08:09
eur2010-12-20 16:25:00 sell    .861833732 2010-12-20 16:33:31 2010-12-20 16:34:18 2010-12-21 00:34:18
eur2010-12-20 16:20:00 sell    .831771171 2010-12-20 16:34:18 2010-12-20 16:34:18 2010-12-21 00:34:18
cad2010-12-20 20:45:00 buy	.76563585 2010-12-20 20:57:54 2010-12-20 20:59:30 2010-12-21 04:59:30
jpy2010-12-20 22:35:00 sell    .771937532 2010-12-20 22:47:25 2010-12-20 22:48:13 2010-12-21 06:48:13
jpy2010-12-20 22:30:00 sell    .756687486 2010-12-20 22:48:13 2010-12-20 22:48:13 2010-12-21 06:48:13
eur2010-12-20 23:45:00 sell    .751833129 2010-12-20 23:55:07 2010-12-20 23:55:56 2010-12-21 07:55:56
eur2010-12-20 23:40:00 sell    .883575671 2010-12-20 23:55:55 2010-12-20 23:55:56 2010-12-21 07:55:56
gbp2010-12-20 23:55:00 sell    .789868009 2010-12-21 00:04:26 2010-12-21 00:05:15 2010-12-21 08:05:15
chf2010-12-21 00:10:00 sell    .766970722 2010-12-21 00:27:32 2010-12-21 00:27:33 2010-12-21 08:27:33
jpy2010-12-21 00:25:00 sell    .811728051 2010-12-21 00:35:48 2010-12-21 00:36:37 2010-12-21 08:36:37
cad2010-12-21 01:00:00 buy     .771935744 2010-12-21 01:09:11 2010-12-21 01:11:36 2010-12-21 09:11:36

54 rows selected.

Elapsed: 00:00:00.00
02:02:10 SQL> 
02:02:10 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
