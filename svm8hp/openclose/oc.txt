
SQL*Plus: Release 11.2.0.1.0 Production on Tue Dec 21 18:36:02 2010

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

18:36:02 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
18:36:02 SQL> 18:36:02 SQL> --
18:36:02 SQL> -- oc.sql
18:36:02 SQL> --
18:36:02 SQL> 
18:36:02 SQL> -- This script helps me open and close forex positions.
18:36:02 SQL> 
18:36:02 SQL> COLUMN prdate FORMAT A22
18:36:02 SQL> 
18:36:02 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
18:36:02   2  SELECT
18:36:02   3  prdate
18:36:02   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
18:36:02   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
18:36:02   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
18:36:02   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
18:36:02   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
18:36:02   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
18:36:02  10  	ELSE SUBSTR(prdate,1,3)
18:36:02  11  	END    pair
18:36:02  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
18:36:02  13  ,'buy'	 buysell
18:36:02  14  ,score
18:36:02  15  ,rundate
18:36:02  16  ,sysdate opdate
18:36:02  17  -- Deal with Fri-afternoon.
18:36:02  18  -- I want to close Late-Fri-afternoon orders on Mon Morn 01:11 GMT
18:36:02  19  -- This is 09:11am in Tokyo:
18:36:02  20  ,CASE WHEN
18:36:02  21  	(
18:36:02  22  	0+TO_CHAR((sysdate),'D') = 6
18:36:02  23  	AND
18:36:02  24  	sysdate+8/24 > TRUNC(sysdate) + 21/24 + 50/60/24
18:36:02  25  	)
18:36:02  26  	THEN TRUNC(sysdate) + 3 + 1/24 + 11/60/24
18:36:02  27  	WHEN 0+TO_CHAR((sysdate+8/24),'D') = 7
18:36:02  28  	THEN TRUNC(sysdate) + 2 + 1/24 + 11/60/24
18:36:02  29  	ELSE sysdate + 8/24 END clsdate
18:36:02  30  FROM fxscores8hp
18:36:02  31  WHERE score > 0.85
18:36:02  32  AND rundate > sysdate - 1/24
18:36:02  33  AND prdate NOT IN(SELECT prdate FROM oc)
18:36:02  34  ORDER BY rundate
18:36:02  35  /

0 rows created.

Elapsed: 00:00:00.00
18:36:02 SQL> 
18:36:02 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
18:36:02   2  SELECT
18:36:02   3  prdate
18:36:02   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
18:36:02   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
18:36:02   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
18:36:02   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
18:36:02   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
18:36:02   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
18:36:02  10  	ELSE SUBSTR(prdate,1,3)
18:36:02  11  	END pair
18:36:02  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
18:36:02  13  ,'sell'	      buysell
18:36:02  14  ,score
18:36:02  15  ,rundate
18:36:02  16  ,sysdate opdate
18:36:02  17  -- Deal with Fri-afternoon.
18:36:02  18  -- I want to close Fri-afternoon orders on Mon Morn 01:11 GMT:
18:36:02  19  ,CASE WHEN
18:36:02  20  	(
18:36:02  21  	0+TO_CHAR((sysdate),'D') = 6
18:36:02  22  	AND
18:36:02  23  	sysdate+8/24 > TRUNC(sysdate) + 21/24 + 50/60/24
18:36:02  24  	)
18:36:02  25  	THEN TRUNC(sysdate) + 3 + 1/24 + 11/60/24
18:36:02  26  	WHEN 0+TO_CHAR((sysdate+8/24),'D') = 7
18:36:02  27  	THEN TRUNC(sysdate) + 2 + 1/24 + 11/60/24
18:36:02  28  	ELSE sysdate + 8/24 END clsdate
18:36:02  29  FROM fxscores8hp_gattn
18:36:02  30  WHERE score > 0.85
18:36:02  31  AND rundate > sysdate - 1/24
18:36:02  32  AND prdate NOT IN(SELECT prdate FROM oc)
18:36:02  33  ORDER BY rundate
18:36:02  34  /

0 rows created.

Elapsed: 00:00:00.00
18:36:02 SQL> 
18:36:02 SQL> -- rpt:
18:36:02 SQL> 
18:36:02 SQL> SELECT
18:36:02   2  prdate,buysell,score,rundate,opdate,clsdate
18:36:02   3  FROM oc
18:36:02   4  WHERE rundate > sysdate - 1
18:36:02   5  ORDER BY rundate
18:36:02   6  /

PRDATE		       BUYSELL	    SCORE RUNDATE	      OPDATE		  CLSDATE
---------------------- ------- ---------- ------------------- ------------------- -------------------
cad2010-12-20 20:45:00 buy	.76563585 2010-12-20 20:57:54 2010-12-20 20:59:30 2010-12-21 04:59:30
jpy2010-12-20 22:35:00 sell    .771937532 2010-12-20 22:47:25 2010-12-20 22:48:13 2010-12-21 06:48:13
jpy2010-12-20 22:30:00 sell    .756687486 2010-12-20 22:48:13 2010-12-20 22:48:13 2010-12-21 06:48:13
eur2010-12-20 23:45:00 sell    .751833129 2010-12-20 23:55:07 2010-12-20 23:55:56 2010-12-21 07:55:56
eur2010-12-20 23:40:00 sell    .883575671 2010-12-20 23:55:55 2010-12-20 23:55:56 2010-12-21 07:55:56
gbp2010-12-20 23:55:00 sell    .789868009 2010-12-21 00:04:26 2010-12-21 00:05:15 2010-12-21 08:05:15
chf2010-12-21 00:10:00 sell    .766970722 2010-12-21 00:27:32 2010-12-21 00:27:33 2010-12-21 08:27:33
jpy2010-12-21 00:25:00 sell    .811728051 2010-12-21 00:35:48 2010-12-21 00:36:37 2010-12-21 08:36:37
cad2010-12-21 01:00:00 buy     .771935744 2010-12-21 01:09:11 2010-12-21 01:11:36 2010-12-21 09:11:36
chf2010-12-21 02:00:00 sell    .828041447 2010-12-21 02:10:01 2010-12-21 02:10:54 2010-12-21 10:10:54
chf2010-12-21 01:55:00 sell	.83825362 2010-12-21 02:10:53 2010-12-21 02:10:54 2010-12-21 10:10:54
jpy2010-12-21 02:05:00 sell    .756630738 2010-12-21 02:20:06 2010-12-21 02:20:06 2010-12-21 10:20:06
chf2010-12-21 02:45:00 sell    .768025716 2010-12-21 03:00:29 2010-12-21 03:00:29 2010-12-21 11:00:29
jpy2010-12-21 02:55:00 sell    .799002562 2010-12-21 03:09:23 2010-12-21 03:09:23 2010-12-21 11:09:23
eur2010-12-21 03:15:00 sell    .961757607 2010-12-21 03:24:31 2010-12-21 03:25:20 2010-12-21 11:25:20
cad2010-12-21 03:30:00 buy	.80203663 2010-12-21 03:40:26 2010-12-21 03:43:07 2010-12-21 11:43:07
cad2010-12-21 04:15:00 buy	.83760281 2010-12-21 04:30:35 2010-12-21 04:32:11 2010-12-21 12:32:11
jpy2010-12-21 05:20:00 sell    .899099667 2010-12-21 05:31:50 2010-12-21 05:31:50 2010-12-21 13:31:50
gbp2010-12-21 05:45:00 sell    .901388672 2010-12-21 05:57:14 2010-12-21 05:58:01 2010-12-21 13:58:01
gbp2010-12-21 05:40:00 sell    .752246106 2010-12-21 05:58:00 2010-12-21 05:58:01 2010-12-21 13:58:01
cad2010-12-21 05:55:00 buy     .780633501 2010-12-21 06:04:42 2010-12-21 06:07:10 2010-12-21 14:07:10
eur2010-12-21 06:30:00 sell    .755195678 2010-12-21 06:39:38 2010-12-21 06:40:26 2010-12-21 14:40:26
gbp2010-12-21 06:35:00 sell    .755149539 2010-12-21 06:49:21 2010-12-21 06:49:22 2010-12-21 14:49:22
cad2010-12-21 07:30:00 buy	.85753358 2010-12-21 07:44:09 2010-12-21 07:45:47 2010-12-21 15:45:47
jpy2010-12-21 07:50:00 buy     .845573068 2010-12-21 08:07:26 2010-12-21 08:10:12 2010-12-21 16:10:12
aud2010-12-21 08:05:00 sell    .843660634 2010-12-21 08:19:41 2010-12-21 08:19:41 2010-12-21 16:19:41
eur2010-12-21 08:15:00 sell    .765987022 2010-12-21 08:27:13 2010-12-21 08:27:14 2010-12-21 16:27:14
jpy2010-12-21 08:45:00 buy     .752211261 2010-12-21 08:59:13 2010-12-21 09:00:52 2010-12-21 17:00:52
jpy2010-12-21 09:35:00 sell	.79113929 2010-12-21 09:51:35 2010-12-21 09:51:36 2010-12-21 17:51:36
jpy2010-12-21 10:30:00 buy     .801273209 2010-12-21 10:41:32 2010-12-21 10:42:22 2010-12-21 18:42:22
jpy2010-12-21 12:10:00 buy     .828290223 2010-12-21 12:20:29 2010-12-21 12:22:56 2010-12-21 20:22:56
chf2010-12-21 12:55:00 sell    .793056867 2010-12-21 13:03:52 2010-12-21 13:04:41 2010-12-21 21:04:41
gbp2010-12-21 14:10:00 sell    .780221348 2010-12-21 14:28:08 2010-12-21 14:28:08 2010-12-21 22:28:08
jpy2010-12-21 14:40:00 buy     .828531122 2010-12-21 14:52:45 2010-12-21 14:54:23 2010-12-21 22:54:23
aud2010-12-21 14:50:00 sell    .798293783 2010-12-21 15:01:44 2010-12-21 15:01:45 2010-12-21 23:01:45
chf2010-12-21 15:25:00 sell    .751835521 2010-12-21 15:35:45 2010-12-21 15:36:33 2010-12-21 23:36:33
jpy2010-12-21 16:20:00 buy     .753141544 2010-12-21 16:31:37 2010-12-21 16:32:27 2010-12-22 00:32:27
eur2010-12-21 16:35:00 sell	.76829023 2010-12-21 16:50:04 2010-12-21 16:50:04 2010-12-22 00:50:04
chf2010-12-21 17:00:00 sell    .812007682 2010-12-21 17:14:48 2010-12-21 17:14:48 2010-12-22 01:14:48

39 rows selected.

Elapsed: 00:00:00.01
18:36:02 SQL> 
18:36:02 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
