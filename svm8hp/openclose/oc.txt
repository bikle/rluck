
SQL*Plus: Release 11.2.0.1.0 Production on Mon Dec 20 06:36:58 2010

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

06:36:58 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
06:36:58 SQL> 06:36:58 SQL> --
06:36:58 SQL> -- oc.sql
06:36:58 SQL> --
06:36:58 SQL> 
06:36:58 SQL> -- This script helps me open and close forex positions.
06:36:58 SQL> 
06:36:58 SQL> COLUMN prdate FORMAT A22
06:36:58 SQL> 
06:36:58 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
06:36:58   2  SELECT
06:36:58   3  prdate
06:36:58   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
06:36:58   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
06:36:58   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
06:36:58   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
06:36:58   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
06:36:58   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
06:36:58  10  	ELSE SUBSTR(prdate,1,3)
06:36:58  11  	END    pair
06:36:58  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
06:36:58  13  ,'buy'	 buysell
06:36:58  14  ,score
06:36:58  15  ,rundate
06:36:58  16  ,sysdate opdate
06:36:58  17  -- Deal with Fri-afternoon.
06:36:58  18  -- I want to close Late-Fri-afternoon orders on Mon Morn 01:11 GMT
06:36:58  19  -- This is 09:11am in Tokyo:
06:36:58  20  ,CASE WHEN
06:36:58  21  	(
06:36:58  22  	0+TO_CHAR((sysdate),'D') = 6
06:36:58  23  	AND
06:36:58  24  	sysdate+8/24 > TRUNC(sysdate) + 21/24 + 50/60/24
06:36:58  25  	)
06:36:58  26  	THEN TRUNC(sysdate) + 3 + 1/24 + 11/60/24
06:36:58  27  	WHEN 0+TO_CHAR((sysdate+8/24),'D') = 7
06:36:58  28  	THEN TRUNC(sysdate) + 2 + 1/24 + 11/60/24
06:36:58  29  	ELSE sysdate + 8/24 END clsdate
06:36:58  30  FROM fxscores8hp
06:36:58  31  WHERE score > 0.75
06:36:58  32  AND rundate > sysdate - 1/24
06:36:58  33  AND prdate NOT IN(SELECT prdate FROM oc)
06:36:58  34  ORDER BY rundate
06:36:58  35  /

0 rows created.

Elapsed: 00:00:00.01
06:36:58 SQL> 
06:36:58 SQL> INSERT INTO oc(prdate,pair,ydate,buysell,score,rundate,opdate,clsdate)
06:36:58   2  SELECT
06:36:58   3  prdate
06:36:58   4  ,CASE WHEN SUBSTR(prdate,1,3)='aud'THEN'aud_usd'
06:36:58   5  	    WHEN SUBSTR(prdate,1,3)='eur'THEN'eur_usd'
06:36:58   6  	    WHEN SUBSTR(prdate,1,3)='gbp'THEN'gbp_usd'
06:36:58   7  	    WHEN SUBSTR(prdate,1,3)='cad'THEN'usd_cad'
06:36:58   8  	    WHEN SUBSTR(prdate,1,3)='chf'THEN'usd_chf'
06:36:58   9  	    WHEN SUBSTR(prdate,1,3)='jpy'THEN'usd_jpy'
06:36:58  10  	ELSE SUBSTR(prdate,1,3)
06:36:58  11  	END pair
06:36:58  12  ,TO_DATE(SUBSTR(prdate,4,19))ydate
06:36:58  13  ,'sell'	      buysell
06:36:58  14  ,score
06:36:58  15  ,rundate
06:36:58  16  ,sysdate opdate
06:36:58  17  -- Deal with Fri-afternoon.
06:36:58  18  -- I want to close Fri-afternoon orders on Mon Morn 01:11 GMT:
06:36:58  19  ,CASE WHEN
06:36:58  20  	(
06:36:58  21  	0+TO_CHAR((sysdate),'D') = 6
06:36:58  22  	AND
06:36:58  23  	sysdate+8/24 > TRUNC(sysdate) + 21/24 + 50/60/24
06:36:58  24  	)
06:36:58  25  	THEN TRUNC(sysdate) + 3 + 1/24 + 11/60/24
06:36:58  26  	WHEN 0+TO_CHAR((sysdate+8/24),'D') = 7
06:36:58  27  	THEN TRUNC(sysdate) + 2 + 1/24 + 11/60/24
06:36:58  28  	ELSE sysdate + 8/24 END clsdate
06:36:58  29  FROM fxscores8hp_gattn
06:36:58  30  WHERE score > 0.75
06:36:58  31  AND rundate > sysdate - 1/24
06:36:58  32  AND prdate NOT IN(SELECT prdate FROM oc)
06:36:58  33  ORDER BY rundate
06:36:58  34  /

0 rows created.

Elapsed: 00:00:00.00
06:36:58 SQL> 
06:36:58 SQL> -- rpt:
06:36:58 SQL> 
06:36:58 SQL> SELECT
06:36:58   2  prdate,buysell,score,rundate,opdate,clsdate
06:36:58   3  FROM oc
06:36:58   4  WHERE rundate > sysdate - 1
06:36:58   5  ORDER BY rundate
06:36:58   6  /

PRDATE		       BUYSELL	    SCORE RUNDATE	      OPDATE		  CLSDATE
---------------------- ------- ---------- ------------------- ------------------- -------------------
aud2010-12-20 00:30:00 sell    .892922546 2010-12-20 00:41:20 2010-12-20 01:31:07 2010-12-20 09:31:07
aud2010-12-20 00:25:00 sell    .910197321 2010-12-20 00:42:07 2010-12-20 01:31:07 2010-12-20 09:31:07
chf2010-12-20 01:55:00 sell    .753926973 2010-12-20 02:03:20 2010-12-20 02:04:11 2010-12-20 10:04:11
chf2010-12-20 01:50:00 sell    .765492297 2010-12-20 02:04:11 2010-12-20 02:04:11 2010-12-20 10:04:11
chf2010-12-20 03:15:00 sell    .896475498 2010-12-20 03:27:08 2010-12-20 03:27:56 2010-12-20 11:27:56
chf2010-12-20 03:10:00 sell    .869827481 2010-12-20 03:27:56 2010-12-20 03:27:56 2010-12-20 11:27:56
jpy2010-12-20 03:25:00 sell	.80207889 2010-12-20 03:36:11 2010-12-20 03:36:58 2010-12-20 11:36:58
aud2010-12-20 03:35:00 buy     .853603084 2010-12-20 03:43:23 2010-12-20 03:45:49 2010-12-20 11:45:49
gbp2010-12-20 03:50:00 buy     .780679896 2010-12-20 04:00:48 2010-12-20 04:01:38 2010-12-20 12:01:38
chf2010-12-20 04:10:00 sell    .865398365 2010-12-20 04:18:04 2010-12-20 04:18:51 2010-12-20 12:18:51
chf2010-12-20 04:05:00 sell    .801972451 2010-12-20 04:18:51 2010-12-20 04:18:51 2010-12-20 12:18:51
gbp2010-12-20 04:40:00 buy     .795375737 2010-12-20 04:51:03 2010-12-20 04:51:53 2010-12-20 12:51:53
eur2010-12-20 06:10:00 sell    .836357085 2010-12-20 06:20:12 2010-12-20 06:20:59 2010-12-20 14:20:59
eur2010-12-20 06:05:00 sell	.82120461 2010-12-20 06:20:58 2010-12-20 06:20:59 2010-12-20 14:20:59

14 rows selected.

Elapsed: 00:00:00.00
06:36:58 SQL> 
06:36:58 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
