
SQL*Plus: Release 11.2.0.1.0 Production on Sat Jan 22 01:17:37 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

01:17:38 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
01:17:38 SQL> 01:17:38 SQL> --
01:17:38 SQL> -- merge.sql
01:17:38 SQL> --
01:17:38 SQL> 
01:17:38 SQL> -- I use this script to merge data from ibs_stage into ibs15min.
01:17:38 SQL> 
01:17:38 SQL> 
01:17:38 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
01:17:38 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
01:17:38 SQL> 
01:17:38 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.39
01:17:38 SQL> RENAME ibs15min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.03
01:17:38 SQL> 
01:17:38 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.18
01:17:38 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.04
01:17:38 SQL> 
01:17:38 SQL> CREATE TABLE ibs_dups COMPRESS AS
01:17:38   2  SELECT
01:17:38   3  tkr
01:17:38   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
01:17:38   5  ,clse
01:17:38   6  FROM ibs_stage
01:17:38   7  UNION
01:17:38   8  SELECT tkr,ydate,clse
01:17:38   9  FROM ibs_old
01:17:38  10  /

Table created.

Elapsed: 00:00:00.62
01:17:39 SQL> 
01:17:39 SQL> CREATE TABLE ibs15min COMPRESS AS
01:17:39   2  SELECT
01:17:39   3  tkr
01:17:39   4  ,ydate
01:17:39   5  ,AVG(clse)clse
01:17:39   6  FROM ibs_dups
01:17:39   7  GROUP BY tkr,ydate
01:17:39   8  /

Table created.

Elapsed: 00:00:00.53
01:17:39 SQL> 
01:17:39 SQL> ANALYZE TABLE ibs15min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:00.70
01:17:40 SQL> 
01:17:40 SQL> -- rpt
01:17:40 SQL> 
01:17:40 SQL> SELECT
01:17:40   2  tkr
01:17:40   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
01:17:40   4  ,MIN(ydate)
01:17:40   5  ,COUNT(ydate)
01:17:40   6  ,MAX(ydate)FROM
01:17:40   7  ibs15min
01:17:40   8  GROUP BY tkr
01:17:40   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	  62.6666667 2010-12-27 13:00:00	  877 2011-01-22 00:15:00
AKAM	  62.6666667 2010-12-27 12:45:00	  890 2011-01-22 00:15:00
APA	  47.6666667 2010-12-27 12:45:00	  873 2011-01-22 00:30:00
APC	  47.6666667 2010-12-27 14:15:00	  920 2011-01-22 00:30:00
AXP	  47.6666667 2010-12-27 13:00:00	  913 2011-01-22 00:30:00
BP	  47.6666667 2010-12-27 13:00:00	 1153 2011-01-22 00:30:00
BTU	  47.6666667 2010-12-27 12:45:00	  924 2011-01-22 00:30:00
CAT	  47.6666667 2010-12-27 12:45:00	  936 2011-01-22 00:30:00
CVS	  47.6666667 2010-12-27 14:30:00	  839 2011-01-22 00:30:00
MAR	  32.6666667 2010-12-27 14:30:00	  808 2011-01-22 00:45:00
MDT	  32.6666667 2010-12-27 13:45:00	  882 2011-01-22 00:45:00
QQQQ	  32.6666667 2010-12-27 09:00:00	 1192 2011-01-22 00:45:00
SINA	  32.6666667 2010-12-27 14:15:00	  871 2011-01-22 00:45:00
SPY	  32.6666667 2010-12-27 09:00:00	 1213 2011-01-22 00:45:00
V	  32.6666667 2010-12-27 12:30:00	  968 2011-01-22 00:45:00
VECO	  32.6666667 2010-12-27 14:30:00	  892 2011-01-22 00:45:00
WDC	  32.6666667 2010-12-27 09:15:00	  886 2011-01-22 00:45:00
XOM	  32.6666667 2010-12-27 13:00:00	  998 2011-01-22 00:45:00
AFL	  62.6666667 2010-12-27 14:30:00	  823 2011-01-22 00:15:00
AMT	  62.6666667 2010-12-27 13:00:00	  853 2011-01-22 00:15:00
CTSH	  47.6666667 2010-12-27 14:30:00	  878 2011-01-22 00:30:00
IOC	  32.6666667 2010-12-27 14:30:00	  807 2011-01-22 00:45:00
JPM	  32.6666667 2010-12-27 13:00:00	 1005 2011-01-22 00:45:00
SKX	  32.6666667 2010-12-27 12:00:00	  873 2011-01-22 00:45:00
SLB	  32.6666667 2010-12-27 09:15:00	 1002 2011-01-22 00:45:00
STT	  32.6666667 2010-12-27 14:30:00	  840 2011-01-22 00:45:00
UNH	  32.6666667 2010-12-27 13:00:00	  871 2011-01-22 00:45:00
UNP	  32.6666667 2010-12-27 14:30:00	  868 2011-01-22 00:45:00
AIG	  62.6666667 2010-12-27 13:30:00	 1048 2011-01-22 00:15:00
BBY	  47.6666667 2010-12-27 12:00:00	  942 2011-01-22 00:30:00
CSX	  47.6666667 2010-12-27 14:30:00	  853 2011-01-22 00:30:00
CVX	  47.6666667 2010-12-27 13:00:00	  916 2011-01-22 00:30:00
DD	  47.6666667 2010-12-27 11:30:00	  901 2011-01-22 00:30:00
EOG	  47.6666667 2010-12-27 14:30:00	  840 2011-01-22 00:30:00
FCX	  47.6666667 2010-12-27 12:45:00	 1025 2011-01-22 00:30:00
FSLR	  32.6666667 2010-12-27 13:00:00	  845 2011-01-22 00:45:00
HD	  32.6666667 2010-12-27 12:30:00	  901 2011-01-22 00:45:00
HON	  32.6666667 2010-12-27 14:15:00	  835 2011-01-22 00:45:00
IBM	  32.6666667 2010-12-27 12:45:00	 1014 2011-01-22 00:45:00
IWM	  32.6666667 2010-12-27 11:00:00	 1116 2011-01-22 00:45:00
MEE	  32.6666667 2010-12-27 13:15:00	  887 2011-01-22 00:45:00
NFLX	  32.6666667 2010-12-27 12:30:00	  952 2011-01-22 00:45:00
PRU	  32.6666667 2010-12-27 13:45:00	  855 2011-01-22 00:45:00
UPS	  32.6666667 2010-12-27 14:30:00	  840 2011-01-22 00:45:00
WHR	  32.6666667 2010-12-27 14:30:00	  819 2011-01-22 00:45:00
XLB	  32.6666667 2010-12-27 13:30:00	  844 2011-01-22 00:45:00
XLE	  32.6666667 2010-12-27 13:00:00	  915 2011-01-22 00:45:00
BEN	  47.6666667 2010-12-27 13:00:00	  846 2011-01-22 00:30:00
CMI	  47.6666667 2010-12-27 12:30:00	  878 2011-01-22 00:30:00
COST	  47.6666667 2010-12-27 14:30:00	  866 2011-01-22 00:30:00
DTV	  47.6666667 2010-12-27 14:30:00	  837 2011-01-22 00:30:00
ESRX	  47.6666667 2010-12-27 14:30:00	  835 2011-01-22 00:30:00
GG	  32.6666667 2010-12-27 13:15:00	  943 2011-01-22 00:45:00
HPQ	  32.6666667 2010-12-27 12:15:00	 1024 2011-01-22 00:45:00
KO	  32.6666667 2010-12-27 12:30:00	 1022 2011-01-22 00:45:00
MDY	  32.6666667 2010-12-27 13:15:00	  923 2011-01-22 00:45:00
MET	  32.6666667 2010-12-27 14:30:00	  831 2011-01-22 00:45:00
PNC	  32.6666667 2010-12-27 14:15:00	  893 2011-01-22 00:45:00
SJM	  32.6666667 2010-12-27 14:30:00	  810 2011-01-22 00:45:00
SNDK	  32.6666667 2010-12-27 13:00:00	  951 2011-01-22 00:45:00
SUN	  32.6666667 2010-12-27 14:30:00	  821 2011-01-22 00:45:00
TGT	  32.6666667 2010-12-27 14:15:00	  915 2011-01-22 00:45:00
XLU	  32.6666667 2010-12-27 14:30:00	  813 2011-01-22 00:45:00
ABT	  62.6666667 2010-12-27 12:30:00	  965 2011-01-22 00:15:00
AMGN	  62.6666667 2010-12-27 14:00:00	  845 2011-01-22 00:15:00
AMZN	  47.6666667 2010-12-27 11:15:00	 1073 2011-01-22 00:30:00
BHP	  47.6666667 2010-12-27 12:15:00	 1142 2011-01-22 00:30:00
COF	  47.6666667 2010-12-27 14:30:00	  842 2011-01-22 00:30:00
DNDN	  47.6666667 2010-12-27 14:15:00	  870 2011-01-22 00:30:00
FDX	  47.6666667 2010-12-27 12:30:00	  858 2011-01-22 00:30:00
GLD	  32.6666667 2010-12-27 11:00:00	 1169 2011-01-22 00:45:00
JNJ	  32.6666667 2010-12-27 11:15:00	 1028 2011-01-22 00:45:00
LFT	  32.6666667 2010-12-27 14:00:00	  817 2011-01-22 00:45:00
MOS	  32.6666667 2010-12-27 13:30:00	  976 2011-01-22 00:45:00
NEM	  32.6666667 2010-12-27 14:15:00	  980 2011-01-22 00:45:00
OXY	  32.6666667 2010-12-27 14:30:00	  886 2011-01-22 00:45:00
PEP	  32.6666667 2010-12-27 14:15:00	  875 2011-01-22 00:45:00
PG	  32.6666667 2010-12-27 11:30:00	  959 2011-01-22 00:45:00
RIG	  32.6666667 2010-12-27 12:00:00	 1124 2011-01-22 00:45:00
BA	  47.6666667 2010-12-27 13:00:00	  911 2011-01-22 00:30:00
BBT	  47.6666667 2010-12-27 14:15:00	  876 2011-01-22 00:30:00
BIDU	  47.6666667 2010-12-27 12:15:00	  975 2011-01-22 00:30:00
BRCM	  47.6666667 2010-12-27 14:30:00	  909 2011-01-22 00:30:00
CELG	  47.6666667 2010-12-27 14:30:00	  829 2011-01-22 00:30:00
CREE	  47.6666667 2010-12-27 14:00:00	  903 2011-01-22 00:30:00
DE	  47.6666667 2010-12-27 13:00:00	  916 2011-01-22 00:30:00
DIS	  47.6666667 2010-12-27 13:00:00	  871 2011-01-22 00:30:00
EWZ	  47.6666667 2010-12-27 09:00:00	 1136 2011-01-22 00:30:00
FFIV	  47.6666667 2010-12-27 12:30:00	  903 2011-01-22 00:30:00
GDX	  32.6666667 2010-12-27 13:00:00	  991 2011-01-22 00:45:00
GILD	  32.6666667 2010-12-27 13:30:00	  875 2011-01-22 00:45:00
GOOG	  32.6666667 2010-12-27 09:15:00	 1033 2011-01-22 00:45:00
GS	  32.6666667 2010-12-27 13:00:00	  987 2011-01-22 00:45:00
HES	  32.6666667 2010-12-27 14:30:00	  919 2011-01-22 00:45:00
MMM	  32.6666667 2010-12-27 13:30:00	  900 2011-01-22 00:45:00
MON	  32.6666667 2010-12-27 13:30:00	  921 2011-01-22 00:45:00
MT	  32.6666667 2010-12-27 12:45:00	 1149 2011-01-22 00:45:00
PBR	  32.6666667 2010-12-27 13:00:00	  999 2011-01-22 00:45:00
PM	  32.6666667 2010-12-27 13:30:00	  870 2011-01-22 00:45:00
POT	  32.6666667 2010-12-27 12:15:00	  981 2011-01-22 00:45:00
TEVA	  32.6666667 2010-12-27 13:00:00	  951 2011-01-22 00:45:00
TLT	  32.6666667 2010-12-27 12:30:00	  969 2011-01-22 00:45:00
VMW	  32.6666667 2010-12-27 14:30:00	  896 2011-01-22 00:45:00
WFMI	  32.6666667 2010-12-27 14:30:00	  851 2011-01-22 00:45:00
X	  32.6666667 2010-12-27 13:00:00	 1020 2011-01-22 00:45:00
AAPL	  62.6666667 2010-12-27 09:00:00	 1178 2011-01-22 00:15:00
ALL	  62.6666667 2010-12-27 14:30:00	  832 2011-01-22 00:15:00
BUCY	  47.6666667 2010-12-27 14:15:00	  846 2011-01-22 00:30:00
CRM	  47.6666667 2010-12-27 13:00:00	  925 2011-01-22 00:30:00
DVN	  47.6666667 2010-12-27 13:00:00	  867 2011-01-22 00:30:00
FLS	  47.6666667 2010-12-27 14:30:00	  820 2011-01-22 00:30:00
JOYG	  32.6666667 2010-12-27 14:30:00	  873 2011-01-22 00:45:00
NUE	  32.6666667 2010-12-27 13:45:00	  869 2011-01-22 00:45:00
QCOM	  32.6666667 2010-12-27 13:00:00	  909 2011-01-22 00:45:00
SLV	  32.6666667 2010-12-27 09:30:00	 1173 2011-01-22 00:45:00
ABX	  62.6666667 2010-12-27 14:30:00	  977 2011-01-22 00:15:00
AEM	  62.6666667 2010-12-27 14:30:00	  886 2011-01-22 00:15:00
AMX	  62.6666667 2010-12-27 14:30:00	  811 2011-01-22 00:15:00
ARG	  47.6666667 2010-12-27 14:00:00	  844 2011-01-22 00:30:00
CLF	  47.6666667 2010-12-27 12:30:00	  918 2011-01-22 00:30:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
COP	  47.6666667 2010-12-27 13:00:00	  932 2011-01-22 00:30:00
DIA	  47.6666667 2010-12-27 12:00:00	 1057 2011-01-22 00:30:00
EFA	  47.6666667 2010-12-27 14:00:00	  928 2011-01-22 00:30:00
JWN	  32.6666667 2010-12-27 13:45:00	  825 2011-01-22 00:45:00
MCD	  32.6666667 2010-12-27 10:30:00	 1038 2011-01-22 00:45:00
MJN	  32.6666667 2010-12-27 14:30:00	  812 2011-01-22 00:45:00
MRK	  32.6666667 2010-12-27 13:30:00	  907 2011-01-22 00:45:00
OIH	  32.6666667 2010-12-27 14:30:00	  901 2011-01-22 00:45:00
RIMM	  32.6666667 2010-12-27 12:45:00	  946 2011-01-22 00:45:00
WMT	  32.6666667 2010-12-27 13:30:00	  877 2011-01-22 00:45:00
WYNN	  32.6666667 2010-12-27 13:45:00	  887 2011-01-22 00:45:00

131 rows selected.

Elapsed: 00:00:00.07
01:17:40 SQL> 
01:17:40 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
