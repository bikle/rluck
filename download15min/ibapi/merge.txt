
SQL*Plus: Release 11.2.0.1.0 Production on Tue Feb 1 06:51:36 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

06:51:36 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
06:51:36 SQL> 06:51:36 SQL> --
06:51:36 SQL> -- merge.sql
06:51:36 SQL> --
06:51:36 SQL> 
06:51:36 SQL> -- I use this script to merge data from ibs_stage into ibs15min.
06:51:36 SQL> 
06:51:36 SQL> 
06:51:36 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
06:51:36 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
06:51:36 SQL> 
06:51:36 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.05
06:51:36 SQL> RENAME ibs15min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.04
06:51:36 SQL> 
06:51:36 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.06
06:51:36 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.03
06:51:36 SQL> 
06:51:36 SQL> CREATE TABLE ibs_dups COMPRESS AS
06:51:36   2  SELECT
06:51:36   3  tkr
06:51:36   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
06:51:36   5  ,clse
06:51:36   6  FROM ibs_stage
06:51:36   7  UNION
06:51:36   8  SELECT tkr,ydate,clse
06:51:36   9  FROM ibs_old
06:51:36  10  /

Table created.

Elapsed: 00:00:00.74
06:51:37 SQL> 
06:51:37 SQL> CREATE TABLE ibs15min COMPRESS AS
06:51:37   2  SELECT
06:51:37   3  tkr
06:51:37   4  ,ydate
06:51:37   5  ,AVG(clse)clse
06:51:37   6  FROM ibs_dups
06:51:37   7  GROUP BY tkr,ydate
06:51:37   8  /

Table created.

Elapsed: 00:00:00.37
06:51:37 SQL> 
06:51:37 SQL> ANALYZE TABLE ibs15min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:00.94
06:51:38 SQL> 
06:51:38 SQL> -- rpt
06:51:38 SQL> 
06:51:38 SQL> SELECT
06:51:38   2  tkr
06:51:38   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
06:51:38   4  ,MIN(ydate)
06:51:38   5  ,COUNT(ydate)
06:51:38   6  ,MAX(ydate)FROM
06:51:38   7  ibs15min
06:51:38   8  GROUP BY tkr
06:51:38   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	  381.633333 2010-12-27 13:00:00	 1156 2011-02-01 00:30:00
AKAM	  381.633333 2010-12-27 12:45:00	 1179 2011-02-01 00:30:00
APA	  381.633333 2010-12-27 12:45:00	 1158 2011-02-01 00:30:00
APC	  381.633333 2010-12-27 14:15:00	 1207 2011-02-01 00:30:00
AXP	  381.633333 2010-12-27 13:00:00	 1207 2011-02-01 00:30:00
BP	  381.633333 2010-12-27 13:00:00	 1530 2011-02-01 00:30:00
BTU	  381.633333 2010-12-27 12:45:00	 1220 2011-02-01 00:30:00
CAT	  381.633333 2010-12-27 12:45:00	 1241 2011-02-01 00:30:00
CVS	  381.633333 2010-12-27 14:30:00	 1118 2011-02-01 00:30:00
HL	  366.633333 2011-01-18 12:30:00	  518 2011-02-01 00:45:00
MAR	  366.633333 2010-12-27 14:30:00	 1066 2011-02-01 00:45:00
MDT	  366.633333 2010-12-27 13:45:00	 1158 2011-02-01 00:45:00
QQQQ	  366.633333 2010-12-27 09:00:00	 1564 2011-02-01 00:45:00
SINA	  366.633333 2010-12-27 14:15:00	 1143 2011-02-01 00:45:00
SLW	  396.633333 2011-01-18 09:15:00	  600 2011-02-01 00:15:00
SPY	  366.633333 2010-12-27 09:00:00	 1597 2011-02-01 00:45:00
SVM	  396.633333 2011-01-18 13:00:00	  477 2011-02-01 00:15:00
V	  366.633333 2010-12-27 12:30:00	 1292 2011-02-01 00:45:00
VECO	  366.633333 2010-12-27 14:30:00	 1186 2011-02-01 00:45:00
WDC	  366.633333 2010-12-27 09:15:00	 1164 2011-02-01 00:45:00
XOM	  366.633333 2010-12-27 13:00:00	 1313 2011-02-01 00:45:00
AFL	  381.633333 2010-12-27 14:30:00	 1084 2011-02-01 00:30:00
AMT	  381.633333 2010-12-27 13:00:00	 1115 2011-02-01 00:30:00
AXU	  396.633333 2011-01-18 13:00:00	  441 2011-02-01 00:15:00
CTSH	  381.633333 2010-12-27 14:30:00	 1140 2011-02-01 00:30:00
IOC	  366.633333 2010-12-27 14:30:00	 1061 2011-02-01 00:45:00
JPM	  366.633333 2010-12-27 13:00:00	 1333 2011-02-01 00:45:00
SKX	  366.633333 2010-12-27 12:00:00	 1150 2011-02-01 00:45:00
SLB	  366.633333 2010-12-27 09:15:00	 1347 2011-02-01 00:45:00
STT	  366.633333 2010-12-27 14:30:00	 1094 2011-02-01 00:45:00
UNH	  366.633333 2010-12-27 13:00:00	 1153 2011-02-01 00:45:00
UNP	  366.633333 2010-12-27 14:30:00	 1137 2011-02-01 00:45:00
AIG	  381.633333 2010-12-27 13:30:00	 1372 2011-02-01 00:30:00
BBY	  381.633333 2010-12-27 12:00:00	 1223 2011-02-01 00:30:00
CDE	  396.633333 2011-01-18 11:45:00	  500 2011-02-01 00:15:00
CSX	  381.633333 2010-12-27 14:30:00	 1146 2011-02-01 00:30:00
CVX	  381.633333 2010-12-27 13:00:00	 1212 2011-02-01 00:30:00
DD	  381.633333 2010-12-27 11:30:00	 1196 2011-02-01 00:30:00
EOG	  366.633333 2010-12-27 14:30:00	 1116 2011-02-01 00:45:00
FCX	  366.633333 2010-12-27 12:45:00	 1365 2011-02-01 00:45:00
FSLR	  366.633333 2010-12-27 13:00:00	 1131 2011-02-01 00:45:00
HD	  366.633333 2010-12-27 12:30:00	 1202 2011-02-01 00:45:00
HON	  366.633333 2010-12-27 14:15:00	 1117 2011-02-01 00:45:00
IBM	  366.633333 2010-12-27 12:45:00	 1316 2011-02-01 00:45:00
IWM	  366.633333 2010-12-27 11:00:00	 1478 2011-02-01 00:45:00
MEE	  366.633333 2010-12-27 13:15:00	 1196 2011-02-01 00:45:00
NFLX	  366.633333 2010-12-27 12:30:00	 1268 2011-02-01 00:45:00
PRU	  366.633333 2010-12-27 13:45:00	 1112 2011-02-01 00:45:00
UPS	  366.633333 2010-12-27 14:30:00	 1111 2011-02-01 00:45:00
WHR	  366.633333 2010-12-27 14:30:00	 1082 2011-02-01 00:45:00
XLB	  366.633333 2010-12-27 13:30:00	 1106 2011-02-01 00:45:00
XLE	  366.633333 2010-12-27 13:00:00	 1199 2011-02-01 00:45:00
BEN	  381.633333 2010-12-27 13:00:00	 1107 2011-02-01 00:30:00
CHK	  396.633333 2011-01-18 13:00:00	  501 2011-02-01 00:15:00
CMI	  381.633333 2010-12-27 12:30:00	 1152 2011-02-01 00:30:00
COST	  381.633333 2010-12-27 14:30:00	 1132 2011-02-01 00:30:00
DTV	  381.633333 2010-12-27 14:30:00	 1097 2011-02-01 00:30:00
ESRX	  366.633333 2010-12-27 14:30:00	 1103 2011-02-01 00:45:00
GG	  366.633333 2010-12-27 13:15:00	 1239 2011-02-01 00:45:00
HPQ	  366.633333 2010-12-27 12:15:00	 1325 2011-02-01 00:45:00
KO	  366.633333 2010-12-27 12:30:00	 1378 2011-02-01 00:45:00
MDY	  366.633333 2010-12-27 13:15:00	 1207 2011-02-01 00:45:00
MET	  366.633333 2010-12-27 14:30:00	 1098 2011-02-01 00:45:00
MVG	  396.633333 2011-01-18 14:15:00	  422 2011-02-01 00:15:00
PAAS	  396.633333 2011-01-18 14:00:00	  501 2011-02-01 00:15:00
PALL	  396.633333 2011-01-18 14:00:00	  449 2011-02-01 00:15:00
PNC	  366.633333 2010-12-27 14:15:00	 1164 2011-02-01 00:45:00
SJM	  366.633333 2010-12-27 14:30:00	 1065 2011-02-01 00:45:00
SNDK	  366.633333 2010-12-27 13:00:00	 1250 2011-02-01 00:45:00
SUN	  366.633333 2010-12-27 14:30:00	 1093 2011-02-01 00:45:00
SWC	  396.633333 2011-01-18 13:00:00	  487 2011-02-01 00:15:00
TGT	  366.633333 2010-12-27 14:15:00	 1191 2011-02-01 00:45:00
XLU	  366.633333 2010-12-27 14:30:00	 1066 2011-02-01 00:45:00
ABT	  396.633333 2010-12-27 12:30:00	 1267 2011-02-01 00:15:00
AMGN	  381.633333 2010-12-27 14:00:00	 1115 2011-02-01 00:30:00
AMZN	  381.633333 2010-12-27 11:15:00	 1412 2011-02-01 00:30:00
BHP	  381.633333 2010-12-27 12:15:00	 1524 2011-02-01 00:30:00
COF	  381.633333 2010-12-27 14:30:00	 1106 2011-02-01 00:30:00
DNDN	  381.633333 2010-12-27 14:15:00	 1143 2011-02-01 00:30:00
EBAY	  366.633333 2011-01-18 13:00:00	  487 2011-02-01 00:45:00
EXK	  396.633333 2011-01-18 13:00:00	  469 2011-02-01 00:15:00
FDX	  366.633333 2010-12-27 12:30:00	 1137 2011-02-01 00:45:00
GLD	  366.633333 2010-12-27 11:00:00	 1550 2011-02-01 00:45:00
JNJ	  366.633333 2010-12-27 11:15:00	 1352 2011-02-01 00:45:00
LFT	  366.633333 2010-12-27 14:00:00	 1069 2011-02-01 00:45:00
MOS	  366.633333 2010-12-27 13:30:00	 1276 2011-02-01 00:45:00
NEM	  366.633333 2010-12-27 14:15:00	 1299 2011-02-01 00:45:00
OXY	  366.633333 2010-12-27 14:30:00	 1171 2011-02-01 00:45:00
PEP	  366.633333 2010-12-27 14:15:00	 1153 2011-02-01 00:45:00
PG	  366.633333 2010-12-27 11:30:00	 1269 2011-02-01 00:45:00
RIG	  366.633333 2010-12-27 12:00:00	 1489 2011-02-01 00:45:00
AGU	  396.633333 2011-01-18 13:00:00	  476 2011-02-01 00:15:00
BA	  381.633333 2010-12-27 13:00:00	 1196 2011-02-01 00:30:00
BBT	  381.633333 2010-12-27 14:15:00	 1144 2011-02-01 00:30:00
BIDU	  381.633333 2010-12-27 12:15:00	 1278 2011-02-01 00:30:00
BRCM	  381.633333 2010-12-27 14:30:00	 1191 2011-02-01 00:30:00
CELG	  381.633333 2010-12-27 14:30:00	 1089 2011-02-01 00:30:00
CREE	  381.633333 2010-12-27 14:00:00	 1197 2011-02-01 00:30:00
DE	  381.633333 2010-12-27 13:00:00	 1206 2011-02-01 00:30:00
DIS	  381.633333 2010-12-27 13:00:00	 1148 2011-02-01 00:30:00
EWZ	  366.633333 2010-12-27 09:00:00	 1482 2011-02-01 00:45:00
FFIV	  366.633333 2010-12-27 12:30:00	 1199 2011-02-01 00:45:00
GDX	  366.633333 2010-12-27 13:00:00	 1300 2011-02-01 00:45:00
GILD	  366.633333 2010-12-27 13:30:00	 1152 2011-02-01 00:45:00
GOOG	  366.633333 2010-12-27 09:15:00	 1353 2011-02-01 00:45:00
GS	  366.633333 2010-12-27 13:00:00	 1283 2011-02-01 00:45:00
HES	  366.633333 2010-12-27 14:30:00	 1205 2011-02-01 00:45:00
MMM	  366.633333 2010-12-27 13:30:00	 1173 2011-02-01 00:45:00
MON	  366.633333 2010-12-27 13:30:00	 1217 2011-02-01 00:45:00
MT	  366.633333 2010-12-27 12:45:00	 1517 2011-02-01 00:45:00
PBR	  366.633333 2010-12-27 13:00:00	 1295 2011-02-01 00:45:00
PM	  366.633333 2010-12-27 13:30:00	 1139 2011-02-01 00:45:00
POT	  366.633333 2010-12-27 12:15:00	 1281 2011-02-01 00:45:00
RDY	  396.633333 2011-01-18 13:30:00	  444 2011-02-01 00:15:00
SCCO	  396.633333 2011-01-18 13:30:00	  467 2011-02-01 00:15:00
TEVA	  366.633333 2010-12-27 13:00:00	 1272 2011-02-01 00:45:00
TLT	  366.633333 2010-12-27 12:30:00	 1271 2011-02-01 00:45:00
VMW	  366.633333 2010-12-27 14:30:00	 1195 2011-02-01 00:45:00
WFMI	  366.633333 2010-12-27 14:30:00	 1114 2011-02-01 00:45:00
X	  366.633333 2010-12-27 13:00:00	 1354 2011-02-01 00:45:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
AAPL	  396.633333 2010-12-27 09:00:00	 1542 2011-02-01 00:15:00
ALL	  381.633333 2010-12-27 14:30:00	 1091 2011-02-01 00:30:00
BUCY	  381.633333 2010-12-27 14:15:00	 1118 2011-02-01 00:30:00
CEO	  396.633333 2011-01-18 14:15:00	  438 2011-02-01 00:15:00
CRM	  381.633333 2010-12-27 13:00:00	 1226 2011-02-01 00:30:00
DVN	  381.633333 2010-12-27 13:00:00	 1155 2011-02-01 00:30:00
FLS	  366.633333 2010-12-27 14:30:00	 1084 2011-02-01 00:45:00
JOYG	  366.633333 2010-12-27 14:30:00	 1145 2011-02-01 00:45:00
NUE	  366.633333 2010-12-27 13:45:00	 1144 2011-02-01 00:45:00
PPLT	  396.633333 2011-01-18 14:30:00	  435 2011-02-01 00:15:00
QCOM	  366.633333 2010-12-27 13:00:00	 1198 2011-02-01 00:45:00
SLV	  366.633333 2010-12-27 09:30:00	 1532 2011-02-01 00:45:00
SOHU	  396.633333 2011-01-18 14:30:00	  459 2011-02-01 00:15:00
VALE	  396.633333 2011-01-18 13:00:00	  491 2011-02-01 00:15:00
ABX	  381.633333 2010-12-27 14:30:00	 1324 2011-02-01 00:30:00
AEM	  381.633333 2010-12-27 14:30:00	 1176 2011-02-01 00:30:00
AMX	  381.633333 2010-12-27 14:30:00	 1066 2011-02-01 00:30:00
ARG	  381.633333 2010-12-27 14:00:00	 1117 2011-02-01 00:30:00
CLF	  381.633333 2010-12-27 12:30:00	 1201 2011-02-01 00:30:00
COP	  381.633333 2010-12-27 13:00:00	 1220 2011-02-01 00:30:00
DIA	  381.633333 2010-12-27 12:00:00	 1394 2011-02-01 00:30:00
EFA	  381.633333 2010-12-27 14:00:00	 1216 2011-02-01 00:30:00
JWN	  366.633333 2010-12-27 13:45:00	 1080 2011-02-01 00:45:00
MCD	  366.633333 2010-12-27 10:30:00	 1387 2011-02-01 00:45:00
MJN	  366.633333 2010-12-27 14:30:00	 1072 2011-02-01 00:45:00
MRK	  366.633333 2010-12-27 13:30:00	 1192 2011-02-01 00:45:00
OIH	  366.633333 2010-12-27 14:30:00	 1183 2011-02-01 00:45:00
RIMM	  366.633333 2010-12-27 12:45:00	 1235 2011-02-01 00:45:00
WMT	  366.633333 2010-12-27 13:30:00	 1167 2011-02-01 00:45:00
WYNN	  366.633333 2010-12-27 13:45:00	 1179 2011-02-01 00:45:00

150 rows selected.

Elapsed: 00:00:00.06
06:51:38 SQL> 
06:51:38 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
