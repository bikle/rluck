
SQL*Plus: Release 11.2.0.1.0 Production on Sun Jan 30 08:12:42 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

08:12:42 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
08:12:42 SQL> 08:12:42 SQL> --
08:12:42 SQL> -- merge.sql
08:12:42 SQL> --
08:12:42 SQL> 
08:12:42 SQL> -- I use this script to merge data from ibs_stage into ibs15min.
08:12:42 SQL> 
08:12:42 SQL> 
08:12:42 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
08:12:42 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
08:12:42 SQL> 
08:12:42 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.77
08:12:42 SQL> RENAME ibs15min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.15
08:12:43 SQL> 
08:12:43 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.55
08:12:43 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.13
08:12:43 SQL> 
08:12:43 SQL> CREATE TABLE ibs_dups COMPRESS AS
08:12:43   2  SELECT
08:12:43   3  tkr
08:12:43   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
08:12:43   5  ,clse
08:12:43   6  FROM ibs_stage
08:12:43   7  UNION
08:12:43   8  SELECT tkr,ydate,clse
08:12:43   9  FROM ibs_old
08:12:43  10  /

Table created.

Elapsed: 00:00:00.61
08:12:44 SQL> 
08:12:44 SQL> CREATE TABLE ibs15min COMPRESS AS
08:12:44   2  SELECT
08:12:44   3  tkr
08:12:44   4  ,ydate
08:12:44   5  ,AVG(clse)clse
08:12:44   6  FROM ibs_dups
08:12:44   7  GROUP BY tkr,ydate
08:12:44   8  /

Table created.

Elapsed: 00:00:00.69
08:12:45 SQL> 
08:12:45 SQL> ANALYZE TABLE ibs15min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:01.20
08:12:46 SQL> 
08:12:46 SQL> -- rpt
08:12:46 SQL> 
08:12:46 SQL> SELECT
08:12:46   2  tkr
08:12:46   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
08:12:46   4  ,MIN(ydate)
08:12:46   5  ,COUNT(ydate)
08:12:46   6  ,MAX(ydate)FROM
08:12:46   7  ibs15min
08:12:46   8  GROUP BY tkr
08:12:46   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	  1992.76667 2010-12-27 13:00:00	 1101 2011-01-28 23:00:00
AKAM	  1992.76667 2010-12-27 12:45:00	 1126 2011-01-28 23:00:00
APA	  1992.76667 2010-12-27 12:45:00	 1101 2011-01-28 23:00:00
APC	  1992.76667 2010-12-27 14:15:00	 1151 2011-01-28 23:00:00
AXP	  1992.76667 2010-12-27 13:00:00	 1149 2011-01-28 23:00:00
BP	  1977.76667 2010-12-27 13:00:00	 1462 2011-01-28 23:15:00
BTU	  1977.76667 2010-12-27 12:45:00	 1162 2011-01-28 23:15:00
CAT	  1977.76667 2010-12-27 12:45:00	 1185 2011-01-28 23:15:00
CVS	  1977.76667 2010-12-27 14:30:00	 1057 2011-01-28 23:15:00
HL	  1887.76667 2011-01-18 12:30:00	  467 2011-01-29 00:45:00
MAR	  1962.76667 2010-12-27 14:30:00	 1017 2011-01-28 23:30:00
MDT	  1962.76667 2010-12-27 13:45:00	 1105 2011-01-28 23:30:00
QQQQ	  1962.76667 2010-12-27 09:00:00	 1495 2011-01-28 23:30:00
SINA	  1947.76667 2010-12-27 14:15:00	 1091 2011-01-28 23:45:00
SLW	  1887.76667 2011-01-18 09:15:00	  538 2011-01-29 00:45:00
SPY	  1947.76667 2010-12-27 09:00:00	 1529 2011-01-28 23:45:00
SVM	  1887.76667 2011-01-18 13:00:00	  431 2011-01-29 00:45:00
V	  1947.76667 2010-12-27 12:30:00	 1206 2011-01-28 23:45:00
VECO	  1947.76667 2010-12-27 14:30:00	 1131 2011-01-28 23:45:00
WDC	  1947.76667 2010-12-27 09:15:00	 1117 2011-01-28 23:45:00
XOM	  1947.76667 2010-12-27 13:00:00	 1258 2011-01-28 23:45:00
AFL	  1992.76667 2010-12-27 14:30:00	 1030 2011-01-28 23:00:00
AMT	  1992.76667 2010-12-27 13:00:00	 1065 2011-01-28 23:00:00
AXU	  1887.76667 2011-01-18 13:00:00	  397 2011-01-29 00:45:00
CTSH	  1977.76667 2010-12-27 14:30:00	 1092 2011-01-28 23:15:00
IOC	  1962.76667 2010-12-27 14:30:00	 1014 2011-01-28 23:30:00
JPM	  1962.76667 2010-12-27 13:00:00	 1272 2011-01-28 23:30:00
SKX	  1947.76667 2010-12-27 12:00:00	 1104 2011-01-28 23:45:00
SLB	  1947.76667 2010-12-27 09:15:00	 1295 2011-01-28 23:45:00
STT	  1947.76667 2010-12-27 14:30:00	 1048 2011-01-28 23:45:00
UNH	  1947.76667 2010-12-27 13:00:00	 1103 2011-01-28 23:45:00
UNP	  1947.76667 2010-12-27 14:30:00	 1090 2011-01-28 23:45:00
AIG	  1992.76667 2010-12-27 13:30:00	 1317 2011-01-28 23:00:00
BBY	  1992.76667 2010-12-27 12:00:00	 1170 2011-01-28 23:00:00
CDE	  1887.76667 2011-01-18 11:45:00	  454 2011-01-29 00:45:00
CSX	  1977.76667 2010-12-27 14:30:00	 1091 2011-01-28 23:15:00
CVX	  1977.76667 2010-12-27 13:00:00	 1155 2011-01-28 23:15:00
DD	  1977.76667 2010-12-27 11:30:00	 1137 2011-01-28 23:15:00
EOG	  1977.76667 2010-12-27 14:30:00	 1058 2011-01-28 23:15:00
FCX	  1977.76667 2010-12-27 12:45:00	 1308 2011-01-28 23:15:00
FSLR	  1977.76667 2010-12-27 13:00:00	 1077 2011-01-28 23:15:00
HD	  1962.76667 2010-12-27 12:30:00	 1133 2011-01-28 23:30:00
HON	  1962.76667 2010-12-27 14:15:00	 1064 2011-01-28 23:30:00
IBM	  1962.76667 2010-12-27 12:45:00	 1263 2011-01-28 23:30:00
IWM	  1962.76667 2010-12-27 11:00:00	 1409 2011-01-28 23:30:00
MEE	  1962.76667 2010-12-27 13:15:00	 1127 2011-01-28 23:30:00
NFLX	  1962.76667 2010-12-27 12:30:00	 1205 2011-01-28 23:30:00
PRU	  1962.76667 2010-12-27 13:45:00	 1065 2011-01-28 23:30:00
UPS	  1947.76667 2010-12-27 14:30:00	 1060 2011-01-28 23:45:00
WHR	  1947.76667 2010-12-27 14:30:00	 1036 2011-01-28 23:45:00
XLB	  1947.76667 2010-12-27 13:30:00	 1054 2011-01-28 23:45:00
XLE	  1947.76667 2010-12-27 13:00:00	 1146 2011-01-28 23:45:00
BEN	  1992.76667 2010-12-27 13:00:00	 1059 2011-01-28 23:00:00
CMI	  1977.76667 2010-12-27 12:30:00	 1099 2011-01-28 23:15:00
COST	  1977.76667 2010-12-27 14:30:00	 1084 2011-01-28 23:15:00
DTV	  1977.76667 2010-12-27 14:30:00	 1049 2011-01-28 23:15:00
ESRX	  1977.76667 2010-12-27 14:30:00	 1051 2011-01-28 23:15:00
GG	  1977.76667 2010-12-27 13:15:00	 1187 2011-01-28 23:15:00
HPQ	  1962.76667 2010-12-27 12:15:00	 1272 2011-01-28 23:30:00
KO	  1962.76667 2010-12-27 12:30:00	 1312 2011-01-28 23:30:00
MDY	  1962.76667 2010-12-27 13:15:00	 1155 2011-01-28 23:30:00
MET	  1962.76667 2010-12-27 14:30:00	 1051 2011-01-28 23:30:00
MVG	  1887.76667 2011-01-18 14:15:00	  382 2011-01-29 00:45:00
PAAS	  1887.76667 2011-01-18 14:00:00	  450 2011-01-29 00:45:00
PALL	  1887.76667 2011-01-18 14:00:00	  406 2011-01-29 00:45:00
PNC	  1962.76667 2010-12-27 14:15:00	 1108 2011-01-28 23:30:00
SJM	  1947.76667 2010-12-27 14:30:00	 1019 2011-01-28 23:45:00
SNDK	  1947.76667 2010-12-27 13:00:00	 1197 2011-01-28 23:45:00
SUN	  1947.76667 2010-12-27 14:30:00	 1037 2011-01-28 23:45:00
SWC	  1992.76667 2011-01-18 13:00:00	  433 2011-01-28 23:00:00
TGT	  1947.76667 2010-12-27 14:15:00	 1137 2011-01-28 23:45:00
XLU	  1947.76667 2010-12-27 14:30:00	 1019 2011-01-28 23:45:00
ABT	  1992.76667 2010-12-27 12:30:00	 1210 2011-01-28 23:00:00
AMGN	  1992.76667 2010-12-27 14:00:00	 1066 2011-01-28 23:00:00
AMZN	  1992.76667 2010-12-27 11:15:00	 1342 2011-01-28 23:00:00
BHP	  1977.76667 2010-12-27 12:15:00	 1455 2011-01-28 23:15:00
COF	  1977.76667 2010-12-27 14:30:00	 1058 2011-01-28 23:15:00
DNDN	  1977.76667 2010-12-27 14:15:00	 1090 2011-01-28 23:15:00
EXK	  1887.76667 2011-01-18 13:00:00	  421 2011-01-29 00:45:00
FDX	  1977.76667 2010-12-27 12:30:00	 1081 2011-01-28 23:15:00
GLD	  1977.76667 2010-12-27 11:00:00	 1481 2011-01-28 23:15:00
JNJ	  1962.76667 2010-12-27 11:15:00	 1297 2011-01-28 23:30:00
LFT	  1962.76667 2010-12-27 14:00:00	 1022 2011-01-28 23:30:00
MOS	  1962.76667 2010-12-27 13:30:00	 1220 2011-01-28 23:30:00
NEM	  1962.76667 2010-12-27 14:15:00	 1242 2011-01-28 23:30:00
OXY	  1962.76667 2010-12-27 14:30:00	 1119 2011-01-28 23:30:00
PEP	  1962.76667 2010-12-27 14:15:00	 1100 2011-01-28 23:30:00
PG	  1962.76667 2010-12-27 11:30:00	 1211 2011-01-28 23:30:00
RIG	  1962.76667 2010-12-27 12:00:00	 1424 2011-01-28 23:30:00
BA	  1992.76667 2010-12-27 13:00:00	 1143 2011-01-28 23:00:00
BBT	  1992.76667 2010-12-27 14:15:00	 1090 2011-01-28 23:00:00
BIDU	  1977.76667 2010-12-27 12:15:00	 1223 2011-01-28 23:15:00
BRCM	  1977.76667 2010-12-27 14:30:00	 1138 2011-01-28 23:15:00
CELG	  1977.76667 2010-12-27 14:30:00	 1041 2011-01-28 23:15:00
CREE	  1977.76667 2010-12-27 14:00:00	 1131 2011-01-28 23:15:00
DE	  1977.76667 2010-12-27 13:00:00	 1153 2011-01-28 23:15:00
DIS	  1977.76667 2010-12-27 13:00:00	 1097 2011-01-28 23:15:00
EWZ	  1977.76667 2010-12-27 09:00:00	 1407 2011-01-28 23:15:00
FFIV	  1977.76667 2010-12-27 12:30:00	 1142 2011-01-28 23:15:00
GDX	  1977.76667 2010-12-27 13:00:00	 1243 2011-01-28 23:15:00
GILD	  1977.76667 2010-12-27 13:30:00	 1099 2011-01-28 23:15:00
GOOG	  1977.76667 2010-12-27 09:15:00	 1296 2011-01-28 23:15:00
GS	  1977.76667 2010-12-27 13:00:00	 1229 2011-01-28 23:15:00
HES	  1962.76667 2010-12-27 14:30:00	 1152 2011-01-28 23:30:00
MMM	  1962.76667 2010-12-27 13:30:00	 1122 2011-01-28 23:30:00
MON	  1962.76667 2010-12-27 13:30:00	 1163 2011-01-28 23:30:00
MT	  1962.76667 2010-12-27 12:45:00	 1447 2011-01-28 23:30:00
PBR	  1962.76667 2010-12-27 13:00:00	 1239 2011-01-28 23:30:00
PM	  1962.76667 2010-12-27 13:30:00	 1088 2011-01-28 23:30:00
POT	  1962.76667 2010-12-27 12:15:00	 1227 2011-01-28 23:30:00
TEVA	  1947.76667 2010-12-27 13:00:00	 1204 2011-01-28 23:45:00
TLT	  1947.76667 2010-12-27 12:30:00	 1214 2011-01-28 23:45:00
VMW	  1947.76667 2010-12-27 14:30:00	 1143 2011-01-28 23:45:00
WFMI	  1947.76667 2010-12-27 14:30:00	 1066 2011-01-28 23:45:00
X	  1947.76667 2010-12-27 13:00:00	 1280 2011-01-28 23:45:00
AAPL	  1992.76667 2010-12-27 09:00:00	 1474 2011-01-28 23:00:00
ALL	  1992.76667 2010-12-27 14:30:00	 1043 2011-01-28 23:00:00
BUCY	  1977.76667 2010-12-27 14:15:00	 1071 2011-01-28 23:15:00
CRM	  1977.76667 2010-12-27 13:00:00	 1176 2011-01-28 23:15:00
DVN	  1977.76667 2010-12-27 13:00:00	 1103 2011-01-28 23:15:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
FLS	  1977.76667 2010-12-27 14:30:00	 1035 2011-01-28 23:15:00
JOYG	  1962.76667 2010-12-27 14:30:00	 1097 2011-01-28 23:30:00
NUE	  1962.76667 2010-12-27 13:45:00	 1091 2011-01-28 23:30:00
PPLT	  1887.76667 2011-01-18 14:30:00	  395 2011-01-29 00:45:00
QCOM	  1962.76667 2010-12-27 13:00:00	 1145 2011-01-28 23:30:00
SLV	  1947.76667 2010-12-27 09:30:00	 1464 2011-01-28 23:45:00
ABX	  1992.76667 2010-12-27 14:30:00	 1262 2011-01-28 23:00:00
AEM	  1992.76667 2010-12-27 14:30:00	 1123 2011-01-28 23:00:00
AMX	  1992.76667 2010-12-27 14:30:00	 1018 2011-01-28 23:00:00
ARG	  1992.76667 2010-12-27 14:00:00	 1059 2011-01-28 23:00:00
CLF	  1977.76667 2010-12-27 12:30:00	 1148 2011-01-28 23:15:00
COP	  1977.76667 2010-12-27 13:00:00	 1168 2011-01-28 23:15:00
DIA	  1977.76667 2010-12-27 12:00:00	 1333 2011-01-28 23:15:00
EFA	  1977.76667 2010-12-27 14:00:00	 1164 2011-01-28 23:15:00
JWN	  1962.76667 2010-12-27 13:45:00	 1032 2011-01-28 23:30:00
MCD	  1962.76667 2010-12-27 10:30:00	 1326 2011-01-28 23:30:00
MJN	  1962.76667 2010-12-27 14:30:00	 1024 2011-01-28 23:30:00
MRK	  1962.76667 2010-12-27 13:30:00	 1137 2011-01-28 23:30:00
OIH	  1962.76667 2010-12-27 14:30:00	 1134 2011-01-28 23:30:00
RIMM	  1962.76667 2010-12-27 12:45:00	 1182 2011-01-28 23:30:00
WMT	  1947.76667 2010-12-27 13:30:00	 1111 2011-01-28 23:45:00
WYNN	  1947.76667 2010-12-27 13:45:00	 1130 2011-01-28 23:45:00

142 rows selected.

Elapsed: 00:00:00.07
08:12:46 SQL> 
08:12:46 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
