
SQL*Plus: Release 11.2.0.1.0 Production on Wed Jan 12 16:10:48 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

16:10:48 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
16:10:48 SQL> 16:10:48 SQL> --
16:10:48 SQL> -- update_di5min_stk.sql
16:10:48 SQL> --
16:10:48 SQL> 
16:10:48 SQL> -- I use this script to keep di5min_stk up to date.
16:10:48 SQL> 
16:10:48 SQL> -- The table, di5min_stk, contains data from duakas before '2010-12-27 09:00:00'
16:10:48 SQL> -- After that date, it holds data from IB.
16:10:48 SQL> 
16:10:48 SQL> -- CREATE TABLE di5min_stk0(tkrdate VARCHAR2(26),tkr VARCHAR2(7),ydate DATE,clse NUMBER);
16:10:48 SQL> -- CREATE TABLE di5min_stk (tkrdate VARCHAR2(26),tkr VARCHAR2(7),ydate DATE,clse NUMBER);
16:10:48 SQL> 
16:10:48 SQL> TRUNCATE TABLE di5min_stk0;

Table truncated.

Elapsed: 00:00:00.19
16:10:48 SQL> DROP TABLE di5min_stk;

Table dropped.

Elapsed: 00:00:00.04
16:10:48 SQL> PURGE RECYCLEBIN;

Recyclebin purged.

Elapsed: 00:00:00.30
16:10:49 SQL> 
16:10:49 SQL> -- Copy in data from ibs5min:
16:10:49 SQL> 
16:10:49 SQL> INSERT INTO di5min_stk0(tkrdate,tkr,ydate,clse)
16:10:49   2  SELECT	     tkr||ydate,tkr,ydate,clse
16:10:49   3  FROM ibs5min
16:10:49   4  WHERE ydate >= '2010-12-27 09:00:00'
16:10:49   5  /

18097 rows created.

Elapsed: 00:00:00.08
16:10:49 SQL> 
16:10:49 SQL> -- rpt
16:10:49 SQL> SELECT
16:10:49   2  tkr
16:10:49   3  ,MIN(ydate)
16:10:49   4  ,COUNT(tkr)
16:10:49   5  ,MAX(ydate)
16:10:49   6  FROM di5min_stk0
16:10:49   7  GROUP BY tkr
16:10:49   8  ORDER BY tkr
16:10:49   9  /

TKR	MIN(YDATE)	    COUNT(TKR) MAX(YDATE)
------- ------------------- ---------- -------------------
AAPL	2011-01-04 14:30:00	   486 2011-01-12 15:55:00
DIA	2010-12-27 09:00:00	  1793 2011-01-07 22:30:00
DIS	2010-12-27 09:00:00	  1584 2011-01-07 22:20:00
EBAY	2010-12-27 09:00:00	  1606 2011-01-07 22:25:00
GOOG	2010-12-27 09:00:00	  1732 2011-01-07 22:35:00
HPQ	2010-12-27 09:00:00	  1685 2011-01-07 23:05:00
IBM	2010-12-27 09:00:00	  1680 2011-01-07 22:55:00
QQQQ	2010-12-27 09:00:00	  1851 2011-01-07 23:00:00
SPY	2010-12-27 09:00:00	  1879 2011-01-07 22:40:00
WMT	2010-12-27 09:00:00	  1600 2011-01-07 22:45:00
XLB	2011-01-04 14:30:00	   488 2011-01-12 16:05:00
XOM	2010-12-27 09:00:00	  1713 2011-01-07 22:50:00

12 rows selected.

Elapsed: 00:00:00.02
16:10:49 SQL> 
16:10:49 SQL> -- Next, copy in data from dukas.
16:10:49 SQL> -- dukas5min_stk depends on:
16:10:49 SQL> -- - dukas10min_stk
16:10:49 SQL> -- - svmspy/dukas/fake5.sql
16:10:49 SQL> 
16:10:49 SQL> INSERT INTO di5min_stk0(tkrdate,tkr,ydate,clse)
16:10:49   2  SELECT	     tkr||ydate,tkr,ydate,clse
16:10:49   3  FROM dukas5min_stk
16:10:49   4  WHERE ydate < '2010-12-27 09:00:00'
16:10:49   5  /

230382 rows created.

Elapsed: 00:00:00.44
16:10:49 SQL> 
16:10:49 SQL> -- rpt
16:10:49 SQL> SELECT
16:10:49   2  tkr
16:10:49   3  ,MIN(ydate)
16:10:49   4  ,COUNT(tkr)
16:10:49   5  ,MAX(ydate)
16:10:49   6  FROM dukas5min_stk
16:10:49   7  WHERE ydate < '2010-12-27 09:00:00'
16:10:49   8  GROUP BY tkr
16:10:49   9  ORDER BY tkr
16:10:49  10  /

TKR	 MIN(YDATE)	     COUNT(TKR) MAX(YDATE)
-------- ------------------- ---------- -------------------
DIA	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
DIS	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
EBAY	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
GOOG	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
HPQ	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
IBM	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
QQQQ	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
SPY	 2009-10-28 18:10:01	  19521 2010-12-24 20:50:01
WMT	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01
XOM	 2009-10-28 18:10:01	  23429 2010-12-24 20:50:01

10 rows selected.

Elapsed: 00:00:00.09
16:10:49 SQL> 
16:10:49 SQL> -- rpt
16:10:49 SQL> SELECT
16:10:49   2  tkr
16:10:49   3  ,MIN(ydate)
16:10:49   4  ,COUNT(tkr)
16:10:49   5  ,MAX(ydate)
16:10:49   6  FROM di5min_stk0
16:10:49   7  GROUP BY tkr
16:10:49   8  ORDER BY tkr
16:10:49   9  /

TKR	MIN(YDATE)	    COUNT(TKR) MAX(YDATE)
------- ------------------- ---------- -------------------
AAPL	2011-01-04 14:30:00	   486 2011-01-12 15:55:00
DIA	2009-10-28 18:10:01	 25222 2011-01-07 22:30:00
DIS	2009-10-28 18:10:01	 25013 2011-01-07 22:20:00
EBAY	2009-10-28 18:10:01	 25035 2011-01-07 22:25:00
GOOG	2009-10-28 18:10:01	 25161 2011-01-07 22:35:00
HPQ	2009-10-28 18:10:01	 25114 2011-01-07 23:05:00
IBM	2009-10-28 18:10:01	 25109 2011-01-07 22:55:00
QQQQ	2009-10-28 18:10:01	 25280 2011-01-07 23:00:00
SPY	2009-10-28 18:10:01	 21400 2011-01-07 22:40:00
WMT	2009-10-28 18:10:01	 25029 2011-01-07 22:45:00
XLB	2011-01-04 14:30:00	   488 2011-01-12 16:05:00
XOM	2009-10-28 18:10:01	 25142 2011-01-07 22:50:00

12 rows selected.

Elapsed: 00:00:00.09
16:10:49 SQL> 
16:10:49 SQL> CREATE TABLE di5min_stk COMPRESS AS
16:10:49   2  SELECT
16:10:49   3  tkrdate
16:10:49   4  ,tkr
16:10:49   5  ,ydate
16:10:49   6  ,AVG(clse)clse
16:10:49   7  FROM di5min_stk0
16:10:49   8  GROUP BY
16:10:49   9  tkrdate
16:10:49  10  ,tkr
16:10:49  11  ,ydate
16:10:49  12  /

Table created.

Elapsed: 00:00:01.06
16:10:51 SQL> 
16:10:51 SQL> -- I need to shave a second off of some of the dates:
16:10:51 SQL> 
16:10:51 SQL> UPDATE di5min_stk SET ydate = ydate - 1/24/3600
16:10:51   2  WHERE TO_CHAR(ydate,'SS')='01'
16:10:51   3  /

230382 rows updated.

Elapsed: 00:00:02.70
16:10:53 SQL> 
16:10:53 SQL> SELECT COUNT(*)FROM di5min_stk;

  COUNT(*)
----------
    248479

Elapsed: 00:00:00.02
16:10:53 SQL> SELECT COUNT(*)FROM di5min_stk WHERE TO_CHAR(ydate,'SS')='00';

  COUNT(*)
----------
    248479

Elapsed: 00:00:00.07
16:10:53 SQL> SELECT COUNT(*)FROM di5min_stk WHERE TO_CHAR(ydate,'SS')='01';

  COUNT(*)
----------
	 0

Elapsed: 00:00:00.08
16:10:53 SQL> 
16:10:53 SQL> UPDATE di5min_stk SET tkrdate = tkr||ydate;

248479 rows updated.

Elapsed: 00:00:02.84
16:10:56 SQL> 
16:10:56 SQL> -- rpt
16:10:56 SQL> SELECT
16:10:56   2  tkr
16:10:56   3  ,MIN(ydate)
16:10:56   4  ,COUNT(ydate)
16:10:56   5  ,MAX(ydate)
16:10:56   6  ,MIN(clse)
16:10:56   7  ,AVG(clse)
16:10:56   8  ,MAX(clse)
16:10:56   9  FROM di5min_stk
16:10:56  10  GROUP BY tkr
16:10:56  11  ORDER BY tkr
16:10:56  12  /

TKR	MIN(YDATE)	    COUNT(YDATE) MAX(YDATE)	      MIN(CLSE)  AVG(CLSE)  MAX(CLSE)
------- ------------------- ------------ ------------------- ---------- ---------- ----------
AAPL	2011-01-04 14:30:00	     486 2011-01-12 15:55:00	 328.28  335.95535	343.6
DIA	2009-10-28 18:10:00	   25222 2011-01-07 22:30:00	  96.34 106.745145     117.39
DIS	2009-10-28 18:10:00	   25013 2011-01-07 22:20:00	  27.06 33.8034941	   40
EBAY	2009-10-28 18:10:00	   25035 2011-01-07 22:25:00	  19.17 24.5841372	31.48
GOOG	2009-10-28 18:10:00	   25161 2011-01-07 22:35:00	  434.6 546.755742     629.82
HPQ	2009-10-28 18:10:00	   25114 2011-01-07 23:05:00	  37.45 46.6478685	 54.7
IBM	2009-10-28 18:10:00	   25109 2011-01-07 22:55:00	 119.59 131.966348     150.76
QQQQ	2009-10-28 18:10:00	   25280 2011-01-07 23:00:00	   40.7 47.7219665	56.03
SPY	2009-10-28 18:10:00	   21400 2011-01-07 22:40:00	 103.18 115.331709     128.04
WMT	2009-10-28 18:10:00	   25029 2011-01-07 22:45:00	  47.76 53.1152332	56.15
XLB	2011-01-04 14:30:00	     488 2011-01-12 16:05:00	  37.74 38.4107992	39.08
XOM	2009-10-28 18:10:00	   25142 2011-01-07 22:50:00	  56.05 66.5493313	 76.5

12 rows selected.

Elapsed: 00:00:00.15
16:10:56 SQL> 
16:10:56 SQL> COLUMN clse FORMAT 999.9999
16:10:56 SQL> SELECT
16:10:56   2  tkr
16:10:56   3  ,ROUND(clse,4)clse
16:10:56   4  ,ydate
16:10:56   5  FROM di5min_stk
16:10:56   6  WHERE ydate > sysdate - 0.5/24
16:10:56   7  ORDER BY tkr,ydate
16:10:56   8  /

TKR	     CLSE YDATE
------- --------- -------------------
AAPL	 342.9700 2011-01-12 15:45:00
AAPL	 343.1900 2011-01-12 15:50:00
AAPL	 343.0700 2011-01-12 15:55:00
XLB	  39.0000 2011-01-12 15:45:00
XLB	  39.0200 2011-01-12 15:50:00
XLB	  39.0600 2011-01-12 15:55:00
XLB	  39.0400 2011-01-12 16:00:00
XLB	  39.0800 2011-01-12 16:05:00

8 rows selected.

Elapsed: 00:00:00.03
16:10:56 SQL> Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
