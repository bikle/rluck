
SQL*Plus: Release 11.2.0.1.0 Production on Wed Jan 12 22:23:36 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

22:23:36 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
22:23:36 SQL> 22:23:36 SQL> --
22:23:36 SQL> -- merge.sql
22:23:36 SQL> --
22:23:36 SQL> 
22:23:36 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
22:23:36 SQL> 
22:23:36 SQL> 
22:23:36 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
22:23:36 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
22:23:36 SQL> 
22:23:36 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:01.68
22:23:38 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.09
22:23:38 SQL> 
22:23:38 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.06
22:23:38 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.05
22:23:38 SQL> 
22:23:38 SQL> CREATE TABLE ibs_dups COMPRESS AS
22:23:38   2  SELECT
22:23:38   3  tkr
22:23:38   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
22:23:38   5  ,clse
22:23:38   6  FROM ibs_stage
22:23:38   7  UNION
22:23:38   8  SELECT tkr,ydate,clse
22:23:38   9  FROM ibs_old
22:23:38  10  /

Table created.

Elapsed: 00:00:00.82
22:23:39 SQL> 
22:23:39 SQL> CREATE TABLE ibs5min COMPRESS AS
22:23:39   2  SELECT
22:23:39   3  tkr
22:23:39   4  ,ydate
22:23:39   5  ,AVG(clse)clse
22:23:39   6  FROM ibs_dups
22:23:39   7  GROUP BY tkr,ydate
22:23:39   8  /

Table created.

Elapsed: 00:00:00.64
22:23:39 SQL> 
22:23:39 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:00.60
22:23:40 SQL> 
22:23:40 SQL> -- I should see less than 60 min:
22:23:40 SQL> SELECT
22:23:40   2  tkr
22:23:40   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
22:23:40   4  ,MIN(ydate)
22:23:40   5  ,COUNT(ydate)
22:23:40   6  ,MAX(ydate)FROM
22:23:40   7  ibs5min
22:23:40   8  GROUP BY tkr
22:23:40   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AKAM	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
APA	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
APC	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
AXP	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BP	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BTU	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CAT	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CVS	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
MAR	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MDT	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
QQQQ	  333.666667 2010-12-27 09:00:00	 2036 2011-01-12 16:50:00
SINA	  88.6666667 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
SPY	  333.666667 2010-12-27 09:00:00	 2330 2011-01-12 16:50:00
V	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
VECO	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
WDC	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
XOM	  248.666667 2010-12-27 09:00:00	 2128 2011-01-12 18:15:00
AFL	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMT	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
CTSH	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
IOC	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
JPM	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
SKX	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SLB	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
STT	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
UNH	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
UNP	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
AIG	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
BBY	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CSX	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
CVX	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DD	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
EOG	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FCX	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FSLR	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HD	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HON	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
IBM	  343.666667 2010-12-27 09:00:00	 1863 2011-01-12 16:40:00
IWM	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
MEE	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
NFLX	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PRU	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
UPS	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
WHR	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
XLB	  283.666667 2011-01-04 14:30:00	  507 2011-01-12 17:40:00
XLE	  283.666667 2011-01-04 14:30:00	  507 2011-01-12 17:40:00
BEN	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CMI	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
COST	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DTV	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
ESRX	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
GG	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HPQ	  343.666667 2010-12-27 09:00:00	 1868 2011-01-12 16:40:00
KO	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MDY	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MET	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PNC	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SJM	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SNDK	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SUN	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
TGT	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
TKR	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
XLU	  268.666667 2011-01-04 14:30:00	  510 2011-01-12 17:55:00
ABT	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMGN	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMZN	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BHP	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
COF	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
DNDN	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
EBAY	  7198.66667 2010-12-27 09:00:00	 1606 2011-01-07 22:25:00
FDX	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GLD	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
JNJ	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
LFT	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MOS	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
NEM	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
OXY	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PEP	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
PG	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
RIG	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
BA	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BBT	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BIDU	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BRCM	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CELG	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CREE	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DE	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DIS	  348.666667 2010-12-27 09:00:00	 1766 2011-01-12 16:35:00
EWZ	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FFIV	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GDX	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GILD	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GOOG	  343.666667 2010-12-27 09:00:00	 2092 2011-01-12 16:40:00
GS	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HES	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
MMM	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MON	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MT	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PBR	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PM	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
POT	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
TEVA	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
TLT	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
VMW	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
WFMI	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
X	  328.666667 2011-01-04 12:40:00	 1008 2011-01-12 16:55:00
AAPL	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
ALL	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
BUCY	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CRM	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DVN	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FLS	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
JOYG	  343.666667 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
NUE	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
QCOM	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SLV	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
ABX	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AEM	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMX	  358.666667 2011-01-04 14:30:00	  492 2011-01-12 16:25:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ARG	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CLF	  353.666667 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
COP	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DIA	  348.666667 2010-12-27 09:00:00	 1975 2011-01-12 16:35:00
EFA	  348.666667 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
JWN	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MCD	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MJN	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MRK	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
OIH	  338.666667 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
RIMM	  333.666667 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
WMT	  328.666667 2010-12-27 09:00:00	 1947 2011-01-12 16:55:00
WYNN	  328.666667 2011-01-04 14:30:00	  498 2011-01-12 16:55:00

133 rows selected.

Elapsed: 00:00:00.04
22:23:40 SQL> 
22:23:40 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
