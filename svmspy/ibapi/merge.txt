
SQL*Plus: Release 11.2.0.1.0 Production on Thu Jan 27 22:11:34 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

22:11:34 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
22:11:34 SQL> 
22:11:34 SQL> 22:11:34 SQL> --
22:11:34 SQL> -- merge.sql
22:11:34 SQL> --
22:11:34 SQL> 
22:11:34 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
22:11:34 SQL> 
22:11:34 SQL> 
22:11:34 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
22:11:34 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
22:11:34 SQL> 
22:11:34 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.18
22:11:34 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.03
22:11:34 SQL> 
22:11:34 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.21
22:11:34 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.03
22:11:34 SQL> 
22:11:34 SQL> CREATE TABLE ibs_dups COMPRESS AS
22:11:34   2  SELECT
22:11:34   3  tkr
22:11:34   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
22:11:34   5  ,clse
22:11:34   6  FROM ibs_stage
22:11:34   7  UNION
22:11:34   8  SELECT tkr,ydate,clse
22:11:34   9  FROM ibs_old
22:11:34  10  /

Table created.

Elapsed: 00:00:00.64
22:11:35 SQL> 
22:11:35 SQL> CREATE TABLE ibs5min COMPRESS AS
22:11:35   2  SELECT
22:11:35   3  tkr
22:11:35   4  ,ydate
22:11:35   5  ,AVG(clse)clse
22:11:35   6  FROM ibs_dups
22:11:35   7  GROUP BY tkr,ydate
22:11:35   8  /

Table created.

Elapsed: 00:00:00.61
22:11:35 SQL> 
22:11:35 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:01.05
22:11:36 SQL> 
22:11:36 SQL> -- I should see less than 60 min:
22:11:36 SQL> SELECT
22:11:36   2  tkr
22:11:36   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
22:11:36   4  ,MIN(ydate)
22:11:36   5  ,COUNT(ydate)
22:11:36   6  ,MAX(ydate)FROM
22:11:36   7  ibs5min
22:11:36   8  GROUP BY tkr
22:11:36   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AKAM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
APA		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
APC		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AXP		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BP		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BTU		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CAT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CVS		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MAR		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MDT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
QQQQ		76.6 2010-12-27 09:00:00	 3009 2011-01-27 20:55:00
SINA		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SPY		76.6 2010-12-27 09:00:00	 3160 2011-01-27 20:55:00
V		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
VECO		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
WDC		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
XOM		76.6 2010-12-27 09:00:00	 2949 2011-01-27 20:55:00
AFL		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AMT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CTSH		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
IOC		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
JPM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SKX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SLB		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
STT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
UNH		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
UNP		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AIG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BBY		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CSX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CVX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DD		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
EOG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
FCX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
FSLR		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
HD		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
HON		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
IBM		76.6 2010-12-27 09:00:00	 2793 2011-01-27 20:55:00
IWM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MEE		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
NFLX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
PRU		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
UPS		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
WHR		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
XLB		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
XLE		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BEN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CMI		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
COST		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DTV		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
ESRX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
GG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
HPQ		76.6 2010-12-27 09:00:00	 2818 2011-01-27 20:55:00
KO		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MDY		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MET		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
PNC		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SJM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SNDK		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SUN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SWC		76.6 2011-01-19 14:30:00	  546 2011-01-27 20:55:00
TGT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
TKR		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
XLU		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
ABT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AMGN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AMZN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BHP		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
COF		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DNDN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
EBAY	     18796.6 2010-12-27 09:00:00	 2047 2011-01-14 20:55:00
FDX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
GLD		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
JNJ		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
LFT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MOS		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
NEM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
OXY		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
PEP		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
PG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
RIG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BA		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BBT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BIDU		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BRCM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CELG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CREE		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DE		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DIS		76.6 2010-12-27 09:00:00	 2653 2011-01-27 20:55:00
EWZ		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
FFIV		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
GDX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
GILD		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
GOOG		76.6 2010-12-27 09:00:00	 2923 2011-01-27 20:55:00
GS		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
HES		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MMM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MON		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
PBR		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
PM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
POT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
TEVA		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
TLT		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
VMW		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
WFMI		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
X		76.6 2011-01-04 12:40:00	 1836 2011-01-27 20:55:00
AAPL		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
ALL		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
BUCY		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CRM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DVN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
FLS		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
JOYG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
NUE		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
QCOM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
SLV		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
ABX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
AEM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
AMX		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
ARG		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
CLF		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
COP		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
DIA		76.6 2010-12-27 09:00:00	 2901 2011-01-27 20:55:00
EFA		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
JWN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MCD		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MJN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
MRK		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
OIH		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
RIMM		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00
WMT		76.6 2010-12-27 09:00:00	 2775 2011-01-27 20:55:00
WYNN		76.6 2011-01-04 14:30:00	 1326 2011-01-27 20:55:00

134 rows selected.

Elapsed: 00:00:00.08
22:11:36 SQL> 
22:11:36 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
