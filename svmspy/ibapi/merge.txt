
SQL*Plus: Release 11.2.0.1.0 Production on Wed Jan 26 16:12:14 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

16:12:14 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
16:12:14 SQL> 
16:12:14 SQL> 16:12:14 SQL> --
16:12:14 SQL> -- merge.sql
16:12:14 SQL> --
16:12:14 SQL> 
16:12:14 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
16:12:14 SQL> 
16:12:14 SQL> 
16:12:14 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
16:12:14 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
16:12:14 SQL> 
16:12:14 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.15
16:12:14 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.07
16:12:14 SQL> 
16:12:14 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.04
16:12:14 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.03
16:12:14 SQL> 
16:12:14 SQL> CREATE TABLE ibs_dups COMPRESS AS
16:12:14   2  SELECT
16:12:14   3  tkr
16:12:14   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
16:12:14   5  ,clse
16:12:14   6  FROM ibs_stage
16:12:14   7  UNION
16:12:14   8  SELECT tkr,ydate,clse
16:12:14   9  FROM ibs_old
16:12:14  10  /

Table created.

Elapsed: 00:00:00.76
16:12:15 SQL> 
16:12:15 SQL> CREATE TABLE ibs5min COMPRESS AS
16:12:15   2  SELECT
16:12:15   3  tkr
16:12:15   4  ,ydate
16:12:15   5  ,AVG(clse)clse
16:12:15   6  FROM ibs_dups
16:12:15   7  GROUP BY tkr,ydate
16:12:15   8  /

Table created.

Elapsed: 00:00:01.71
16:12:17 SQL> 
16:12:17 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:00.91
16:12:18 SQL> 
16:12:18 SQL> -- I should see less than 60 min:
16:12:18 SQL> SELECT
16:12:18   2  tkr
16:12:18   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
16:12:18   4  ,MIN(ydate)
16:12:18   5  ,COUNT(ydate)
16:12:18   6  ,MAX(ydate)FROM
16:12:18   7  ibs5min
16:12:18   8  GROUP BY tkr
16:12:18   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AKAM	      2682.3 2011-01-04 14:30:00	 1075 2011-01-24 19:30:00
APA	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
APC	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AXP	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BP	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BTU	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CAT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CVS	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MAR	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MDT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
QQQQ	      2822.3 2010-12-27 09:00:00	 2730 2011-01-24 17:10:00
SINA	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
SPY	      6917.3 2010-12-27 09:00:00	 2848 2011-01-21 20:55:00
V	      2842.3 2011-01-04 14:30:00	 1043 2011-01-24 16:50:00
VECO	      2732.3 2011-01-04 14:30:00	 1065 2011-01-24 18:40:00
WDC	      2712.3 2011-01-04 14:30:00	 1069 2011-01-24 19:00:00
XOM	      6917.3 2010-12-27 09:00:00	 2637 2011-01-21 20:55:00
AFL	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AMT	      2782.3 2011-01-04 14:30:00	 1055 2011-01-24 17:50:00
CTSH		22.3 2011-01-04 14:30:00	 1187 2011-01-26 15:50:00
IOC	      2807.3 2011-01-04 14:30:00	 1050 2011-01-24 17:25:00
JPM	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
SKX	      2757.3 2011-01-04 14:30:00	 1060 2011-01-24 18:15:00
SLB	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
STT		17.3 2011-01-04 14:30:00	 1188 2011-01-26 15:55:00
UNH	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
UNP	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AIG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BBY	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CSX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CVX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DD	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
EOG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
FCX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
FSLR	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
HD	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
HON	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
IBM	      2622.3 2010-12-27 09:00:00	 2554 2011-01-24 20:30:00
IWM		 7.3 2011-01-04 14:30:00	 1190 2011-01-26 16:05:00
MEE	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
NFLX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
PRU	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
UPS	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
WHR	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
XLB	      2837.3 2011-01-04 14:30:00	 1044 2011-01-24 16:55:00
XLE	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BEN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CMI	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
COST	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DTV	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
ESRX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
GG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
HPQ	      6917.3 2010-12-27 09:00:00	 2506 2011-01-21 20:55:00
KO	      2702.3 2011-01-04 14:30:00	 1071 2011-01-24 19:10:00
MDY	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MET	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
PNC	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
SJM	      2802.3 2011-01-04 14:30:00	 1051 2011-01-24 17:30:00
SNDK	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
SUN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
SWC		22.3 2011-01-19 14:30:00	  407 2011-01-26 15:50:00
TGT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
TKR	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
XLU	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
ABT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AMGN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AMZN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BHP	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
COF	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DNDN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
EBAY	     16997.3 2010-12-27 09:00:00	 2047 2011-01-14 20:55:00
FDX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
GLD	      2742.3 2011-01-04 14:30:00	 1063 2011-01-24 18:30:00
JNJ	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
LFT	      2847.3 2011-01-04 14:30:00	 1042 2011-01-24 16:45:00
MOS	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
NEM	      2792.3 2011-01-04 14:30:00	 1053 2011-01-24 17:40:00
OXY	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
PEP		27.3 2011-01-04 14:30:00	 1186 2011-01-26 15:45:00
PG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
RIG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BA	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BBT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BIDU	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
BRCM	      2747.3 2011-01-04 14:30:00	 1062 2011-01-24 18:25:00
CELG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CREE	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DE	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DIS	      6917.3 2010-12-27 09:00:00	 2341 2011-01-21 20:55:00
EWZ	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
FFIV	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
GDX	      2787.3 2011-01-04 14:30:00	 1054 2011-01-24 17:45:00
GILD	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
GOOG	      2647.3 2010-12-27 09:00:00	 2679 2011-01-24 20:05:00
GS	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
HES	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MMM	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MON	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
PBR	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
PM	      2812.3 2011-01-04 14:30:00	 1049 2011-01-24 17:20:00
POT	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
TEVA	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
TLT	      2827.3 2011-01-04 14:30:00	 1046 2011-01-24 17:05:00
VMW	      2832.3 2011-01-04 14:30:00	 1045 2011-01-24 17:00:00
WFMI	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
X	      6917.3 2011-01-04 12:40:00	 1524 2011-01-21 20:55:00
AAPL	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
ALL	      2722.3 2011-01-04 14:30:00	 1067 2011-01-24 18:50:00
BUCY	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CRM	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DVN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
FLS	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
JOYG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
NUE	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
QCOM	      2672.3 2011-01-04 14:30:00	 1077 2011-01-24 19:40:00
SLV	      2687.3 2011-01-04 14:30:00	 1074 2011-01-24 19:25:00
ABX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
AEM	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
AMX	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
ARG	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
CLF	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
COP	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
DIA	      2772.3 2010-12-27 09:00:00	 2632 2011-01-24 18:00:00
EFA	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
JWN	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MCD	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
MJN	      2847.3 2011-01-04 14:30:00	 1042 2011-01-24 16:45:00
MRK	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
OIH	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
RIMM	      6917.3 2011-01-04 14:30:00	 1014 2011-01-21 20:55:00
WMT	      6917.3 2010-12-27 09:00:00	 2463 2011-01-21 20:55:00
WYNN		12.3 2011-01-04 14:30:00	 1189 2011-01-26 16:00:00

134 rows selected.

Elapsed: 00:00:00.07
16:12:18 SQL> 
16:12:18 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
