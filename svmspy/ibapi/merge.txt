
SQL*Plus: Release 11.2.0.1.0 Production on Fri Apr 8 23:26:02 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

23:26:02 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
23:26:02 SQL> 
23:26:02 SQL> 23:26:02 SQL> --
23:26:02 SQL> -- merge.sql
23:26:02 SQL> --
23:26:02 SQL> 
23:26:02 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
23:26:02 SQL> 
23:26:02 SQL> 
23:26:02 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
23:26:02 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
23:26:02 SQL> 
23:26:02 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.18
23:26:02 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.03
23:26:02 SQL> 
23:26:02 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.04
23:26:02 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.03
23:26:02 SQL> 
23:26:02 SQL> CREATE TABLE ibs_dups COMPRESS AS
23:26:02   2  SELECT
23:26:02   3  tkr
23:26:02   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
23:26:02   5  ,clse
23:26:02   6  FROM ibs_stage
23:26:02   7  UNION
23:26:02   8  SELECT tkr,ydate,clse
23:26:02   9  FROM ibs_old
23:26:02  10  /

Table created.

Elapsed: 00:00:02.55
23:26:05 SQL> 
23:26:05 SQL> -- ibs_stage may have data outside of RTH.
23:26:05 SQL> -- Remove data which is outside of RTH:
23:26:05 SQL> DELETE ibs_dups WHERE TO_CHAR(ydate,'HH24:MI') < '14:30'AND ydate < '2011-03-14';

0 rows deleted.

Elapsed: 00:00:00.30
23:26:05 SQL> DELETE ibs_dups WHERE TO_CHAR(ydate,'HH24:MI') > '20:55'AND ydate < '2011-03-14';

0 rows deleted.

Elapsed: 00:00:00.26
23:26:05 SQL> -- Daylight savings time started on 2011-03-14:
23:26:05 SQL> DELETE ibs_dups WHERE TO_CHAR(ydate,'HH24:MI') < '13:30'AND ydate > '2011-03-14';

0 rows deleted.

Elapsed: 00:00:00.17
23:26:05 SQL> DELETE ibs_dups WHERE TO_CHAR(ydate,'HH24:MI') > '19:55'AND ydate > '2011-03-14';

0 rows deleted.

Elapsed: 00:00:00.16
23:26:05 SQL> 
23:26:05 SQL> CREATE TABLE ibs5min COMPRESS AS
23:26:05   2  SELECT
23:26:05   3  tkr
23:26:05   4  ,ydate
23:26:05   5  ,AVG(clse)clse
23:26:05   6  FROM ibs_dups
23:26:05   7  GROUP BY tkr,ydate
23:26:05   8  /

Table created.

Elapsed: 00:00:02.04
23:26:08 SQL> 
23:26:08 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:04.27
23:26:12 SQL> 
23:26:12 SQL> -- I should see less than 60 min:
23:26:12 SQL> SELECT
23:26:12   2  tkr
23:26:12   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
23:26:12   4  ,MIN(ydate)
23:26:12   5  ,COUNT(ydate)
23:26:12   6  ,MAX(ydate)FROM
23:26:12   7  ibs5min
23:26:12   8  GROUP BY tkr
23:26:12   9  ORDER BY tkr
23:26:12  10  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
AAPL	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ABT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ABX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ADBE	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AEM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AFL	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AGU	       211.2 2011-01-24 14:30:00	 4212 2011-04-08 19:55:00
AIG	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AKAM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ALL	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AMGN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AMT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AMX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AMZN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
APA	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
APC	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ARG	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AXP	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
AXU	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
BA	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BBT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BBY	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BEN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BHP	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BIDU	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BP	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BRCM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BTU	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
BUCY	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CAT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CDE	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
CELG	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CEO	       211.2 2011-01-24 14:30:00	 4212 2011-04-08 19:55:00
CHK	       211.2 2011-01-24 14:30:00	 4212 2011-04-08 19:55:00
CLF	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CMI	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
COF	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
COP	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
COST	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CREE	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CRM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CSX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CTSH	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CVE	       211.2 2011-02-14 14:30:00	 3042 2011-04-08 19:55:00
CVS	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
CVX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
DD	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
DE	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
DIA	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00
DIS	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00
DNDN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
DTV	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
DVN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
EBAY	       211.2 2010-12-27 14:30:00	 5486 2011-04-08 19:55:00
EFA	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
EOG	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ESRX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
EWZ	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
EXK	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
FCX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
FDX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
FFIV	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
FLS	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
FSLR	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
GD	       211.2 2011-01-28 14:30:00	 3900 2011-04-08 19:55:00
GDX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
GFI	       211.2 2011-01-28 14:30:00	 3666 2011-04-08 19:55:00
GG	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
GILD	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
GLD	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
GOOG	       211.2 2010-12-27 14:30:00	 5460 2011-04-08 19:55:00
GS	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
HD	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
HES	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
HL	       211.2 2011-01-18 14:30:00	 4368 2011-04-08 19:55:00
HOC	       211.2 2011-02-17 14:30:00	 2808 2011-04-08 19:55:00
HON	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
HPQ	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00
IBM	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00
IOC	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
IWM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
JNJ	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
JOYG	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
JPM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
JWN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
KO	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
LFT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
LMT	       211.2 2011-01-28 14:30:00	 3666 2011-04-08 19:55:00
MAR	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MCD	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
MDT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MDY	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MEE	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
MET	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MJN	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
MMM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MON	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MOS	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MRK	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
MVG	       211.2 2011-01-21 14:30:00	 4055 2011-04-08 19:55:00
NEM	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
NFLX	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
NOC	       211.2 2011-01-28 14:30:00	 3666 2011-04-08 19:55:00
NUE	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
OIH	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
ORCL	       211.2 2011-03-01 14:30:00	 2262 2011-04-08 19:55:00
OXY	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
PAAS	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
PALL	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
PBR	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
PEP	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
PG	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
PM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
PNC	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
POT	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
PPLT	       211.2 2011-01-21 14:30:00	 4285 2011-04-08 19:55:00
PRU	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
QCOM	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
QQQ	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
RDY	       211.2 2011-01-24 14:30:00	 3978 2011-04-08 19:55:00
RIG	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
RIMM	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
RTN	       211.2 2011-01-28 14:30:00	 3900 2011-04-08 19:55:00
SCCO	       211.2 2011-01-24 14:30:00	 4212 2011-04-08 19:55:00
SINA	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
SJM	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
SKX	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
SLB	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
SLV	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
SLW	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
SNDK	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
SOHU	       211.2 2011-01-24 14:30:00	 4212 2011-04-08 19:55:00
SPY	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00
STT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
SU	       211.2 2011-02-17 14:30:00	 2808 2011-04-08 19:55:00
SUN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
SVM	       211.2 2011-01-21 14:30:00	 4290 2011-04-08 19:55:00
SWC	       211.2 2011-01-19 14:30:00	 4212 2011-04-08 19:55:00
T	       211.2 2011-02-04 14:30:00	 2496 2011-04-08 19:55:00
TEVA	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
TGT	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
TKR	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
TLT	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
TSO	       211.2 2011-02-17 14:30:00	 2808 2011-04-08 19:55:00
UNH	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
UNP	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
UPS	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
V	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
VALE	       211.2 2011-01-24 14:30:00	 4212 2011-04-08 19:55:00
VECO	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
VLO	       211.2 2011-02-17 14:30:00	 2808 2011-04-08 19:55:00
VMW	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
WDC	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
WFMI	       211.2 2011-01-04 14:30:00	 4992 2011-04-08 19:55:00
WHR	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
WMT	       211.2 2010-12-27 14:30:00	 5694 2011-04-08 19:55:00
WYNN	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
X	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
XLB	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
XLE	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
XLU	       211.2 2011-01-04 14:30:00	 5226 2011-04-08 19:55:00
XOM	       211.2 2010-12-27 14:30:00	 5460 2011-04-08 19:55:00

163 rows selected.

Elapsed: 00:00:00.32
23:26:12 SQL> 
23:26:12 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
