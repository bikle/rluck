
SQL*Plus: Release 11.2.0.1.0 Production on Thu Jan 13 17:13:54 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

17:13:54 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
17:13:54 SQL> 17:13:54 SQL> --
17:13:54 SQL> -- merge.sql
17:13:54 SQL> --
17:13:54 SQL> 
17:13:54 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
17:13:54 SQL> 
17:13:54 SQL> 
17:13:54 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
17:13:54 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
17:13:54 SQL> 
17:13:54 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.90
17:13:54 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.30
17:13:55 SQL> 
17:13:55 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.08
17:13:55 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.04
17:13:55 SQL> 
17:13:55 SQL> CREATE TABLE ibs_dups COMPRESS AS
17:13:55   2  SELECT
17:13:55   3  tkr
17:13:55   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
17:13:55   5  ,clse
17:13:55   6  FROM ibs_stage
17:13:55   7  UNION
17:13:55   8  SELECT tkr,ydate,clse
17:13:55   9  FROM ibs_old
17:13:55  10  /

Table created.

Elapsed: 00:00:00.54
17:13:55 SQL> 
17:13:55 SQL> CREATE TABLE ibs5min COMPRESS AS
17:13:55   2  SELECT
17:13:55   3  tkr
17:13:55   4  ,ydate
17:13:55   5  ,AVG(clse)clse
17:13:55   6  FROM ibs_dups
17:13:55   7  GROUP BY tkr,ydate
17:13:55   8  /

Table created.

Elapsed: 00:00:00.41
17:13:56 SQL> 
17:13:56 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:00.67
17:13:57 SQL> 
17:13:57 SQL> -- I should see less than 60 min:
17:13:57 SQL> SELECT
17:13:57   2  tkr
17:13:57   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
17:13:57   4  ,MIN(ydate)
17:13:57   5  ,COUNT(ydate)
17:13:57   6  ,MAX(ydate)FROM
17:13:57   7  ibs5min
17:13:57   8  GROUP BY tkr
17:13:57   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AKAM	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
APA	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
APC	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
AXP	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BP	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BTU	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CAT	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CVS	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
MAR	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MDT	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
QQQQ	     1463.95 2010-12-27 09:00:00	 2036 2011-01-12 16:50:00
SINA	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
SPY	     1218.95 2010-12-27 09:00:00	 2379 2011-01-12 20:55:00
V	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
VECO	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
WDC	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
XOM	     1378.95 2010-12-27 09:00:00	 2128 2011-01-12 18:15:00
AFL	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMT	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
CTSH	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
IOC	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
JPM	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
SKX	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
SLB	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
STT	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
UNH	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
UNP	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
AIG	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
BBY	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CSX	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
CVX	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DD	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
EOG	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FCX	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FSLR	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HD	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HON	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
IBM	     1473.95 2010-12-27 09:00:00	 1863 2011-01-12 16:40:00
IWM	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
MEE	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
NFLX	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PRU	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
UPS	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
WHR	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
XLB	     1413.95 2011-01-04 14:30:00	  507 2011-01-12 17:40:00
XLE	     1413.95 2011-01-04 14:30:00	  507 2011-01-12 17:40:00
BEN	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CMI	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
COST	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DTV	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
ESRX	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
GG	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HPQ	     1473.95 2010-12-27 09:00:00	 1868 2011-01-12 16:40:00
KO	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MDY	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MET	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PNC	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SJM	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
SNDK	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
SUN	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
TGT	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
TKR	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
XLU	     1398.95 2011-01-04 14:30:00	  510 2011-01-12 17:55:00
ABT	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMGN	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMZN	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BHP	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
COF	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
DNDN	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
EBAY	     1218.95 2010-12-27 09:00:00	 1840 2011-01-12 20:55:00
FDX	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GLD	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
JNJ	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
LFT	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MOS	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
NEM	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
OXY	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PEP	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
PG	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
RIG	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
BA	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BBT	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BIDU	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
BRCM	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CELG	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CREE	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DE	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DIS	     1218.95 2010-12-27 09:00:00	 1818 2011-01-12 20:55:00
EWZ	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FFIV	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GDX	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GILD	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
GOOG		3.95 2010-12-27 09:00:00	 2176 2011-01-13 17:10:00
GS	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
HES	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
MMM	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MON	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MT	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PBR	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
PM	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
POT	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
TEVA	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
TLT	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
VMW	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
WFMI	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00
X	     1458.95 2011-01-04 12:40:00	 1008 2011-01-12 16:55:00
AAPL	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
ALL	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
BUCY	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CRM	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DVN	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
FLS	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
JOYG	     1473.95 2011-01-04 14:30:00	  495 2011-01-12 16:40:00
NUE	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
QCOM	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
SLV	     1218.95 2011-01-04 14:30:00	  546 2011-01-12 20:55:00
ABX	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AEM	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00
AMX	     1488.95 2011-01-04 14:30:00	  492 2011-01-12 16:25:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ARG	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
CLF	     1483.95 2011-01-04 14:30:00	  493 2011-01-12 16:30:00
COP	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
DIA	     1218.95 2010-12-27 09:00:00	 2027 2011-01-12 20:55:00
EFA	     1478.95 2011-01-04 14:30:00	  494 2011-01-12 16:35:00
JWN	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MCD	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MJN	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
MRK	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
OIH	     1468.95 2011-01-04 14:30:00	  496 2011-01-12 16:45:00
RIMM	     1463.95 2011-01-04 14:30:00	  497 2011-01-12 16:50:00
WMT	     1458.95 2010-12-27 09:00:00	 1947 2011-01-12 16:55:00
WYNN	     1458.95 2011-01-04 14:30:00	  498 2011-01-12 16:55:00

133 rows selected.

Elapsed: 00:00:00.07
17:13:57 SQL> 
17:13:57 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
