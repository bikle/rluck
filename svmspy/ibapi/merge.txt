
SQL*Plus: Release 11.2.0.1.0 Production on Tue Feb 1 06:49:01 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

06:49:01 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
06:49:01 SQL> 
06:49:01 SQL> 06:49:01 SQL> --
06:49:01 SQL> -- merge.sql
06:49:01 SQL> --
06:49:01 SQL> 
06:49:01 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
06:49:01 SQL> 
06:49:01 SQL> 
06:49:01 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
06:49:01 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
06:49:01 SQL> 
06:49:01 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.11
06:49:01 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.08
06:49:01 SQL> 
06:49:01 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.08
06:49:01 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.10
06:49:01 SQL> 
06:49:01 SQL> CREATE TABLE ibs_dups COMPRESS AS
06:49:01   2  SELECT
06:49:01   3  tkr
06:49:01   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
06:49:01   5  ,clse
06:49:01   6  FROM ibs_stage
06:49:01   7  UNION
06:49:01   8  SELECT tkr,ydate,clse
06:49:01   9  FROM ibs_old
06:49:01  10  /

Table created.

Elapsed: 00:00:00.89
06:49:02 SQL> 
06:49:02 SQL> CREATE TABLE ibs5min COMPRESS AS
06:49:02   2  SELECT
06:49:02   3  tkr
06:49:02   4  ,ydate
06:49:02   5  ,AVG(clse)clse
06:49:02   6  FROM ibs_dups
06:49:02   7  GROUP BY tkr,ydate
06:49:02   8  /

Table created.

Elapsed: 00:00:00.65
06:49:03 SQL> 
06:49:03 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:01.39
06:49:04 SQL> 
06:49:04 SQL> -- I should see less than 60 min:
06:49:04 SQL> SELECT
06:49:04   2  tkr
06:49:04   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
06:49:04   4  ,MIN(ydate)
06:49:04   5  ,COUNT(ydate)
06:49:04   6  ,MAX(ydate)FROM
06:49:04   7  ibs5min
06:49:04   8  GROUP BY tkr
06:49:04   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AKAM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
APA	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
APC	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AXP	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BP	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BTU	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CAT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CVS	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
HL	  364.066667 2011-01-18 12:30:00	  882 2011-02-01 00:45:00
MAR	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MDT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
QQQQ	  594.066667 2010-12-27 09:00:00	 3165 2011-01-31 20:55:00
SINA	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SLW	  594.066667 2011-01-21 14:30:00	  546 2011-01-31 20:55:00
SPY	  594.066667 2010-12-27 09:00:00	 3316 2011-01-31 20:55:00
SVM	  594.066667 2011-01-21 14:30:00	  648 2011-01-31 20:55:00
V	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
VECO	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
WDC	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
XOM	  364.066667 2010-12-27 09:00:00	 3452 2011-02-01 00:45:00
AFL	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AMT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AXU	  594.066667 2011-01-21 14:30:00	  546 2011-01-31 20:55:00
CTSH	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
IOC	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
JPM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SKX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SLB	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
STT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
UNH	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
UNP	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AIG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BBY	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CDE	  594.066667 2011-01-21 14:30:00	  546 2011-01-31 20:55:00
CSX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CVX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DD	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
EOG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
FCX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
FSLR	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
HD	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
HON	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
IBM	  594.066667 2010-12-27 09:00:00	 2949 2011-01-31 20:55:00
IWM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MEE	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
NFLX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
PRU	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
UPS	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
WHR	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
XLB	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
XLE	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BEN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CHK	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
CMI	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
COST	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DTV	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
ESRX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
GG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
HPQ	  594.066667 2010-12-27 09:00:00	 2974 2011-01-31 20:55:00
KO	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MDY	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MET	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MVG	  594.066667 2011-01-21 14:30:00	  545 2011-01-31 20:55:00
PAAS	  594.066667 2011-01-21 14:30:00	  546 2011-01-31 20:55:00
PALL	  594.066667 2011-01-21 14:30:00	  546 2011-01-31 20:55:00
PNC	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SJM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SNDK	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SUN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SWC	  594.066667 2011-01-19 14:30:00	  702 2011-01-31 20:55:00
TGT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
TKR	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
XLU	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
ABT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AMGN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AMZN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BHP	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
COF	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DNDN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
EBAY	  594.066667 2010-12-27 09:00:00	 2515 2011-01-31 20:55:00
EXK	  594.066667 2011-01-21 14:30:00	  546 2011-01-31 20:55:00
FDX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
GLD	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
JNJ	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
LFT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MOS	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
NEM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
OXY	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
PEP	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
PG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
RIG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AGU	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
BA	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BBT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BIDU	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BRCM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CELG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CREE	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DE	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DIS	  594.066667 2010-12-27 09:00:00	 2809 2011-01-31 20:55:00
EWZ	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
FFIV	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
GDX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
GILD	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
GOOG	  594.066667 2010-12-27 09:00:00	 3079 2011-01-31 20:55:00
GS	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
HES	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MMM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MON	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
PBR	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
PM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
POT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
RDY	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
SCCO	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
TEVA	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
TLT	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
VMW	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
WFMI	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
X	  594.066667 2011-01-04 12:40:00	 1992 2011-01-31 20:55:00
AAPL	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
ALL	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
BUCY	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CEO	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
CRM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DVN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
FLS	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
JOYG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
NUE	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
PPLT	  594.066667 2011-01-21 14:30:00	  545 2011-01-31 20:55:00
QCOM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SLV	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
SOHU	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
VALE	  594.066667 2011-01-24 14:30:00	  468 2011-01-31 20:55:00
ABX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AEM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
AMX	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
ARG	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
CLF	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
COP	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
DIA	  594.066667 2010-12-27 09:00:00	 3057 2011-01-31 20:55:00
EFA	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
JWN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MCD	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MJN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
MRK	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
OIH	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
RIMM	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00
WMT	  594.066667 2010-12-27 09:00:00	 2931 2011-01-31 20:55:00
WYNN	  594.066667 2011-01-04 14:30:00	 1482 2011-01-31 20:55:00

151 rows selected.

Elapsed: 00:00:00.08
06:49:04 SQL> 
06:49:04 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
