
SQL*Plus: Release 11.2.0.1.0 Production on Thu Jan 20 22:31:57 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

22:31:58 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
22:31:58 SQL> 
22:31:58 SQL> 22:31:58 SQL> --
22:31:58 SQL> -- merge.sql
22:31:58 SQL> --
22:31:58 SQL> 
22:31:58 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
22:31:58 SQL> 
22:31:58 SQL> 
22:31:58 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
22:31:58 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
22:31:58 SQL> 
22:31:58 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.17
22:31:58 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.04
22:31:58 SQL> 
22:31:58 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.03
22:31:58 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.10
22:31:58 SQL> 
22:31:58 SQL> CREATE TABLE ibs_dups COMPRESS AS
22:31:58   2  SELECT
22:31:58   3  tkr
22:31:58   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
22:31:58   5  ,clse
22:31:58   6  FROM ibs_stage
22:31:58   7  UNION
22:31:58   8  SELECT tkr,ydate,clse
22:31:58   9  FROM ibs_old
22:31:58  10  /

Table created.

Elapsed: 00:00:00.58
22:31:58 SQL> 
22:31:58 SQL> CREATE TABLE ibs5min COMPRESS AS
22:31:58   2  SELECT
22:31:58   3  tkr
22:31:58   4  ,ydate
22:31:58   5  ,AVG(clse)clse
22:31:58   6  FROM ibs_dups
22:31:58   7  GROUP BY tkr,ydate
22:31:58   8  /

Table created.

Elapsed: 00:00:00.34
22:31:59 SQL> 
22:31:59 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:00.81
22:32:00 SQL> 
22:32:00 SQL> -- I should see less than 60 min:
22:32:00 SQL> SELECT
22:32:00   2  tkr
22:32:00   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
22:32:00   4  ,MIN(ydate)
22:32:00   5  ,COUNT(ydate)
22:32:00   6  ,MAX(ydate)FROM
22:32:00   7  ibs5min
22:32:00   8  GROUP BY tkr
22:32:00   9  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ADBE		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
AKAM		 137 2011-01-04 14:30:00	  928 2011-01-20 20:15:00
APA		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
APC		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
AXP		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
BP		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
BTU		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
CAT		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
CVS		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
MAR		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
MDT		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
QQQQ		 187 2010-12-27 09:00:00	 2601 2011-01-20 19:25:00
SINA		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
SPY		  97 2010-12-27 09:00:00	 2770 2011-01-20 20:55:00
V		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
VECO		 152 2011-01-04 14:30:00	  925 2011-01-20 20:00:00
WDC		 147 2011-01-04 14:30:00	  926 2011-01-20 20:05:00
XOM		 227 2010-12-27 09:00:00	 2533 2011-01-20 18:45:00
AFL		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
AMT		 172 2011-01-04 14:30:00	  921 2011-01-20 19:40:00
CTSH		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
IOC		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
JPM		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
SKX		 162 2011-01-04 14:30:00	  923 2011-01-20 19:50:00
SLB		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
STT		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
UNH		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
UNP		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
AIG		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
BBY		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
CSX		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
CVX		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
DD		 117 2011-01-04 14:30:00	  932 2011-01-20 20:35:00
EOG		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
FCX		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
FSLR		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
HD		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
HON		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
IBM		 122 2010-12-27 09:00:00	 2398 2011-01-20 20:30:00
IWM		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
MEE		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
NFLX		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
PRU		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
UPS		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
WHR		 227 2011-01-04 14:30:00	  910 2011-01-20 18:45:00
XLB		 197 2011-01-04 14:30:00	  916 2011-01-20 19:15:00
XLE		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
BEN		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
CMI		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
COST		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
DTV		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
ESRX		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
GG		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
HPQ		 247 2010-12-27 09:00:00	 2398 2011-01-20 18:25:00
KO		 142 2011-01-04 14:30:00	  927 2011-01-20 20:10:00
MDY		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
MET		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
PNC		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
SJM		 177 2011-01-04 14:30:00	  920 2011-01-20 19:35:00
SNDK		 107 2011-01-04 14:30:00	  934 2011-01-20 20:45:00
SUN		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
TGT		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
TKR		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
XLU		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
ABT		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
AMGN		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
AMZN		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
BHP		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
COF		 102 2011-01-04 14:30:00	  935 2011-01-20 20:50:00
DNDN		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
EBAY		8737 2010-12-27 09:00:00	 2047 2011-01-14 20:55:00
FDX		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
GLD		 157 2011-01-04 14:30:00	  924 2011-01-20 19:55:00
JNJ		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
LFT		 212 2011-01-04 14:30:00	  913 2011-01-20 19:00:00
MOS		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
NEM		 177 2011-01-04 14:30:00	  920 2011-01-20 19:35:00
OXY		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
PEP		 132 2011-01-04 14:30:00	  929 2011-01-20 20:20:00
PG		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
RIG		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
BA		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
BBT		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
BIDU		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
BRCM		 162 2011-01-04 14:30:00	  923 2011-01-20 19:50:00
CELG		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
CREE		 112 2011-01-04 14:30:00	  933 2011-01-20 20:40:00
DE		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
DIS		  97 2010-12-27 09:00:00	 2263 2011-01-20 20:55:00
EWZ		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
FFIV		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
GDX		 172 2011-01-04 14:30:00	  921 2011-01-20 19:40:00
GILD		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
GOOG		 127 2010-12-27 09:00:00	 2527 2011-01-20 20:25:00
GS		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
HES		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
MMM		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
MON		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
MT		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
PBR		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
PM		 182 2011-01-04 14:30:00	  919 2011-01-20 19:30:00
POT		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
TEVA		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
TLT		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
VMW		 192 2011-01-04 14:30:00	  917 2011-01-20 19:20:00
WFMI		 232 2011-01-04 14:30:00	  909 2011-01-20 18:40:00
X		 227 2011-01-04 12:40:00	 1420 2011-01-20 18:45:00
AAPL		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
ALL		 152 2011-01-04 14:30:00	  925 2011-01-20 20:00:00
BUCY		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
CRM		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
DVN		 252 2011-01-04 14:30:00	  905 2011-01-20 18:20:00
FLS		 247 2011-01-04 14:30:00	  906 2011-01-20 18:25:00
JOYG		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
NUE		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
QCOM		 132 2011-01-04 14:30:00	  929 2011-01-20 20:20:00
SLV		 142 2011-01-04 14:30:00	  927 2011-01-20 20:10:00
ABX		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
AEM		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
AMX		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
ARG		 262 2011-01-04 14:30:00	  903 2011-01-20 18:10:00
CLF		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
COP		 257 2011-01-04 14:30:00	  904 2011-01-20 18:15:00
DIA		  97 2010-12-27 09:00:00	 2511 2011-01-20 20:55:00
EFA		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
JWN		 242 2011-01-04 14:30:00	  907 2011-01-20 18:30:00
MCD		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
MJN		 222 2011-01-04 14:30:00	  911 2011-01-20 18:50:00
MRK		 107 2011-01-04 14:30:00	  934 2011-01-20 20:45:00
OIH		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00
RIMM		 237 2011-01-04 14:30:00	  908 2011-01-20 18:35:00
WMT		  97 2010-12-27 09:00:00	 2385 2011-01-20 20:55:00
WYNN		  97 2011-01-04 14:30:00	  936 2011-01-20 20:55:00

133 rows selected.

Elapsed: 00:00:00.06
22:32:00 SQL> 
22:32:00 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
