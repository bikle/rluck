
SQL*Plus: Release 11.2.0.1.0 Production on Wed Mar 30 15:14:51 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

15:14:51 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
15:14:51 SQL> 
15:14:51 SQL> 15:14:51 SQL> --
15:14:51 SQL> -- merge.sql
15:14:51 SQL> --
15:14:51 SQL> 
15:14:51 SQL> -- I use this script to merge data from ibs_stage into ibs5min.
15:14:51 SQL> 
15:14:51 SQL> 
15:14:51 SQL> -- CREATE TABLE ibs_old	  (tkr VARCHAR2(8),ydate DATE,clse NUMBER);
15:14:51 SQL> -- CREATE TABLE ibs_dups_old(tkr VARCHAR2(8),ydate DATE,clse NUMBER);
15:14:51 SQL> 
15:14:51 SQL> DROP TABLE ibs_old;

Table dropped.

Elapsed: 00:00:00.30
15:14:51 SQL> RENAME ibs5min TO ibs_old;

Table renamed.

Elapsed: 00:00:00.04
15:14:52 SQL> 
15:14:52 SQL> DROP TABLE ibs_dups_old;

Table dropped.

Elapsed: 00:00:00.28
15:14:52 SQL> RENAME ibs_dups TO ibs_dups_old;

Table renamed.

Elapsed: 00:00:00.04
15:14:52 SQL> 
15:14:52 SQL> CREATE TABLE ibs_dups COMPRESS AS
15:14:52   2  SELECT
15:14:52   3  tkr
15:14:52   4  ,(TO_DATE('1970-01-01','YYYY-MM-DD')+(epochsec/24/3600))ydate
15:14:52   5  ,clse
15:14:52   6  FROM ibs_stage
15:14:52   7  UNION
15:14:52   8  SELECT tkr,ydate,clse
15:14:52   9  FROM ibs_old
15:14:52  10  /

Table created.

Elapsed: 00:00:03.09
15:14:55 SQL> 
15:14:55 SQL> CREATE TABLE ibs5min COMPRESS AS
15:14:55   2  SELECT
15:14:55   3  tkr
15:14:55   4  ,ydate
15:14:55   5  ,AVG(clse)clse
15:14:55   6  FROM ibs_dups
15:14:55   7  GROUP BY tkr,ydate
15:14:55   8  /

Table created.

Elapsed: 00:00:01.99
15:14:57 SQL> 
15:14:57 SQL> ANALYZE TABLE ibs5min COMPUTE STATISTICS;

Table analyzed.

Elapsed: 00:00:04.19
15:15:01 SQL> 
15:15:01 SQL> -- I should see less than 60 min:
15:15:01 SQL> SELECT
15:15:01   2  tkr
15:15:01   3  ,(sysdate - MAX(ydate))*24*60 minutes_age
15:15:01   4  ,MIN(ydate)
15:15:01   5  ,COUNT(ydate)
15:15:01   6  ,MAX(ydate)FROM
15:15:01   7  ibs5min
15:15:01   8  GROUP BY tkr
15:15:01   9  ORDER BY tkr
15:15:01  10  /

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
AAPL	  75.0166667 2011-01-04 14:30:00	 4609 2011-03-30 14:00:00
ABT	  75.0166667 2011-01-04 14:30:00	 4609 2011-03-30 14:00:00
ABX	  75.0166667 2011-01-04 14:30:00	 4609 2011-03-30 14:00:00
ADBE	  75.0166667 2011-01-04 14:30:00	 4609 2011-03-30 14:00:00
AEM	  75.0166667 2011-01-04 14:30:00	 4609 2011-03-30 14:00:00
AFL	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AGU	  70.0166667 2011-01-24 14:30:00	 3596 2011-03-30 14:05:00
AIG	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AKAM	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
ALL	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AMGN	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AMT	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AMX	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AMZN	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
APA	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
APC	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
ARG	  70.0166667 2011-01-04 14:30:00	 4610 2011-03-30 14:05:00
AXP	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
AXU	  65.0166667 2011-01-21 14:30:00	 3675 2011-03-30 14:10:00
BA	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BBT	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BBY	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BEN	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BHP	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BIDU	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BP	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BRCM	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BTU	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
BUCY	  65.0166667 2011-01-04 14:30:00	 4611 2011-03-30 14:10:00
CAT	  1440.01667 2011-01-04 14:30:00	 4546 2011-03-29 15:15:00
CDE	  1440.01667 2011-01-21 14:30:00	 3610 2011-03-29 15:15:00
CELG	  1440.01667 2011-01-04 14:30:00	 4546 2011-03-29 15:15:00
CEO	  1440.01667 2011-01-24 14:30:00	 3532 2011-03-29 15:15:00
CHK	  1440.01667 2011-01-24 14:30:00	 3532 2011-03-29 15:15:00
CLF	  1440.01667 2011-01-04 14:30:00	 4546 2011-03-29 15:15:00
CMI	  1440.01667 2011-01-04 14:30:00	 4546 2011-03-29 15:15:00
COF	  1440.01667 2011-01-04 14:30:00	 4546 2011-03-29 15:15:00
COP	  1440.01667 2011-01-04 14:30:00	 4546 2011-03-29 15:15:00
COST	  1435.01667 2011-01-04 14:30:00	 4547 2011-03-29 15:20:00
CREE	  60.0166667 2011-01-04 14:30:00	 4612 2011-03-30 14:15:00
CRM	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
CSX	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
CTSH	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
CVE	  55.0166667 2011-02-14 14:30:00	 3141 2011-03-30 14:20:00
CVS	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
CVX	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
DD	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
DE	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
DIA	  55.0166667 2010-12-27 09:00:00	 6188 2011-03-30 14:20:00
DIS	  55.0166667 2010-12-27 09:00:00	 5940 2011-03-30 14:20:00
DNDN	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
DTV	  55.0166667 2011-01-04 14:30:00	 4613 2011-03-30 14:20:00
DVN	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
EBAY	  50.0166667 2010-12-27 09:00:00	 5978 2011-03-30 14:25:00
EFA	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
EOG	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
ESRX	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
EWZ	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
EXK	  50.0166667 2011-01-21 14:30:00	 4487 2011-03-30 14:25:00
FCX	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
FDX	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
FFIV	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
FLS	  50.0166667 2011-01-04 14:30:00	 4548 2011-03-30 14:25:00
FSLR	  50.0166667 2011-01-04 14:30:00	 4614 2011-03-30 14:25:00
GD	  45.0166667 2011-01-28 14:30:00	 3289 2011-03-30 14:30:00
GDX	  45.0166667 2011-01-04 14:30:00	 4615 2011-03-30 14:30:00
GFI	  45.0166667 2011-01-28 14:30:00	 3055 2011-03-30 14:30:00
GG	  45.0166667 2011-01-04 14:30:00	 4381 2011-03-30 14:30:00
GILD	  45.0166667 2011-01-04 14:30:00	 4381 2011-03-30 14:30:00
GLD	  45.0166667 2011-01-04 14:30:00	 4381 2011-03-30 14:30:00
GOOG	  45.0166667 2010-12-27 09:00:00	 5978 2011-03-30 14:30:00
GS	  45.0166667 2011-01-04 14:30:00	 4615 2011-03-30 14:30:00
HD	  45.0166667 2011-01-04 14:30:00	 4615 2011-03-30 14:30:00
HES	  45.0166667 2011-01-04 14:30:00	 4615 2011-03-30 14:30:00
HL	  45.0166667 2011-01-18 12:30:00	 4015 2011-03-30 14:30:00
HOC	  40.0166667 2011-02-17 14:30:00	 2198 2011-03-30 14:35:00
HON	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
HPQ	  40.0166667 2010-12-27 09:00:00	 6108 2011-03-30 14:35:00
IBM	  40.0166667 2010-12-27 09:00:00	 6083 2011-03-30 14:35:00
IOC	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
IWM	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
JNJ	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
JOYG	  40.0166667 2011-01-04 14:30:00	 4382 2011-03-30 14:35:00
JPM	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
JWN	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
KO	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
LFT	  40.0166667 2011-01-04 14:30:00	 4616 2011-03-30 14:35:00
LMT	  35.0166667 2011-01-28 14:30:00	 3057 2011-03-30 14:40:00
MAR	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MCD	  35.0166667 2011-01-04 14:30:00	 4383 2011-03-30 14:40:00
MDT	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MDY	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MEE	  35.0166667 2011-01-04 14:30:00	 4383 2011-03-30 14:40:00
MET	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MJN	  35.0166667 2011-01-04 14:30:00	 4383 2011-03-30 14:40:00
MMM	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MON	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MOS	  35.0166667 2011-01-04 14:30:00	 4617 2011-03-30 14:40:00
MRK	  30.0166667 2011-01-04 14:30:00	 4618 2011-03-30 14:45:00
MT	  30.0166667 2011-01-04 14:30:00	 4618 2011-03-30 14:45:00
MVG	  30.0166667 2011-01-21 14:30:00	 3447 2011-03-30 14:45:00
NEM	  30.0166667 2011-01-04 14:30:00	 4384 2011-03-30 14:45:00
NFLX	  30.0166667 2011-01-04 14:30:00	 4384 2011-03-30 14:45:00
NOC	  30.0166667 2011-01-28 14:30:00	 3058 2011-03-30 14:45:00
NUE	  30.0166667 2011-01-04 14:30:00	 4384 2011-03-30 14:45:00
OIH	  30.0166667 2011-01-04 14:30:00	 4618 2011-03-30 14:45:00
ORCL	  75.0166667 2011-03-01 14:30:00	 1645 2011-03-30 14:00:00
OXY	  30.0166667 2011-01-04 14:30:00	 4618 2011-03-30 14:45:00
PAAS	  30.0166667 2011-01-21 14:30:00	 3682 2011-03-30 14:45:00
PALL	  30.0166667 2011-01-21 14:30:00	 3682 2011-03-30 14:45:00
PBR	  30.0166667 2011-01-04 14:30:00	 4618 2011-03-30 14:45:00
PEP	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
PG	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
PM	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
PNC	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
POT	  25.0166667 2011-01-04 14:30:00	 4385 2011-03-30 14:50:00
PPLT	  25.0166667 2011-01-21 14:30:00	 3680 2011-03-30 14:50:00
PRU	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
QCOM	  25.0166667 2011-01-04 14:30:00	 4385 2011-03-30 14:50:00
QQQ	  25.0166667 2010-12-27 09:00:00	 6302 2011-03-30 14:50:00

TKR	 MINUTES_AGE MIN(YDATE) 	 COUNT(YDATE) MAX(YDATE)
-------- ----------- ------------------- ------------ -------------------
QQQQ	  11240.0167 2010-12-27 09:00:00	 5895 2011-03-22 19:55:00
RDY	  25.0166667 2011-01-24 14:30:00	 3371 2011-03-30 14:50:00
RIG	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
RIMM	  25.0166667 2011-01-04 14:30:00	 4619 2011-03-30 14:50:00
RTN	  20.0166667 2011-01-28 14:30:00	 3294 2011-03-30 14:55:00
SCCO	  20.0166667 2011-01-24 14:30:00	 3606 2011-03-30 14:55:00
SINA	  20.0166667 2011-01-04 14:30:00	 4386 2011-03-30 14:55:00
SJM	  20.0166667 2011-01-04 14:30:00	 4386 2011-03-30 14:55:00
SKX	  20.0166667 2011-01-04 14:30:00	 4620 2011-03-30 14:55:00
SLB	  20.0166667 2011-01-04 14:30:00	 4620 2011-03-30 14:55:00
SLV	  20.0166667 2011-01-04 14:30:00	 4620 2011-03-30 14:55:00
SLW	  20.0166667 2011-01-21 14:30:00	 3684 2011-03-30 14:55:00
SNDK	  20.0166667 2011-01-04 14:30:00	 4620 2011-03-30 14:55:00
SOHU	  20.0166667 2011-01-24 14:30:00	 3606 2011-03-30 14:55:00
SPY	  20.0166667 2010-12-27 09:00:00	 6454 2011-03-30 14:55:00
STT	  15.0166667 2011-01-04 14:30:00	 4621 2011-03-30 15:00:00
SU	  15.0166667 2011-02-17 14:30:00	 2203 2011-03-30 15:00:00
SUN	  15.0166667 2011-01-04 14:30:00	 4621 2011-03-30 15:00:00
SVM	  15.0166667 2011-01-21 14:30:00	 4908 2011-03-30 15:00:00
SWC	  15.0166667 2011-01-19 14:30:00	 3607 2011-03-30 15:00:00
T	  75.0166667 2011-02-04 14:30:00	 1879 2011-03-30 14:00:00
TEVA	  15.0166667 2011-01-04 14:30:00	 4387 2011-03-30 15:00:00
TGT	  15.0166667 2011-01-04 14:30:00	 4387 2011-03-30 15:00:00
TKR	  15.0166667 2011-01-04 14:30:00	 4621 2011-03-30 15:00:00
TLT	  15.0166667 2011-01-04 14:30:00	 4621 2011-03-30 15:00:00
TSO	  15.0166667 2011-02-17 14:30:00	 2203 2011-03-30 15:00:00
UNH	  15.0166667 2011-01-04 14:30:00	 4387 2011-03-30 15:00:00
UNP	  10.0166667 2011-01-04 14:30:00	 4388 2011-03-30 15:05:00
UPS	  10.0166667 2011-01-04 14:30:00	 4622 2011-03-30 15:05:00
V	  10.0166667 2011-01-04 14:30:00	 4622 2011-03-30 15:05:00
VALE	  10.0166667 2011-01-24 14:30:00	 3608 2011-03-30 15:05:00
VECO	  10.0166667 2011-01-04 14:30:00	 4622 2011-03-30 15:05:00
VLO	  10.0166667 2011-02-17 14:30:00	 2204 2011-03-30 15:05:00
VMW	  10.0166667 2011-01-04 14:30:00	 4388 2011-03-30 15:05:00
WDC	  10.0166667 2011-01-04 14:30:00	 4622 2011-03-30 15:05:00
WFMI	  10.0166667 2011-01-04 14:30:00	 4388 2011-03-30 15:05:00
WHR	  10.0166667 2011-01-04 14:30:00	 4622 2011-03-30 15:05:00
WMT	  10.0166667 2010-12-27 09:00:00	 6071 2011-03-30 15:05:00
WYNN	  10.0166667 2011-01-04 14:30:00	 4622 2011-03-30 15:05:00
X	  5.01666667 2011-01-04 12:40:00	 5133 2011-03-30 15:10:00
XLB	  5.01666667 2011-01-04 14:30:00	 4623 2011-03-30 15:10:00
XLE	  5.01666667 2011-01-04 14:30:00	 4623 2011-03-30 15:10:00
XLU	  5.01666667 2011-01-04 14:30:00	 4623 2011-03-30 15:10:00
XOM	  5.01666667 2010-12-27 09:00:00	 6359 2011-03-30 15:10:00

164 rows selected.

Elapsed: 00:00:00.31
15:15:01 SQL> 
15:15:01 SQL> exit
Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
