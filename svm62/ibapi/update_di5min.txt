
SQL*Plus: Release 11.2.0.1.0 Production on Sat Feb 26 00:08:32 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

00:08:32 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
00:08:32 SQL> 00:08:32 SQL> --
00:08:32 SQL> -- update_di5min.sql
00:08:32 SQL> --
00:08:32 SQL> 
00:08:32 SQL> -- I use this script to keep the di5min table up to date.
00:08:32 SQL> 
00:08:32 SQL> -- CREATE TABLE di5min0(prdate VARCHAR2(26),pair VARCHAR2(7),ydate DATE,clse NUMBER);
00:08:32 SQL> -- CREATE TABLE di5min (prdate VARCHAR2(26),pair VARCHAR2(7),ydate DATE,clse NUMBER);
00:08:32 SQL> 
00:08:32 SQL> TRUNCATE TABLE di5min0;

Table truncated.

Elapsed: 00:00:00.50
00:08:33 SQL> DROP TABLE di5min;

Table dropped.

Elapsed: 00:00:00.18
00:08:33 SQL> PURGE RECYCLEBIN;

Recyclebin purged.

Elapsed: 00:00:00.26
00:08:33 SQL> 
00:08:33 SQL> -- Copy in data from ibf5min:
00:08:33 SQL> 
00:08:33 SQL> INSERT INTO di5min0(prdate,pair,ydate,clse)
00:08:33   2  SELECT	     pair||ydate,pair,ydate,clse
00:08:33   3  FROM ibf5min
00:08:33   4  WHERE ydate >= '2010-11-30'
00:08:33   5  /

108904 rows created.

Elapsed: 00:00:00.24
00:08:34 SQL> 
00:08:34 SQL> -- rpt
00:08:34 SQL> SELECT
00:08:34   2  pair
00:08:34   3  ,MIN(ydate)
00:08:34   4  ,COUNT(pair)
00:08:34   5  ,MAX(ydate)
00:08:34   6  FROM di5min0
00:08:34   7  GROUP BY pair
00:08:34   8  ORDER BY pair
00:08:34   9  
00:08:34 SQL> -- Next, copy in data from dukas:
00:08:34 SQL> 
00:08:34 SQL> INSERT INTO di5min0(prdate,pair,ydate,clse)
00:08:34   2  SELECT	     pair||ydate,pair,ydate,clse
00:08:34   3  FROM dukas5min
00:08:34   4  WHERE ydate < '2010-11-30'
00:08:34   5  AND ydate > sysdate - 100
00:08:34   6  /

13896 rows created.

Elapsed: 00:00:00.04
00:08:34 SQL> 
00:08:34 SQL> -- rpt
00:08:34 SQL> SELECT
00:08:34   2  pair
00:08:34   3  ,MIN(ydate)
00:08:34   4  ,COUNT(pair)
00:08:34   5  ,MAX(ydate)
00:08:34   6  FROM dukas5min
00:08:34   7  GROUP BY pair
00:08:34   8  ORDER BY pair
00:08:34   9  
00:08:34 SQL> -- rpt
00:08:34 SQL> SELECT
00:08:34   2  pair
00:08:34   3  ,MIN(ydate)
00:08:34   4  ,COUNT(pair)
00:08:34   5  ,MAX(ydate)
00:08:34   6  FROM di5min0
00:08:34   7  GROUP BY pair
00:08:34   8  ORDER BY pair
00:08:34   9  
00:08:34 SQL> -- Create other pairs like EUR/CHF:
00:08:34 SQL> @create_other_pairs.sql
00:08:34 SQL> --
00:08:34 SQL> -- create_other_pairs.sql
00:08:34 SQL> --
00:08:34 SQL> 
00:08:34 SQL> -- I use this script to create other non-USD pairs like EUR/CHF.
00:08:34 SQL> 
00:08:34 SQL> -- DROP TABLE op5min;
00:08:34 SQL> -- CREATE TABLE op5min(prdate VARCHAR2(26),pair VARCHAR2(7), ydate DATE, clse NUMBER);
00:08:34 SQL> 
00:08:34 SQL> TRUNCATE TABLE op5min;

Table truncated.

Elapsed: 00:00:00.28
00:08:34 SQL> 
00:08:34 SQL> -- Create the EUR/AUD pair:
00:08:34 SQL> 
00:08:34 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
00:08:34   2  SELECT
00:08:34   3  'eur_aud'||e.ydate prdate
00:08:34   4  ,'eur_aud' pair
00:08:34   5  ,e.ydate
00:08:34   6  ,e.clse/g.clse clse
00:08:34   7  FROM di5min0 e, di5min0 g
00:08:34   8  WHERE e.ydate = g.ydate
00:08:34   9  AND e.pair = 'eur_usd'
00:08:34  10  AND g.pair = 'aud_usd'
00:08:34  11  /

20461 rows created.

Elapsed: 00:00:00.13
00:08:34 SQL> 
00:08:34 SQL> -- Create the EUR/CHF pair:
00:08:34 SQL> 
00:08:34 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
00:08:34   2  SELECT
00:08:34   3  'eur_chf'||e.ydate prdate
00:08:34   4  ,'eur_chf' pair
00:08:34   5  ,e.ydate
00:08:34   6  ,e.clse*c.clse clse
00:08:34   7  FROM di5min0 e, di5min0 c
00:08:34   8  WHERE e.ydate = c.ydate
00:08:34   9  AND e.pair = 'eur_usd'
00:08:34  10  AND c.pair = 'usd_chf'
00:08:34  11  /

20466 rows created.

Elapsed: 00:00:00.07
00:08:34 SQL> 
00:08:34 SQL> -- Create the EUR/GBP pair:
00:08:34 SQL> 
00:08:34 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
00:08:34   2  SELECT
00:08:34   3  'eur_gbp'||e.ydate prdate
00:08:34   4  ,'eur_gbp' pair
00:08:34   5  ,e.ydate
00:08:34   6  ,e.clse/g.clse clse
00:08:34   7  FROM di5min0 e, di5min0 g
00:08:34   8  WHERE e.ydate = g.ydate
00:08:34   9  AND e.pair = 'eur_usd'
00:08:34  10  AND g.pair = 'gbp_usd'
00:08:34  11  /

20465 rows created.

Elapsed: 00:00:00.08
00:08:34 SQL> 
00:08:34 SQL> 
00:08:34 SQL> -- Create the EUR/JPY pair:
00:08:34 SQL> 
00:08:34 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
00:08:34   2  SELECT
00:08:34   3  'eur_jpy'||e.ydate prdate
00:08:34   4  ,'eur_jpy' pair
00:08:34   5  ,e.ydate
00:08:34   6  ,e.clse*j.clse clse
00:08:34   7  FROM di5min0 e, di5min0 j
00:08:34   8  WHERE e.ydate = j.ydate
00:08:34   9  AND e.pair = 'eur_usd'
00:08:34  10  AND j.pair = 'usd_jpy'
00:08:34  11  /

20461 rows created.

Elapsed: 00:00:00.07
00:08:34 SQL> 
00:08:34 SQL> -- Create the AUD/JPY pair:
00:08:34 SQL> 
00:08:34 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
00:08:34   2  SELECT
00:08:34   3  'aud_jpy'||a.ydate prdate
00:08:34   4  ,'aud_jpy' pair
00:08:34   5  ,a.ydate
00:08:34   6  ,a.clse*j.clse clse
00:08:34   7  FROM di5min0 a, di5min0 j
00:08:34   8  WHERE a.ydate = j.ydate
00:08:34   9  AND a.pair = 'aud_usd'
00:08:34  10  AND j.pair = 'usd_jpy'
00:08:34  11  /

20456 rows created.

Elapsed: 00:00:00.07
00:08:34 SQL> 
00:08:34 SQL> -- rpt
00:08:34 SQL> 
00:08:34 SQL> SELECT * FROM op5min
00:08:34   2  WHERE ydate > sysdate - 0.5/24
00:08:34   3  ORDER BY prdate
00:08:34   4  /

no rows selected

Elapsed: 00:00:00.00
00:08:34 SQL> 
00:08:34 SQL> -- Dont put an exit here.
00:08:34 SQL> -- This script is called from another SQL script.
00:08:34 SQL> -- Here is what I want:
00:08:34 SQL> 
00:08:34 SQL> CREATE TABLE di5min COMPRESS AS
00:08:34   2  SELECT
00:08:34   3  prdate
00:08:34   4  ,pair
00:08:34   5  ,ydate
00:08:34   6  ,clse
00:08:34   7  FROM
00:08:34   8  (
00:08:34   9  	SELECT
00:08:34  10  	prdate
00:08:34  11  	,pair
00:08:34  12  	,ydate
00:08:34  13  	,AVG(clse)clse
00:08:34  14  	FROM di5min0
00:08:34  15  	GROUP BY
00:08:34  16  	prdate
00:08:34  17  	,pair
00:08:34  18  	,ydate
00:08:34  19  	UNION
00:08:34  20  	SELECT
00:08:34  21  	prdate
00:08:34  22  	,pair
00:08:34  23  	,ydate
00:08:34  24  	,clse
00:08:34  25  	FROM op5min
00:08:34  26  )
00:08:34  27  /

Table created.

Elapsed: 00:00:01.46
00:08:36 SQL> 
00:08:36 SQL> -- rpt
00:08:36 SQL> SELECT
00:08:36   2  pair
00:08:36   3  ,MIN(ydate)
00:08:36   4  ,COUNT(ydate)
00:08:36   5  ,MAX(ydate)
00:08:36   6  ,MIN(clse)
00:08:36   7  ,AVG(clse)
00:08:36   8  ,MAX(clse)
00:08:36   9  FROM di5min
00:08:36  10  GROUP BY pair
00:08:36  11  ORDER BY pair
00:08:36  12  /

PAIR	MIN(YDATE)	    COUNT(YDATE) MAX(YDATE)	      MIN(CLSE)  AVG(CLSE)  MAX(CLSE)
------- ------------------- ------------ ------------------- ---------- ---------- ----------
aud_jpy 2010-11-18 00:10:00	   20456 2011-02-25 21:55:00 79.8015123 82.6001245 84.4451413
aud_usd 2010-11-18 00:10:00	   20462 2011-02-25 21:55:00	 .95405 .995945345     1.0246
eur_aud 2010-11-18 00:10:00	   20461 2011-02-25 21:55:00 1.29324263 1.34542468   1.392752
eur_chf 2010-11-18 00:10:00	   20466 2011-02-25 21:55:00 1.24192946 1.29144133 1.36639531
eur_gbp 2010-11-18 00:10:00	   20465 2011-02-25 21:55:00 .829062716 .847266865 .867050282
eur_jpy 2010-11-18 00:10:00	   20461 2011-02-25 21:55:00 106.906797 111.124774 114.875523
eur_usd 2010-11-18 00:10:00	   20467 2011-02-25 21:55:00	1.28795 1.33984445	1.386
gbp_usd 2010-11-18 00:10:00	   20467 2011-02-25 21:55:00   1.535325  1.5813854    1.62765
usd_cad 2010-11-18 00:10:00	   20467 2011-02-25 21:55:00   .9776375 1.00002618   1.028075
usd_chf 2010-11-18 00:10:00	   20471 2011-02-25 21:55:00	 .92385 .964022684    1.00635
usd_jpy 2010-11-18 00:10:00	   20466 2011-02-25 21:55:00	81.0225 82.9437867     84.485

11 rows selected.

Elapsed: 00:00:00.17
00:08:36 SQL> 
00:08:36 SQL> COLUMN clse FORMAT 999.9999
00:08:36 SQL> SELECT
00:08:36   2  pair
00:08:36   3  ,ROUND(clse,4)clse
00:08:36   4  ,ydate
00:08:36   5  FROM di5min
00:08:36   6  WHERE ydate > sysdate - 3/24
00:08:36   7  ORDER BY pair,ydate
00:08:36   8  /

PAIR	     CLSE YDATE
------- --------- -------------------
aud_jpy   83.0937 2011-02-25 21:10:00
aud_jpy   83.1013 2011-02-25 21:15:00
aud_jpy   83.1079 2011-02-25 21:20:00
aud_jpy   83.1244 2011-02-25 21:25:00
aud_jpy   83.1186 2011-02-25 21:30:00
aud_jpy   83.1026 2011-02-25 21:35:00
aud_jpy   83.1415 2011-02-25 21:40:00
aud_jpy   83.1382 2011-02-25 21:45:00
aud_jpy   83.1960 2011-02-25 21:50:00
aud_jpy   83.1555 2011-02-25 21:55:00
aud_usd    1.0177 2011-02-25 21:10:00
aud_usd    1.0176 2011-02-25 21:15:00
aud_usd    1.0176 2011-02-25 21:20:00
aud_usd    1.0176 2011-02-25 21:25:00
aud_usd    1.0177 2011-02-25 21:30:00
aud_usd    1.0177 2011-02-25 21:35:00
aud_usd    1.0177 2011-02-25 21:40:00
aud_usd    1.0178 2011-02-25 21:45:00
aud_usd    1.0178 2011-02-25 21:50:00
aud_usd    1.0177 2011-02-25 21:55:00
eur_aud    1.3511 2011-02-25 21:10:00
eur_aud    1.3507 2011-02-25 21:15:00
eur_aud    1.3510 2011-02-25 21:20:00
eur_aud    1.3510 2011-02-25 21:25:00
eur_aud    1.3510 2011-02-25 21:30:00
eur_aud    1.3508 2011-02-25 21:35:00
eur_aud    1.3510 2011-02-25 21:40:00
eur_aud    1.3508 2011-02-25 21:45:00
eur_aud    1.3510 2011-02-25 21:50:00
eur_aud    1.3514 2011-02-25 21:55:00
eur_chf    1.2761 2011-02-25 21:10:00
eur_chf    1.2760 2011-02-25 21:15:00
eur_chf    1.2769 2011-02-25 21:20:00
eur_chf    1.2769 2011-02-25 21:25:00
eur_chf    1.2766 2011-02-25 21:30:00
eur_chf    1.2766 2011-02-25 21:35:00
eur_chf    1.2767 2011-02-25 21:40:00
eur_chf    1.2768 2011-02-25 21:45:00
eur_chf    1.2767 2011-02-25 21:50:00
eur_chf    1.2770 2011-02-25 21:55:00
eur_gbp     .8531 2011-02-25 21:10:00
eur_gbp     .8528 2011-02-25 21:15:00
eur_gbp     .8531 2011-02-25 21:20:00
eur_gbp     .8531 2011-02-25 21:25:00
eur_gbp     .8533 2011-02-25 21:30:00
eur_gbp     .8533 2011-02-25 21:35:00
eur_gbp     .8534 2011-02-25 21:40:00
eur_gbp     .8533 2011-02-25 21:45:00
eur_gbp     .8533 2011-02-25 21:50:00
eur_gbp     .8534 2011-02-25 21:55:00
eur_jpy  112.2701 2011-02-25 21:10:00
eur_jpy  112.2445 2011-02-25 21:15:00
eur_jpy  112.2793 2011-02-25 21:20:00
eur_jpy  112.3029 2011-02-25 21:25:00
eur_jpy  112.2970 2011-02-25 21:30:00
eur_jpy  112.2549 2011-02-25 21:35:00
eur_jpy  112.3259 2011-02-25 21:40:00
eur_jpy  112.3012 2011-02-25 21:45:00
eur_jpy  112.3953 2011-02-25 21:50:00
eur_jpy  112.3795 2011-02-25 21:55:00
eur_usd    1.3750 2011-02-25 21:10:00
eur_usd    1.3745 2011-02-25 21:15:00
eur_usd    1.3748 2011-02-25 21:20:00
eur_usd    1.3749 2011-02-25 21:25:00
eur_usd    1.3749 2011-02-25 21:30:00
eur_usd    1.3747 2011-02-25 21:35:00
eur_usd    1.3749 2011-02-25 21:40:00
eur_usd    1.3748 2011-02-25 21:45:00
eur_usd    1.3750 2011-02-25 21:50:00
eur_usd    1.3753 2011-02-25 21:55:00
gbp_usd    1.6117 2011-02-25 21:10:00
gbp_usd    1.6117 2011-02-25 21:15:00
gbp_usd    1.6115 2011-02-25 21:20:00
gbp_usd    1.6116 2011-02-25 21:25:00
gbp_usd    1.6113 2011-02-25 21:30:00
gbp_usd    1.6111 2011-02-25 21:35:00
gbp_usd    1.6112 2011-02-25 21:40:00
gbp_usd    1.6111 2011-02-25 21:45:00
gbp_usd    1.6114 2011-02-25 21:50:00
gbp_usd    1.6116 2011-02-25 21:55:00
usd_cad     .9782 2011-02-25 21:10:00
usd_cad     .9782 2011-02-25 21:15:00
usd_cad     .9783 2011-02-25 21:20:00
usd_cad     .9780 2011-02-25 21:25:00
usd_cad     .9778 2011-02-25 21:30:00
usd_cad     .9778 2011-02-25 21:35:00
usd_cad     .9779 2011-02-25 21:40:00
usd_cad     .9777 2011-02-25 21:45:00
usd_cad     .9778 2011-02-25 21:50:00
usd_cad     .9776 2011-02-25 21:55:00
usd_chf     .9281 2011-02-25 21:10:00
usd_chf     .9284 2011-02-25 21:15:00
usd_chf     .9288 2011-02-25 21:20:00
usd_chf     .9287 2011-02-25 21:25:00
usd_chf     .9285 2011-02-25 21:30:00
usd_chf     .9286 2011-02-25 21:35:00
usd_chf     .9286 2011-02-25 21:40:00
usd_chf     .9287 2011-02-25 21:45:00
usd_chf     .9286 2011-02-25 21:50:00
usd_chf     .9285 2011-02-25 21:55:00
usd_jpy   81.6525 2011-02-25 21:10:00
usd_jpy   81.6650 2011-02-25 21:15:00
usd_jpy   81.6725 2011-02-25 21:20:00
usd_jpy   81.6838 2011-02-25 21:25:00
usd_jpy   81.6750 2011-02-25 21:30:00
usd_jpy   81.6563 2011-02-25 21:35:00
usd_jpy   81.6975 2011-02-25 21:40:00
usd_jpy   81.6863 2011-02-25 21:45:00
usd_jpy   81.7450 2011-02-25 21:50:00
usd_jpy   81.7113 2011-02-25 21:55:00

110 rows selected.

Elapsed: 00:00:00.03
00:08:36 SQL> Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
