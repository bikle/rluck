
SQL*Plus: Release 11.2.0.1.0 Production on Sat Feb 5 04:39:56 2011

Copyright (c) 1982, 2009, Oracle.  All rights reserved.


Connected to:
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options

04:39:57 SQL> ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD hh24:mi:ss';

Session altered.

Elapsed: 00:00:00.00
04:39:57 SQL> 04:39:57 SQL> --
04:39:57 SQL> -- update_di5min.sql
04:39:57 SQL> --
04:39:57 SQL> 
04:39:57 SQL> -- I use this script to keep the di5min table up to date.
04:39:57 SQL> 
04:39:57 SQL> -- CREATE TABLE di5min0(prdate VARCHAR2(26),pair VARCHAR2(7),ydate DATE,clse NUMBER);
04:39:57 SQL> -- CREATE TABLE di5min (prdate VARCHAR2(26),pair VARCHAR2(7),ydate DATE,clse NUMBER);
04:39:57 SQL> 
04:39:57 SQL> TRUNCATE TABLE di5min0;

Table truncated.

Elapsed: 00:00:00.38
04:39:57 SQL> DROP TABLE di5min;

Table dropped.

Elapsed: 00:00:00.04
04:39:57 SQL> PURGE RECYCLEBIN;

Recyclebin purged.

Elapsed: 00:00:00.21
04:39:57 SQL> 
04:39:57 SQL> -- Copy in data from ibf5min:
04:39:57 SQL> 
04:39:57 SQL> INSERT INTO di5min0(prdate,pair,ydate,clse)
04:39:57   2  SELECT	     pair||ydate,pair,ydate,clse
04:39:57   3  FROM ibf5min
04:39:57   4  WHERE ydate >= '2010-11-30'
04:39:57   5  /

83271 rows created.

Elapsed: 00:00:00.27
04:39:57 SQL> 
04:39:57 SQL> -- rpt
04:39:57 SQL> SELECT
04:39:57   2  pair
04:39:57   3  ,MIN(ydate)
04:39:57   4  ,COUNT(pair)
04:39:57   5  ,MAX(ydate)
04:39:57   6  FROM di5min0
04:39:57   7  GROUP BY pair
04:39:57   8  ORDER BY pair
04:39:57   9  
04:39:57 SQL> -- Next, copy in data from dukas:
04:39:57 SQL> 
04:39:57 SQL> INSERT INTO di5min0(prdate,pair,ydate,clse)
04:39:57   2  SELECT	     pair||ydate,pair,ydate,clse
04:39:57   3  FROM dukas5min
04:39:57   4  WHERE ydate < '2010-11-30'
04:39:57   5  AND ydate > sysdate - 100
04:39:57   6  /

39708 rows created.

Elapsed: 00:00:00.10
04:39:58 SQL> 
04:39:58 SQL> -- rpt
04:39:58 SQL> SELECT
04:39:58   2  pair
04:39:58   3  ,MIN(ydate)
04:39:58   4  ,COUNT(pair)
04:39:58   5  ,MAX(ydate)
04:39:58   6  FROM dukas5min
04:39:58   7  GROUP BY pair
04:39:58   8  ORDER BY pair
04:39:58   9  
04:39:58 SQL> -- rpt
04:39:58 SQL> SELECT
04:39:58   2  pair
04:39:58   3  ,MIN(ydate)
04:39:58   4  ,COUNT(pair)
04:39:58   5  ,MAX(ydate)
04:39:58   6  FROM di5min0
04:39:58   7  GROUP BY pair
04:39:58   8  ORDER BY pair
04:39:58   9  
04:39:58 SQL> -- Create other pairs like EUR/CHF:
04:39:58 SQL> @create_other_pairs.sql
04:39:58 SQL> --
04:39:58 SQL> -- create_other_pairs.sql
04:39:58 SQL> --
04:39:58 SQL> 
04:39:58 SQL> -- I use this script to create other non-USD pairs like EUR/CHF.
04:39:58 SQL> 
04:39:58 SQL> -- DROP TABLE op5min;
04:39:58 SQL> -- CREATE TABLE op5min(prdate VARCHAR2(26),pair VARCHAR2(7), ydate DATE, clse NUMBER);
04:39:58 SQL> 
04:39:58 SQL> TRUNCATE TABLE op5min;

Table truncated.

Elapsed: 00:00:00.33
04:39:58 SQL> 
04:39:58 SQL> -- Create the EUR/AUD pair:
04:39:58 SQL> 
04:39:58 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
04:39:58   2  SELECT
04:39:58   3  'eur_aud'||e.ydate prdate
04:39:58   4  ,'eur_aud' pair
04:39:58   5  ,e.ydate
04:39:58   6  ,e.clse/g.clse clse
04:39:58   7  FROM di5min0 e, di5min0 g
04:39:58   8  WHERE e.ydate = g.ydate
04:39:58   9  AND e.pair = 'eur_usd'
04:39:58  10  AND g.pair = 'aud_usd'
04:39:58  11  /

20493 rows created.

Elapsed: 00:00:00.14
04:39:58 SQL> 
04:39:58 SQL> -- Create the EUR/CHF pair:
04:39:58 SQL> 
04:39:58 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
04:39:58   2  SELECT
04:39:58   3  'eur_chf'||e.ydate prdate
04:39:58   4  ,'eur_chf' pair
04:39:58   5  ,e.ydate
04:39:58   6  ,e.clse*c.clse clse
04:39:58   7  FROM di5min0 e, di5min0 c
04:39:58   8  WHERE e.ydate = c.ydate
04:39:58   9  AND e.pair = 'eur_usd'
04:39:58  10  AND c.pair = 'usd_chf'
04:39:58  11  /

20497 rows created.

Elapsed: 00:00:00.07
04:39:58 SQL> 
04:39:58 SQL> -- Create the EUR/GBP pair:
04:39:58 SQL> 
04:39:58 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
04:39:58   2  SELECT
04:39:58   3  'eur_gbp'||e.ydate prdate
04:39:58   4  ,'eur_gbp' pair
04:39:58   5  ,e.ydate
04:39:58   6  ,e.clse/g.clse clse
04:39:58   7  FROM di5min0 e, di5min0 g
04:39:58   8  WHERE e.ydate = g.ydate
04:39:58   9  AND e.pair = 'eur_usd'
04:39:58  10  AND g.pair = 'gbp_usd'
04:39:58  11  /

20496 rows created.

Elapsed: 00:00:00.07
04:39:58 SQL> 
04:39:58 SQL> 
04:39:58 SQL> -- Create the EUR/JPY pair:
04:39:58 SQL> 
04:39:58 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
04:39:58   2  SELECT
04:39:58   3  'eur_jpy'||e.ydate prdate
04:39:58   4  ,'eur_jpy' pair
04:39:58   5  ,e.ydate
04:39:58   6  ,e.clse*j.clse clse
04:39:58   7  FROM di5min0 e, di5min0 j
04:39:58   8  WHERE e.ydate = j.ydate
04:39:58   9  AND e.pair = 'eur_usd'
04:39:58  10  AND j.pair = 'usd_jpy'
04:39:58  11  /

20492 rows created.

Elapsed: 00:00:00.07
04:39:58 SQL> 
04:39:58 SQL> -- Create the AUD/JPY pair:
04:39:58 SQL> 
04:39:58 SQL> INSERT INTO op5min(prdate,pair,ydate,clse)
04:39:58   2  SELECT
04:39:58   3  'aud_jpy'||a.ydate prdate
04:39:58   4  ,'aud_jpy' pair
04:39:58   5  ,a.ydate
04:39:58   6  ,a.clse*j.clse clse
04:39:58   7  FROM di5min0 a, di5min0 j
04:39:58   8  WHERE a.ydate = j.ydate
04:39:58   9  AND a.pair = 'aud_usd'
04:39:58  10  AND j.pair = 'usd_jpy'
04:39:58  11  /

20488 rows created.

Elapsed: 00:00:00.08
04:39:58 SQL> 
04:39:58 SQL> -- rpt
04:39:58 SQL> 
04:39:58 SQL> SELECT * FROM op5min
04:39:58   2  WHERE ydate > sysdate - 0.5/24
04:39:58   3  ORDER BY prdate
04:39:58   4  /

no rows selected

Elapsed: 00:00:00.01
04:39:58 SQL> 
04:39:58 SQL> -- Dont put an exit here.
04:39:58 SQL> -- This script is called from another SQL script.
04:39:58 SQL> -- Here is what I want:
04:39:58 SQL> 
04:39:58 SQL> CREATE TABLE di5min COMPRESS AS
04:39:58   2  SELECT
04:39:58   3  prdate
04:39:58   4  ,pair
04:39:58   5  ,ydate
04:39:58   6  ,clse
04:39:58   7  FROM
04:39:58   8  (
04:39:58   9  	SELECT
04:39:58  10  	prdate
04:39:58  11  	,pair
04:39:58  12  	,ydate
04:39:58  13  	,AVG(clse)clse
04:39:58  14  	FROM di5min0
04:39:58  15  	GROUP BY
04:39:58  16  	prdate
04:39:58  17  	,pair
04:39:58  18  	,ydate
04:39:58  19  	UNION
04:39:58  20  	SELECT
04:39:58  21  	prdate
04:39:58  22  	,pair
04:39:58  23  	,ydate
04:39:58  24  	,clse
04:39:58  25  	FROM op5min
04:39:58  26  )
04:39:58  27  /

Table created.

Elapsed: 00:00:01.56
04:40:00 SQL> 
04:40:00 SQL> -- rpt
04:40:00 SQL> SELECT
04:40:00   2  pair
04:40:00   3  ,MIN(ydate)
04:40:00   4  ,COUNT(ydate)
04:40:00   5  ,MAX(ydate)
04:40:00   6  ,MIN(clse)
04:40:00   7  ,AVG(clse)
04:40:00   8  ,MAX(clse)
04:40:00   9  FROM di5min
04:40:00  10  GROUP BY pair
04:40:00  11  ORDER BY pair
04:40:00  12  /

PAIR	MIN(YDATE)	    COUNT(YDATE) MAX(YDATE)	      MIN(CLSE)  AVG(CLSE)  MAX(CLSE)
------- ------------------- ------------ ------------------- ---------- ---------- ----------
aud_jpy 2010-10-28 04:40:00	   20488 2011-02-04 21:55:00  78.249976 82.1301168 83.6669853
aud_usd 2010-10-28 04:40:00	   20494 2011-02-04 21:55:00	 .95405 .993510067     1.0246
eur_aud 2010-10-28 04:40:00	   20493 2011-02-04 21:55:00 1.29324263 1.35345307 1.42628701
eur_chf 2010-10-28 04:40:00	   20497 2011-02-04 21:55:00 1.24192946 1.30276414 1.38284305
eur_gbp 2010-10-28 04:40:00	   20496 2011-02-04 21:55:00 .829062716 .850837652 .881241482
eur_jpy 2010-10-28 04:40:00	   20492 2011-02-04 21:55:00 106.906797 111.137826  115.36994
eur_usd 2010-10-28 04:40:00	   20498 2011-02-04 21:55:00	1.28795 1.34452367     1.4273
gbp_usd 2010-10-28 04:40:00	   20498 2011-02-04 21:55:00   1.535325 1.58013162     1.6295
usd_cad 2010-10-28 04:40:00	   20496 2011-02-04 21:55:00	 .98355 1.00459988   1.028075
usd_chf 2010-10-28 04:40:00	   20499 2011-02-04 21:55:00	.931675 .968977536    1.00635
usd_jpy 2010-10-28 04:40:00	   20494 2011-02-04 21:55:00	  80.25 82.6750473     84.485

11 rows selected.

Elapsed: 00:00:00.17
04:40:00 SQL> 
04:40:00 SQL> COLUMN clse FORMAT 999.9999
04:40:00 SQL> SELECT
04:40:00   2  pair
04:40:00   3  ,ROUND(clse,4)clse
04:40:00   4  ,ydate
04:40:00   5  FROM di5min
04:40:00   6  WHERE ydate > sysdate - 3/24
04:40:00   7  ORDER BY pair,ydate
04:40:00   8  /

no rows selected

Elapsed: 00:00:00.03
04:40:00 SQL> Disconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options
